

;
; +-------------------------------------------------------------------------+
; |   This file	has been generated by The Interactive Disassembler (IDA)    |
; |	      Copyright	(c) 2011 Hex-Rays, <support@hex-rays.com>	    |
; |			 License info: 48-327F-7274-B7			    |
; |			       ESET spol. s r.o.			    |
; +-------------------------------------------------------------------------+
;
; Input	MD5   :	834C1FB7DBF33199B6470FF36E15FAC7
; Input	CRC32 :	E6C734B7

; File Name   :	R:\DIANA.EXE
; Format      :	MS-DOS executable (EXE)
; Base Address:	1000h Range: 10000h-1D661h Loaded length: D25Dh
; Entry	Point :	1000:0

		.686p
		.mmx
		.model large

; ===========================================================================

; Segment type:	Pure code
seg000		segment	byte public 'CODE' use16
		assume cs:seg000
		assume es:nothing, ss:seg002, ds:seg001, fs:nothing, gs:nothing

; =============== S U B	R O U T	I N E =======================================


		public start
start		proc near

; FUNCTION CHUNK AT 01AC SIZE 00000004 BYTES

		cld
		call	sub_101F9
		call	CheckNAVAL
		call	sub_10242
		les	di, cs:ScrVariables
		cmp	byte ptr es:[di+72Dh], 0FFh
		jz	short loc_1001C
		call	sub_100F6
		jmp	short loc_1002B
; ---------------------------------------------------------------------------

loc_1001C:				; CODE XREF: start+15j
		mov	si, offset aCurSceneFile ; "BEGIN.DSD"
		add	di, 72Fh
		mov	cx, 10h
		rep movsw
		call	LoadSceneMainB

loc_1002B:				; CODE XREF: start+1Aj
		les	di, cs:ScrVariables
		mov	word ptr es:[di+8BFh], 0
		mov	byte ptr es:[di+72Dh], 0FEh
		call	ScriptMainLoop
		mov	bx, bp
		sub	bx, 4Ah
		les	di, cs:ScrVariables
		mov	es:[di+7ADh], bx
		les	di, cs:ScrVariables
		mov	word ptr es:[di+8BFh], 0
		jmp	loc_101AC
start		endp


; =============== S U B	R O U T	I N E =======================================


ScriptMainLoop	proc near		; CODE XREF: start+3Dp
					; ScriptMainLoop+6Fj
		mov	bx, ds:[bp+0]
		les	di, cs:ScrVariables
		cmp	byte ptr es:[di+8B6h], 1
		jnz	short loc_10087
		push	ax
		push	dx
		push	ds
		mov	ax, seg	seg001
		mov	ds, ax
		mov	ax, bx
		call	Int2Str_4Digits
		mov	ah, 9
		mov	dx, offset asc_1D24A ; " $"
		int	21h		; DOS -	PRINT STRING
					; DS:DX	-> string terminated by	"$"
		pop	ds
		assume ds:nothing
		pop	dx
		pop	ax

loc_10087:				; CODE XREF: ScriptMainLoop+Fj
		cmp	bx, 70h
		jb	short loc_100BF
		push	ax
		push	dx
		push	ds
		mov	ax, seg	seg001
		mov	ds, ax
		assume ds:seg001
		mov	ax, bx
		call	Int2Str_4Digits
		mov	ah, 9
		mov	dx, offset asc_1D24A ; " $"
		int	21h		; DOS -	PRINT STRING
					; DS:DX	-> string terminated by	"$"
		pop	ds
		assume ds:nothing
		pop	dx
		pop	ax
		push	ax
		push	dx
		mov	ah, 9
		mov	dx, offset aUnknownCommand ; "ÅcÇ±ÇÒÇ»ñΩóﬂÇ»ÇÒÇ©ÅAå©ÇΩÇ±Ç∆ñ≥Ç¢ÇÌÅI\r\n$"
		int	21h		; DOS -	PRINT STRING
					; DS:DX	-> string terminated by	"$"
		pop	dx
		pop	ax
		push	ax
		mov	ah, 8
		int	21h		; DOS -	KEYBOARD INPUT,	NO ECHO
					; Return: AL = character
		pop	ax
		mov	ah, 0Ch
		int	18h		; TRANSFER TO ROM BASIC
					; causes transfer to ROM-based BASIC (IBM-PC)
					; often	reboots	a compatible; often has	no effect at all
		mov	ah, 0B4h
		call	WaitFrames
		retn
; ---------------------------------------------------------------------------

loc_100BF:				; CODE XREF: ScriptMainLoop+2Cj
		shl	bx, 1
		or	bx, bx
		jz	short locret_100D0
		les	di, cs:ScrVariables
		call	ds:scriptFuncList[bx]
		jmp	short ScriptMainLoop
; ---------------------------------------------------------------------------

locret_100D0:				; CODE XREF: ScriptMainLoop+64j
					; sExit+Ej
		retn
ScriptMainLoop	endp


; =============== S U B	R O U T	I N E =======================================


sExit		proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		pop	ax
		mov	bx, ds:[bp+2]
		mov	ax, es:[bx+di+1Ch]
		mov	es:[bx+di+8BFh], ax
		jmp	short locret_100D0
sExit		endp ; sp-analysis failed


; =============== S U B	R O U T	I N E =======================================


LoadSceneMainB	proc near		; CODE XREF: start+28p

; FUNCTION CHUNK AT 0185 SIZE 00000027 BYTES

		mov	dx, offset aCurSceneFile ; "BEGIN.DSD"

LoadSceneMain:				; CODE XREF: sLoadScene+27j
					; sLoadSubScene+Fp ...
		call	OpenFileRead2
		jnb	short loc_100EF
		mov	si, 2
		jmp	loc_10185
; ---------------------------------------------------------------------------

loc_100EF:				; CODE XREF: LoadSceneMainB+6j
		call	ReadEncryptedFile
		mov	bp, 4Ah
		retn
LoadSceneMainB	endp ; sp-analysis failed

		assume ds:seg001

; =============== S U B	R O U T	I N E =======================================


sub_100F6	proc near		; CODE XREF: start+17p
		mov	es, cs:word_12F3E
		mov	di, 0Ah
		lds	si, cs:ScrVariables
		assume ds:nothing
		add	si, 72Fh
		mov	cx, 10h
		rep movsw
		mov	ds, cs:word_12F3E
		assume ds:seg001
		mov	dx, offset aCurSceneFile ; "BEGIN.DSD"
		call	OpenFileRead2
		jnb	short loc_1011F
		mov	si, 2
		jmp	short loc_10185
; ---------------------------------------------------------------------------
		nop

loc_1011F:				; CODE XREF: sub_100F6+21j
		mov	ds, cs:word_12F3E
		assume ds:nothing
		call	ReadEncryptedFile
		les	di, cs:ScrVariables
		mov	bp, es:[di+74Fh]
		retn
sub_100F6	endp


; =============== S U B	R O U T	I N E =======================================


ReadEncryptedFile proc near		; CODE XREF: LoadSceneMainB:loc_100EFp
					; sub_100F6+2Ep
		mov	bx, ds:879Dh
		mov	cx, 4650h
		mov	dx, 4Ah
		add	dx, ds:851Ah
		cmp	word ptr ds:851Ah, 0
		jz	short loc_1014A
		mov	cx, 3E80h

loc_1014A:				; CODE XREF: ReadEncryptedFile+13j
		mov	ah, 3Fh
		int	21h		; DOS -	2+ - READ FROM FILE WITH HANDLE
					; BX = file handle, CX = number	of bytes to read
					; DS:DX	-> buffer
		jnb	short loc_10156
		mov	si, 4
		jmp	short loc_10185
; ---------------------------------------------------------------------------
		align 2

loc_10156:				; CODE XREF: ReadEncryptedFile+1Cj
		call	DecryptFile
		mov	ah, 3Eh
		int	21h		; DOS -	2+ - CLOSE A FILE WITH HANDLE
					; BX = file handle
		retn
ReadEncryptedFile endp


; =============== S U B	R O U T	I N E =======================================


DecryptFile	proc near		; CODE XREF: ReadEncryptedFile:loc_10156p
		cmp	byte ptr ds:851Ch, 0
		jnz	short loc_10166
		retn
; ---------------------------------------------------------------------------

loc_10166:				; CODE XREF: DecryptFile+5j
		mov	cx, 2328h
		mov	si, 4Ah
		cmp	word ptr ds:851Ah, 0
		jz	short loc_1017A
		mov	cx, 1F40h
		add	si, ds:851Ah

loc_1017A:				; CODE XREF: DecryptFile+13j
					; DecryptFile+24j
		dec	byte ptr [si]	; decrement 1st	byte
		inc	byte ptr [si+1]	; increment 2nd	byte
		add	si, 2		; Note that this is the	opposite of what WMP 1 does.
		loop	loc_1017A
		retn
DecryptFile	endp

; ---------------------------------------------------------------------------
; START	OF FUNCTION CHUNK FOR LoadSceneMainB
		assume ds:seg001

loc_10185:				; CODE XREF: LoadSceneMainB+Bj
					; sub_100F6+26j ...
		mov	ds, cs:word_12F3E
		aam
		xchg	ah, al
		mov	dx, aDianaErrTbl[si]
		mov	si, dx
		add	ax, 80h
		add	[si], ax
		mov	ah, 9
		int	21h		; DOS -	PRINT STRING
					; DS:DX	-> string terminated by	"$"
		mov	ax, 0C00h
		int	21h		; DOS -	CLEAR KEYBOARD BUFFER
					; AL must be 01h, 06h, 07h, 08h, or 0Ah.
		push	ax
		mov	ah, 8
		int	21h		; DOS -	KEYBOARD INPUT,	NO ECHO
					; Return: AL = character
		pop	ax
		shr	si, 1
		mov	ax, si
; END OF FUNCTION CHUNK	FOR LoadSceneMainB
; START	OF FUNCTION CHUNK FOR start

loc_101AC:				; CODE XREF: start+5Cj	CheckNAVAL+47j	...
		mov	ah, 4Ch
		int	21h		; DOS -	2+ - QUIT WITH EXIT CODE (EXIT)
; END OF FUNCTION CHUNK	FOR start	; AL = exit code

; =============== S U B	R O U T	I N E =======================================


CheckNAVAL	proc near		; CODE XREF: start+4p
		xor	ax, ax
		mov	es, ax
		assume es:nothing
		mov	ax, es:458h
		mov	word ptr cs:ScrVariables, ax
		mov	ax, es:45Ah
		mov	word ptr cs:ScrVariables+2, ax
		les	di, cs:ScrVariables
		assume es:nothing
		cmp	word ptr es:[di], 'AN'
		jnz	short loc_101E0
		cmp	word ptr es:[di+2], 'AV'
		jnz	short loc_101E0
		cmp	byte ptr es:[di+4], 'L'
		jnz	short loc_101E0
		retn
; ---------------------------------------------------------------------------

loc_101E0:				; CODE XREF: CheckNAVAL+1Ej
					; CheckNAVAL+26j ...
		push	ax
		push	dx
		mov	ah, 9
		mov	dx, offset aNoNavalFound ; "NAVALÇ™Ç¢Ç»Ç¢ÇÃ(;_;).\r\n$"
		int	21h		; DOS -	PRINT STRING
					; DS:DX	-> string terminated by	"$"
		pop	dx
		pop	ax
		les	di, cs:ScrVariables
		mov	word ptr es:[di+8BFh], 0FFFDh
		jmp	short loc_101AC
CheckNAVAL	endp


; =============== S U B	R O U T	I N E =======================================


sub_101F9	proc near		; CODE XREF: start+1p
		mov	ax, seg	seg001
		mov	es, ax
		assume es:seg001
		mov	si, 81h
		lea	di, aCurSceneFile ; "BEGIN.DSD"
		cmp	byte ptr aDianaVer2+36h, 0
		jz	short loc_1023C

loc_1020C:				; CODE XREF: sub_101F9+22j
		lodsb
		cmp	al, 0Dh
		jnz	short loc_10216
		xor	al, al
		stosb
		jmp	short loc_1023C
; ---------------------------------------------------------------------------

loc_10216:				; CODE XREF: sub_101F9+16j
		stosb
		cmp	si, 0A0h
		jnz	short loc_1020C
		mov	ax, seg	seg001
		mov	ds, ax
		push	ax
		push	dx
		mov	ah, 9
		mov	dx, offset aImpossible ; "Ç≤ÇﬂÇÒÅcñ≥óùÇ›ÇΩÇ¢.\r\n$Å°$"
		int	21h		; DOS -	PRINT STRING
					; DS:DX	-> string terminated by	"$"
		pop	dx
		pop	ax
		les	di, cs:ScrVariables
		assume es:nothing
		mov	word ptr es:[di+8BFh], 0FFFCh
		jmp	loc_101AC
; ---------------------------------------------------------------------------

loc_1023C:				; CODE XREF: sub_101F9+11j
					; sub_101F9+1Bj
		mov	ax, seg	seg001
		mov	ds, ax
		retn
sub_101F9	endp


; =============== S U B	R O U T	I N E =======================================


sub_10242	proc near		; CODE XREF: start+7p
		xor	ax, ax
		mov	ds, ax
		assume ds:nothing
		mov	bl, ds:54Dh
		mov	ax, seg	seg001
		mov	ds, ax
		assume ds:seg001
		mov	cs:word_12F3E, ax
		and	bl, 4
		shl	bl, 4
		mov	byte_1D21F, bl
		mov	ax, 0C00h
		int	21h		; DOS -	CLEAR KEYBOARD BUFFER
					; AL must be 01h, 06h, 07h, 08h, or 0Ah.
		call	sub_13005
		les	di, cs:ScrVariables
		mov	ax, seg	seg003
		mov	es:[di+10h], ax
		add	ax, 7D0h
		mov	es:[di+12h], ax
		add	ax, 7D0h
		mov	es:[di+14h], ax
		add	ax, 7D0h
		mov	es:[di+16h], ax
		mov	byte ptr es:[di+8CBh], 10h
		mov	byte ptr es:[di+8CCh], 14h
		mov	al, es:[di+8CDh]
		mov	byte_1B5BC, al
		retn
sub_10242	endp


; =============== S U B	R O U T	I N E =======================================


sub_1029B	proc near		; CODE XREF: sub_10715p
		xor	ax, ax
		mov	ax, 0A000h
		mov	es, ax
		assume es:nothing
		xor	ax, ax
		mov	cx, 0FA0h
		xor	di, di
		rep stosw
		mov	ax, 0E1E1h
		mov	ax, 0A200h
		mov	es, ax
		assume es:nothing
		xor	ax, ax
		mov	cx, 0FA0h
		xor	di, di
		rep stosw
		retn
sub_1029B	endp

; ---------------------------------------------------------------------------
		align 2

; =============== S U B	R O U T	I N E =======================================

; Attributes: noreturn

sLoadImage	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		xor	bx, bx
		mov	bl, ds:[bp+7]
		cmp	bl, 1
		jnz	short loc_102D7
		mov	byte ptr es:[di+8B7h], 1
		call	WriteIOA6
		mov	byte_1B644, 1

loc_102D7:				; CODE XREF: sLoadImage+9j
		cmp	byte_1B642, bl
		jz	short loc_10322
		mov	byte_1B642, bl
		test	bl, 0FEh
		jnz	short loc_10300
		mov	ax, 0A800h
		mov	word_1B64C, ax
		mov	ax, 0B000h
		mov	word_1B64E, ax
		mov	ax, 0B800h
		mov	word_1B650, ax
		mov	ax, 0E000h
		mov	word_1B652, ax
		jmp	short loc_10322
; ---------------------------------------------------------------------------

loc_10300:				; CODE XREF: sLoadImage+26j
		sub	bx, 2
		shl	bx, 3
		mov	ax, es:[bx+di+8]
		mov	word_1B64C, ax
		mov	ax, es:[bx+di+0Ah]
		mov	word_1B64E, ax
		mov	ax, es:[bx+di+0Ch]
		mov	word_1B650, ax
		mov	ax, es:[bx+di+0Eh]
		mov	word_1B652, ax

loc_10322:				; CODE XREF: sLoadImage+1Dj
					; sLoadImage+40j
		mov	ax, ds:[bp+2]
		mov	word_1B646, ax
		mov	ax, ds:[bp+4]
		mov	word_1B648, ax
		mov	al, ds:[bp+6]
		mov	dx, ds:[bp+8]
		add	dx, 4Ah	; 'J'
		mov	bx, es:[di+1Ah]
		mov	word_1B64A, bx
		mov	bx, 85A6h
		call	sub_1141F
sLoadImage	endp

; ---------------------------------------------------------------------------
		cmp	byte_1B644, 0
		jz	short loc_10364
		les	di, cs:ScrVariables
		assume es:nothing
		mov	byte ptr es:[di+8B7h], 0
		call	WriteIOA6
		mov	byte_1B644, 0

loc_10364:				; CODE XREF: seg000:034Fj
		add	bp, 0Ah
		retn

; =============== S U B	R O U T	I N E =======================================

; new in DIANA v2

sOpenTextBoxVar	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	bx, ds:[bp+3]
		mov	ax, es:[bx+di+1Ch]
		mov	bx, ds:[bp+5]
		mov	dx, es:[bx+di+1Ch]
		jmp	short loc_10382
sOpenTextBoxVar	endp


; =============== S U B	R O U T	I N E =======================================


sOpenTextBox	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	ax, ds:[bp+3]
		mov	dx, ds:[bp+5]

loc_10382:				; CODE XREF: sOpenTextBoxVar+10j
		push	bx
		mov	bl, ds:[bp+2]
		and	bx, 7
		shl	bx, 1
		cmp	word ptr [bx-5F99h], 0FFFFh
		pop	bx
		jz	short loc_10397
		jmp	short loc_10408
; ---------------------------------------------------------------------------
		nop

loc_10397:				; CODE XREF: sOpenTextBox+18j
		mov	word_1B77A, ax
		mov	word_1B77C, dx
		mov	di, 9FFAh
		xor	bx, bx
		mov	bl, ds:[bp+2]
		test	bl, 8
		jz	short loc_103B4
		mov	byte_1D106, 1
		and	bl, 7

loc_103B4:				; CODE XREF: sOpenTextBox+30j
		mov	word_1D096, bx
		imul	bx, 0Ch
		mov	dx, ds:[bp+0Ah]
		mov	[bx-5FFCh], dx
		mov	dx, word_1B77C
		mov	[bx-6000h], dx
		xor	ax, ax
		mov	al, ds:[bp+8]
		imul	ax, 500h
		sub	ax, 500h
		xor	dx, dx
		mov	dl, ds:[bp+7]	; DATA XREF: sSaveCharName+3w
		shl	dx, 1
		sub	dx, 2
		add	dx, ax
		add	dx, word_1B77A
		mov	[bx-5FFEh], dx
		mov	dx, word_1B77A
		mov	[bx-6006h], dx
		mov	ax, ds:[bp+7]
		mov	[bx-6004h], ax
		mov	al, ds:[bp+9]
		mov	[bx-6002h], al
		call	sub_11B00

loc_10408:				; CODE XREF: sOpenTextBox+1Aj
		add	bp, 0Ch
		retn
sOpenTextBox	endp


; =============== S U B	R O U T	I N E =======================================


sCloseTextBox	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	al, ds:[bp+2]
		and	ax, 7
		mov	bx, ax
		shl	bx, 1
		cmp	word ptr [bx-5F99h], 0FFFFh
		jz	short loc_10424
		mov	word_1D096, ax
		call	sub_12844

loc_10424:				; CODE XREF: sCloseTextBox+10j
		add	bp, 3
		retn
sCloseTextBox	endp


; =============== S U B	R O U T	I N E =======================================


sClearTextBox	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	byte_1D106, 2
		xor	bx, bx
		mov	bl, ds:[bp+2]
		test	bl, 8
		jz	short loc_10440
		mov	byte_1D106, 1
		and	bl, 7

loc_10440:				; CODE XREF: sClearTextBox+Ej
		mov	word_1D096, bx
		imul	bx, 0Ch
		call	sub_11B00
		add	bp, 3
		retn
sClearTextBox	endp


; =============== S U B	R O U T	I N E =======================================


sApplyPalette	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		call	sub_11886
		add	bp, 2
		retn
sApplyPalette	endp


; =============== S U B	R O U T	I N E =======================================


sPalFadeBW1	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		test	byte ptr ds:[bp+2], 1
		jz	short loc_10463
		mov	ax, 1010h
		mov	bl, 0FFh
		jmp	short loc_10468
; ---------------------------------------------------------------------------

loc_10463:				; CODE XREF: sPalFadeBW1+5j
		mov	ax, 0FFFFh
		mov	bl, 1

loc_10468:				; CODE XREF: sPalFadeBW1+Cj
		mov	cx, 18h
		push	ds
		pop	es
		assume es:seg001
		mov	di, 85C8h
		rep stosw
		mov	ah, bl
		mov	dh, 10h

loc_10476:				; CODE XREF: sPalFadeBW1+31j
		push	dx
		call	sub_1048C
		push	ax
		mov	ah, ds:[bp+3]
		call	WaitFrames
		pop	ax
		pop	dx
		dec	dh
		jnz	short loc_10476
		add	bp, 4
		retn
sPalFadeBW1	endp


; =============== S U B	R O U T	I N E =======================================


sub_1048C	proc near		; CODE XREF: sPalFadeBW1+22p
		xor	bx, bx
		mov	si, 85B8h
		mov	cx, 10h

loc_10494:				; CODE XREF: sub_1048C+11j
					; sub_1048C+2Cj
		test	byte ptr [si], 1
		jz	short loc_1049F
		add	bx, 3
		inc	si
		loop	loc_10494

loc_1049F:				; CODE XREF: sub_1048C+Bj
		mov	al, 10h
		sub	al, cl
		out	0A8h, al	; Interrupt Controller #2, 8259A
		mov	dx, 0AAh ; '™'
		call	sub_104BB
		mov	dx, 0ACh ; '¨'
		call	sub_104BB
		mov	dx, 0AEh ; 'Æ'
		call	sub_104BB
		inc	si
		loop	loc_10494
		retn
sub_1048C	endp


; =============== S U B	R O U T	I N E =======================================


sub_104BB	proc near		; CODE XREF: sub_1048C+1Cp
					; sub_1048C+22p ...
		mov	al, [bx-7A38h]
		cmp	al, [bx-7861h]
		jz	short loc_104CC
		add	al, ah
		out	dx, al
		mov	[bx-7A38h], al

loc_104CC:				; CODE XREF: sub_104BB+8j
		inc	bx
		retn
sub_104BB	endp


; =============== S U B	R O U T	I N E =======================================


sPalFadeBW2	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	cx, 18h
		push	ds
		pop	es
		mov	si, 879Fh
		mov	di, 85C8h
		rep movsw
		mov	ah, 0FFh
		mov	ch, 0FFh
		test	byte ptr ds:[bp+2], 1
		jz	short loc_104EA
		mov	ah, 1
		mov	ch, 10h

loc_104EA:				; CODE XREF: sPalFadeBW2+16j
		mov	dh, 10h

loc_104EC:				; CODE XREF: sPalFadeBW2+2Ej
		push	dx
		call	sub_10502
		push	ax
		mov	ah, ds:[bp+3]
		call	WaitFrames
		pop	ax
		pop	dx
		dec	dh
		jnz	short loc_104EC
		add	bp, 4
		retn
sPalFadeBW2	endp


; =============== S U B	R O U T	I N E =======================================


sub_10502	proc near		; CODE XREF: sPalFadeBW2+1Fp
		xor	bx, bx
		xor	si, si
		mov	cl, 10h

loc_10508:				; CODE XREF: sub_10502+2Dj
		test	byte ptr [si-7A48h], 1
		jz	short loc_10514
		add	bx, 3
		jmp	short loc_1052C
; ---------------------------------------------------------------------------

loc_10514:				; CODE XREF: sub_10502+Bj
		mov	al, 10h
		sub	al, cl
		out	0A8h, al	; Interrupt Controller #2, 8259A
		mov	dx, 0AAh ; '™'
		call	sub_10532
		mov	dx, 0ACh ; '¨'
		call	sub_10532
		mov	dx, 0AEh ; 'Æ'
		call	sub_10532

loc_1052C:				; CODE XREF: sub_10502+10j
		inc	si
		dec	cl
		jnz	short loc_10508
		retn
sub_10502	endp


; =============== S U B	R O U T	I N E =======================================


sub_10532	proc near		; CODE XREF: sub_10502+1Bp
					; sub_10502+21p ...
		mov	al, [bx-7A38h]
		cmp	al, ch
		jz	short loc_1053F
		out	dx, al
		add	[bx-7A38h], ah

loc_1053F:				; CODE XREF: sub_10532+6j
		inc	bx
		retn
sub_10532	endp


; =============== S U B	R O U T	I N E =======================================


sPalMaskToggle	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		xor	bx, bx
		mov	bl, ds:[bp+2]
		xor	byte ptr [bx-7A48h], 1
		add	bp, 3
		retn
sPalMaskToggle	endp


; =============== S U B	R O U T	I N E =======================================


sCompareVars	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	bx, ds:[bp+2]
		mov	ax, es:[bx+di+1Ch]
		mov	bx, ds:[bp+4]
		cmp	ax, es:[bx+di+1Ch]
		jmp	short loc_1056E
sCompareVars	endp


; =============== S U B	R O U T	I N E =======================================


sCompareValVal	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	bx, ds:[bp+2]
		mov	ax, es:[bx+di+1Ch]
		cmp	ax, ds:[bp+4]

loc_1056E:				; CODE XREF: sCompareVars+10j
		lahf
		mov	byte_1B641, ah
		add	bp, 6
		retn
sCompareValVal	endp


; =============== S U B	R O U T	I N E =======================================


sCondJmp_EQ	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	ah, byte_1B641
		sahf
		jz	short sJumpAbs

loc_1057E:				; CODE XREF: sCondJmp_LT+7j
					; sCondJmp_GT+7j ...
		add	bp, 4
		retn
sCondJmp_EQ	endp


; =============== S U B	R O U T	I N E =======================================


sCondJmp_LT	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	ah, byte_1B641
		sahf
		jl	short sJumpAbs
		jmp	short loc_1057E
sCondJmp_LT	endp


; =============== S U B	R O U T	I N E =======================================


sCondJmp_GT	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	ah, byte_1B641
		sahf
		jg	short sJumpAbs
		jmp	short loc_1057E
sCondJmp_GT	endp


; =============== S U B	R O U T	I N E =======================================


sCondJmp_GE	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	ah, byte_1B641
		sahf
		jge	short sJumpAbs
		jmp	short loc_1057E
sCondJmp_GE	endp


; =============== S U B	R O U T	I N E =======================================


sCondJmp_LE	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	ah, byte_1B641
		sahf
		jle	short sJumpAbs
		jmp	short loc_1057E
sCondJmp_LE	endp


; =============== S U B	R O U T	I N E =======================================


sCondJmp_NE	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	ah, byte_1B641
		sahf
		jnz	short sJumpAbs
		jmp	short loc_1057E
sCondJmp_NE	endp


; =============== S U B	R O U T	I N E =======================================


sJumpAbs	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; sCondJmp_EQ+5j ...
		mov	bp, ds:[bp+2]
		add	bp, 4Ah	; 'J'
		retn
sJumpAbs	endp


; =============== S U B	R O U T	I N E =======================================


sTblJump	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	bx, ds:[bp+2]
		mov	bx, es:[bx+di+1Ch]
		shl	bx, 1
		add	bp, bx
		mov	bp, ds:[bp+4]
		add	bp, 4Ah	; 'J'
		retn
sTblJump	endp


; =============== S U B	R O U T	I N E =======================================


sSetPalColour	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	bx, ds:[bp+4]
		mov	ax, es:[bx+di+1Ch]
		mov	byte ptr word_1B626+1, al
		mov	bx, ds:[bp+6]
		mov	ax, es:[bx+di+1Ch]
		mov	byte ptr word_1B626, al
		mov	bx, ds:[bp+8]
		mov	ax, es:[bx+di+1Ch]
		mov	byte_1B628, al
		mov	bx, ds:[bp+2]
		mov	ax, es:[bx+di+1Ch]
		push	ax
		mov	si, 8586h
		call	sub_11896
		pop	ax
		mov	bx, ax
		add	ax, ax
		add	bx, ax
		mov	ax, word_1B626
		mov	[bx-7861h], ax
		mov	al, byte_1B628
		mov	[bx-785Fh], al
		add	bp, 0Ah
		retn
sSetPalColour	endp


; =============== S U B	R O U T	I N E =======================================


sShowText	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	si, ds:[bp+3]
		add	si, 4Ah	; 'J'
		jmp	loc_10E71
sShowText	endp


; =============== S U B	R O U T	I N E =======================================


sub_10621	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		xor	bx, bx
		mov	bl, ds:[bp+2]
		imul	bx, 0Ch
		mov	ax, ds:[bp+3]
		mov	[bx-6000h], ax
		add	bp, 5
		retn
sub_10621	endp


; =============== S U B	R O U T	I N E =======================================


sLoadVar_Val	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	bx, ds:[bp+2]
		mov	ax, ds:[bp+4]
		mov	es:[bx+di+1Ch],	ax
		add	bp, 6
		retn
sLoadVar_Val	endp


; =============== S U B	R O U T	I N E =======================================


sLoadVars_Vals	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	bx, ds:[bp+2]
		add	bp, 4

loc_1064D:				; CODE XREF: sLoadVars_Vals+1Aj
		mov	ax, ds:[bp+0]
		add	bp, 2
		cmp	ax, 0FFF0h
		jz	short locret_10662
		mov	es:[bx+di+1Ch],	ax
		add	bx, 2
		jmp	short loc_1064D
; ---------------------------------------------------------------------------

locret_10662:				; CODE XREF: sLoadVars_Vals+11j
		retn
sLoadVars_Vals	endp


; =============== S U B	R O U T	I N E =======================================


sLoadVar_Var	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	bx, ds:[bp+4]
		mov	ax, es:[bx+di+1Ch]
		mov	bx, ds:[bp+2]
		mov	es:[bx+di+1Ch],	ax
		add	bp, 6
		retn
sLoadVar_Var	endp


; =============== S U B	R O U T	I N E =======================================


sBGM_Play	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		push	bx
		push	cx
		push	dx
		mov	ah, 1
		call	CallSndDrv_BGM
		mov	dx, ds:[bp+2]
		add	dx, 4Ah
		call	OpenFileForRead
		mov	bx, fileHandle
		push	ds
		mov	ah, 6
		call	CallSndDrv_BGM
		mov	cx, cs:fileSize
		mov	ah, 3Fh
		int	21h		; DOS -	2+ - READ FROM FILE WITH HANDLE
					; BX = file handle, CX = number	of bytes to read
					; DS:DX	-> buffer
		pop	ds
		assume ds:nothing
		mov	ah, 3Eh
		int	21h		; DOS -	2+ - CLOSE A FILE WITH HANDLE
					; BX = file handle
		mov	ah, 0
		call	CallSndDrv_BGM
		pop	dx
		pop	cx
		pop	bx
		add	bp, 4
		retn
sBGM_Play	endp


; =============== S U B	R O U T	I N E =======================================


sBGM_FadeOut	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	ax, 208h
		jmp	short loc_106B5
sBGM_FadeOut	endp


; =============== S U B	R O U T	I N E =======================================


sBGM_Stop	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	ah, 1

loc_106B5:				; CODE XREF: sBGM_FadeOut+3j
		call	CallSndDrv_BGM
		add	bp, 2
		retn
sBGM_Stop	endp


; =============== S U B	R O U T	I N E =======================================


sGetMusMode	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	ah, 11h
		int	58h		; IRQ8 relocated by DESQview 2.26+
		call	sub_1275D
		les	di, cs:ScrVariables
		assume es:nothing, ds:seg001
		mov	bx, ds:[bp+2]
		mov	es:[bx+di+1Ch],	ax
		add	bp, 4
		retn
sGetMusMode	endp


; =============== S U B	R O U T	I N E =======================================


sub_106D4	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		call	sub_1274B
		call	sub_1275D
		les	di, cs:ScrVariables
		mov	bx, ds:[bp+2]
		mov	es:[bx+di+1Ch],	ax
		add	bp, 4
		retn
sub_106D4	endp


; =============== S U B	R O U T	I N E =======================================


sLoadScene	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		les	di, cs:ScrVariables
		add	di, 72Fh
		mov	dx, ds:[bp+2]
		add	dx, 4Ah
		mov	si, dx
		mov	cx, 10h
		rep movsw
		mov	es, cs:word_12F3E
		mov	di, offset aCurSceneFile ; "BEGIN.DSD"
		mov	si, dx
		mov	cx, 10h
		rep movsw
		jmp	LoadSceneMain
sLoadScene	endp


; =============== S U B	R O U T	I N E =======================================


sub_10715	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		call	sub_1029B
		call	sub_12F44
		add	bp, 2
		retn
sub_10715	endp


; =============== S U B	R O U T	I N E =======================================


sDelay		proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	bx, ds:[bp+2]
		mov	cx, es:[bx+di+1Ch]

loc_10727:				; CODE XREF: sDelay+Bj
		call	WaitForVSync
		loop	loc_10727
		add	bp, 4
		retn
sDelay		endp


; =============== S U B	R O U T	I N E =======================================


sub_10730	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	bx, ds:[bp+2]
		mov	ax, es:[bx+di+1Ch]
		mov	es:[di+8C1h], al
		add	bp, 4
		retn
sub_10730	endp


; =============== S U B	R O U T	I N E =======================================


sub_10741	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	al, ds:[bp+2]
		mov	es:[di+8B6h], al
		add	bp, 3
		retn
sub_10741	endp


; =============== S U B	R O U T	I N E =======================================


sAddVars_Vals	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	bx, ds:[bp+2]
		add	bp, 4

loc_10755:				; CODE XREF: sAddVars_Vals+1Aj
		mov	ax, ds:[bp+0]
		add	bp, 2
		cmp	ax, 0FFF0h
		jz	short locret_1076A
		add	es:[bx+di+1Ch],	ax
		add	bx, 2
		jmp	short loc_10755
; ---------------------------------------------------------------------------

locret_1076A:				; CODE XREF: sAddVars_Vals+11j
		retn
sAddVars_Vals	endp


; =============== S U B	R O U T	I N E =======================================


sSubVars_Vals	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	bx, ds:[bp+2]
		add	bp, 4

loc_10772:				; CODE XREF: sSubVars_Vals+1Aj
		mov	ax, ds:[bp+0]
		add	bp, 2
		cmp	ax, 0FFF0h
		jz	short locret_10787
		sub	es:[bx+di+1Ch],	ax
		add	bx, 2
		jmp	short loc_10772
; ---------------------------------------------------------------------------

locret_10787:				; CODE XREF: sSubVars_Vals+11j
		retn
sSubVars_Vals	endp


; =============== S U B	R O U T	I N E =======================================


sub_10788	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		cmp	word ptr es:[di+7A9h], 0
		jnz	short loc_107A0
		mov	ah, ds:[bp+2]
		xor	ah, 1
		mov	byte_1B83C, ah
		add	ah, 0Ch
		int	18h		; TRANSFER TO ROM BASIC
					; causes transfer to ROM-based BASIC (IBM-PC)
					; often	reboots	a compatible; often has	no effect at all

loc_107A0:				; CODE XREF: sub_10788+6j
		add	bp, 3
		retn
sub_10788	endp


; =============== S U B	R O U T	I N E =======================================


sAddVar_Var	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	bx, ds:[bp+4]
		mov	ax, es:[bx+di+1Ch]
		mov	bx, ds:[bp+2]
		add	es:[bx+di+1Ch],	ax
		add	bp, 6
		retn
sAddVar_Var	endp


; =============== S U B	R O U T	I N E =======================================


sSubVar_Var	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	bx, ds:[bp+4]
		mov	ax, es:[bx+di+1Ch]
		mov	bx, ds:[bp+2]
		sub	es:[bx+di+1Ch],	ax
		add	bp, 6
		retn
sSubVar_Var	endp


; =============== S U B	R O U T	I N E =======================================


sMulVar_Var	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	bx, ds:[bp+4]
		mov	dx, es:[bx+di+1Ch]
		mov	bx, ds:[bp+2]
		mov	ax, es:[bx+di+1Ch]
		mul	dx
		mov	es:[bx+di+1Ch],	ax
		add	bp, 6
		retn
sMulVar_Var	endp


; =============== S U B	R O U T	I N E =======================================


sDivVar_Var	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	bx, ds:[bp+4]
		mov	cx, es:[bx+di+1Ch]
		mov	bx, ds:[bp+2]
		mov	ax, es:[bx+di+1Ch]
		xor	dx, dx
		idiv	cx
		mov	es:[bx+di+1Ch],	ax
		add	bp, 6
		retn
sDivVar_Var	endp


; =============== S U B	R O U T	I N E =======================================


sAndVar_Var_1	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	bx, ds:[bp+4]
		mov	ax, es:[bx+di+1Ch]
		mov	bx, ds:[bp+2]
		and	es:[bx+di+1Ch],	ax
		add	bp, 6
		retn
sAndVar_Var_1	endp


; =============== S U B	R O U T	I N E =======================================


sAndVar_Var_2	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	bx, ds:[bp+4]
		mov	ax, es:[bx+di+1Ch]
		mov	bx, ds:[bp+2]
		and	es:[bx+di+1Ch],	ax
		add	bp, 6
		retn
sAndVar_Var_2	endp


; =============== S U B	R O U T	I N E =======================================


sClearVars	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	bx, ds:[bp+2]
		xor	ax, ax

loc_10830:				; CODE XREF: sClearVars+13j
		mov	es:[bx+di+1Ch],	ax
		cmp	bx, ds:[bp+4]
		jz	short loc_1083F
		add	bx, 2
		jmp	short loc_10830
; ---------------------------------------------------------------------------

loc_1083F:				; CODE XREF: sClearVars+Ej
		add	bp, 6
		retn
sClearVars	endp


; =============== S U B	R O U T	I N E =======================================


sub_10843	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		call	sub_1301A
		mov	ah, ds:[bp+3]
		and	al, ah
		mov	bx, ds:[bp+2]
		mov	es:[bx+di+1Ch],	ax
		add	bp, 3
		retn
sub_10843	endp


; =============== S U B	R O U T	I N E =======================================


sub_10858	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	bx, ds:[bp+2]
		shl	bx, 1
		mov	ax, [bx-5F99h]
		mov	word ptr byte_1D119, ax
		add	bp, 4
		retn
sub_10858	endp


; =============== S U B	R O U T	I N E =======================================


sub_10869	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	bx, ds:[bp+4]
		mov	si, es:[bx+di+1Ch]
		add	si, ds:[bp+2]
		mov	ax, [si+4Ah]
		mov	bx, ds:[bp+6]
		xchg	ah, al
		mov	es:[bx+di+1Ch],	ax
		add	bp, 8
		retn
sub_10869	endp


; =============== S U B	R O U T	I N E =======================================

; new in DIANA v2

sub_10887	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	bx, ds:[bp+4]
		mov	si, es:[bx+di+1Ch]
		add	si, ds:[bp+2]
		mov	ax, [si+4Ah]
		mov	bx, ds:[bp+6]
		mov	es:[bx+di+1Ch],	ax
		add	bp, 8
		retn
sub_10887	endp


; =============== S U B	R O U T	I N E =======================================


sub_108A3	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	bx, ds:[bp+3]
		mov	ax, es:[bx+di+1Ch]
		mov	bx, offset aVovovovovo ; "ÇOÇOÇOÇOÇO\x03"
		call	Int2Str_4Digits
		mov	si, offset byte_1D251
		mov	cx, 5

loc_108B7:				; CODE XREF: sub_108A3+1Fj
		lodsw
		xchg	ah, al
		add	ax, 4F82h
		mov	[bx], ax
		add	bx, 2
		loop	loc_108B7
		jmp	short loc_108F9
sub_108A3	endp

; ---------------------------------------------------------------------------
		nop

; =============== S U B	R O U T	I N E =======================================


sub_108C7	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	bx, ds:[bp+3]
		mov	ax, es:[bx+di+1Ch]
		mov	bx, offset aVovovovovo ; "ÇOÇOÇOÇOÇO\x03"
		call	Int2Str_4Digits
		mov	si, offset byte_1D251
		mov	dx, 4081h
		mov	cx, 5

loc_108DE:				; CODE XREF: sub_108C7+30j
		lodsw
		or	ax, ax
		jz	short loc_108E6
		mov	dx, 4EECh

loc_108E6:				; CODE XREF: sub_108C7+1Aj
		cmp	cx, 1
		jnz	short loc_108EE
		mov	dx, 4EECh

loc_108EE:				; CODE XREF: sub_108C7+22j
		xchg	ah, al
		add	ax, dx
		mov	[bx], ax
		add	bx, 2
		loop	loc_108DE

loc_108F9:				; CODE XREF: sub_108A3+21j
		xor	bx, bx
		mov	bl, ds:[bp+2]
		and	bl, 7
		imul	bx, 0Ch
		mov	ax, (word_1D09A+6)[bx]
		mov	di, ax
		mov	si, offset aVovovovovo ; "ÇOÇOÇOÇOÇO\x03"
		call	sub_11D70
		add	bp, 5
		retn
sub_108C7	endp


; =============== S U B	R O U T	I N E =======================================


sub_10915	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	bx, ds:[bp+2]
		mov	ax, es:[bx+di+1Ch]
		mov	es:[di+8B8h], al
		call	WriteIOA4
		add	bp, 4
		retn
sub_10915	endp


; =============== S U B	R O U T	I N E =======================================


sub_10929	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	bx, ds:[bp+2]
		xor	ax, ax
		mov	al, es:[di+8B8h]
		mov	es:[bx+di+1Ch],	ax
		add	bp, 4
		retn
sub_10929	endp


; =============== S U B	R O U T	I N E =======================================


sTextFill	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		xor	dx, dx
		mov	dl, ds:[bp+2]
		shl	dl, 2
		xor	ax, ax
		mov	al, ds:[bp+3]
		imul	ax, 0A0h
		add	ax, dx
		mov	di, ax
		mov	si, ax
		mov	cx, ds:[bp+4]
		mov	dx, ds:[bp+7]
		call	sub_12042
		xchg	dh, dl
		mov	ax, 0A000h
		mov	es, ax
		assume es:nothing
		sub	dl, 20h	; ' '
		mov	bx, dx
		add	bh, 80h	; 'Ä'
		mov	ah, ds:[bp+6]
		shr	ax, 3
		shl	ah, 2
		or	al, 1
		or	al, ah

loc_1097D:				; CODE XREF: sTextFill+65j
		mov	cl, ds:[bp+4]

loc_10981:				; CODE XREF: sTextFill+5Bj
		mov	es:[di], dx
		mov	es:[di+2], bx
		mov	es:[di+2000h], al
		mov	es:[di+2002h], al
		add	di, 4
		dec	cl
		jnz	short loc_10981
		add	si, 0A0h ; '†'
		mov	di, si
		dec	ch
		jnz	short loc_1097D
		add	bp, 9
		retn
sTextFill	endp


; =============== S U B	R O U T	I N E =======================================


sub_109A7	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	bl, ds:[bp+2]
		and	bx, 1
		shl	bx, 3
		xor	ax, ax
		mov	al, ds:[bp+3]
		imul	ax, 5A0h
		mov	si, 8976h
		add	si, ax
		mov	dx, ds:[bp+4]
		call	sub_109EC
		add	bx, 2
		add	si, 20h	; ' '
		call	sub_109EC
		add	bx, 2
		add	si, 20h	; ' '
		call	sub_109EC
		add	bx, 2
		add	si, 20h	; ' '
		call	sub_109EC
		sub	si, 60h	; '`'
		call	sub_10A5A
		add	bp, 6
		retn
sub_109A7	endp


; =============== S U B	R O U T	I N E =======================================


sub_109EC	proc near		; CODE XREF: sub_109A7+1Dp
					; sub_109A7+26p ...
		les	di, cs:ScrVariables
		assume es:nothing
		push	si
		push	ds
		mov	ds, word ptr es:[bx+di+8]
		assume ds:nothing
		mov	es, cs:word_12F3E
		mov	di, dx
		xchg	si, di
		mov	ch, 3

loc_10A02:				; CODE XREF: sub_109EC+69j
		mov	cl, 3

loc_10A04:				; CODE XREF: sub_109EC+61j
		movsw
		add	si, 4Eh	; 'N'
		movsw
		add	si, 4Eh	; 'N'
		movsw
		add	si, 4Eh	; 'N'
		movsw
		add	si, 4Eh	; 'N'
		movsw
		add	si, 4Eh	; 'N'
		movsw
		add	si, 4Eh	; 'N'
		movsw
		add	si, 4Eh	; 'N'
		movsw
		add	si, 4Eh	; 'N'
		movsw
		add	si, 4Eh	; 'N'
		movsw
		add	si, 4Eh	; 'N'
		movsw
		add	si, 4Eh	; 'N'
		movsw
		add	si, 4Eh	; 'N'
		movsw
		add	si, 4Eh	; 'N'
		movsw
		add	si, 4Eh	; 'N'
		movsw
		add	si, 4Eh	; 'N'
		movsw
		add	si, 4Eh	; 'N'
		sub	si, 4FEh
		add	di, 60h	; '`'
		dec	cl
		jnz	short loc_10A04
		add	si, 4FAh
		dec	ch
		jnz	short loc_10A02
		pop	ds
		pop	si
		retn
sub_109EC	endp

		assume ds:seg001

; =============== S U B	R O U T	I N E =======================================


sub_10A5A	proc near		; CODE XREF: sub_109A7+3Ep
		mov	cx, 9
		mov	dx, si
		add	dx, 480h

loc_10A63:				; CODE XREF: sub_10A5A+20j
		push	cx
		push	ds
		pop	es
		assume es:seg001
		mov	di, dx
		mov	cx, 10h
		rep movsw
		call	sub_10A87
		call	sub_10A87
		call	sub_10A87
		add	dx, 20h	; ' '
		pop	cx
		loop	loc_10A63
		mov	cx, 90h	; 'ê'

loc_10A7F:				; CODE XREF: sub_10A5A+2Aj
		not	word ptr [si]
		add	si, 2
		loop	loc_10A7F
		retn
sub_10A5A	endp


; =============== S U B	R O U T	I N E =======================================


sub_10A87	proc near		; CODE XREF: sub_10A5A+13p
					; sub_10A5A+16p ...
		mov	di, dx
		mov	cx, 10h

loc_10A8C:				; CODE XREF: sub_10A87+Cj
		lodsw
		or	es:[di], ax
		add	di, 2
		loop	loc_10A8C
		retn
sub_10A87	endp


; =============== S U B	R O U T	I N E =======================================


sVar_IndexedSrc	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	bx, ds:[bp+6]
		mov	bx, es:[bx+di+1Ch]
		add	bx, ds:[bp+4]
		mov	ax, es:[bx+di+1Ch]
		mov	bx, ds:[bp+2]
		mov	es:[bx+di+1Ch],	ax
		add	bp, 8
		retn
sVar_IndexedSrc	endp


; =============== S U B	R O U T	I N E =======================================


sVar_IndexedDst	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	bx, ds:[bp+2]
		mov	ax, es:[bx+di+1Ch]
		mov	bx, ds:[bp+6]
		mov	bx, es:[bx+di+1Ch]
		add	bx, ds:[bp+4]
		mov	es:[bx+di+1Ch],	ax
		add	bp, 8
		retn
sVar_IndexedDst	endp


; =============== S U B	R O U T	I N E =======================================


sub_10ACE	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		call	sub_10AEC
		call	sub_12916
		add	bp, 0Dh
		retn
sub_10ACE	endp


; =============== S U B	R O U T	I N E =======================================


sub_10AD8	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		call	sub_10B36
		call	sub_12916
		add	bp, 12h
		retn
sub_10AD8	endp


; =============== S U B	R O U T	I N E =======================================


sub_10AE2	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		call	sub_10AEC
		call	sub_12AC9
		add	bp, 0Dh
		retn
sub_10AE2	endp


; =============== S U B	R O U T	I N E =======================================


sub_10AEC	proc near		; CODE XREF: sub_10ACEp sub_10AE2p
		mov	al, ds:[bp+2]
		mov	byte_1D21F+1, al
		mov	ax, ds:[bp+4]
		imul	ax, 50h
		xor	dx, dx
		mov	dl, ds:[bp+3]
		add	ax, dx
		mov	word ptr byte_1D21F+2, ax
		mov	dl, ds:[bp+6]
		mov	byte_1D21F+4, dl
		mov	ax, ds:[bp+7]
		mov	word ptr byte_1D21F+6, ax
		mov	al, ds:[bp+9]
		mov	byte_1D21F+8, al
		mov	ax, ds:[bp+0Bh]
		imul	ax, 50h
		mov	dl, ds:[bp+0Ah]
		add	ax, dx
		mov	word ptr byte_1D21F+9, ax
		retn
sub_10AEC	endp


; =============== S U B	R O U T	I N E =======================================


sub_10B2C	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		call	sub_10B36
		call	sub_12AC9
		add	bp, 12h
		retn
sub_10B2C	endp


; =============== S U B	R O U T	I N E =======================================


sub_10B36	proc near		; CODE XREF: sub_10AD8p sub_10B2Cp
		mov	bx, ds:[bp+2]
		mov	ax, es:[bx+di+1Ch]
		mov	byte_1D21F+1, al
		mov	bx, ds:[bp+6]
		mov	ax, es:[bx+di+1Ch]
		imul	ax, 50h
		mov	bx, ds:[bp+4]
		add	ax, es:[bx+di+1Ch]
		mov	word ptr byte_1D21F+2, ax
		mov	bx, ds:[bp+8]
		mov	dx, es:[bx+di+1Ch]
		mov	byte_1D21F+4, dl
		mov	bx, ds:[bp+0Ah]
		mov	ax, es:[bx+di+1Ch]
		mov	word ptr byte_1D21F+6, ax
		mov	bx, ds:[bp+0Ch]
		mov	ax, es:[bx+di+1Ch]
		mov	byte_1D21F+8, al
		mov	bx, ds:[bp+10h]
		mov	ax, es:[bx+di+1Ch]
		imul	ax, 50h
		mov	bx, ds:[bp+0Eh]
		add	ax, es:[bx+di+1Ch]
		mov	word ptr byte_1D21F+9, ax
		retn
sub_10B36	endp


; =============== S U B	R O U T	I N E =======================================


sub_10B90	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	dl, ds:[bp+2]
		mov	byte_1D21F+4, dl
		mov	ax, ds:[bp+3]
		mov	word ptr byte_1D21F+6, ax
		mov	ax, ds:[bp+6]
		imul	ax, 50h
		xor	dx, dx
		mov	dl, ds:[bp+5]
		add	ax, dx
		mov	word ptr byte_1D21F+9, ax
		xor	ax, ax
		mov	byte_1D21F+1, al
		mov	word ptr byte_1D21F+2, ax
		add	bp, 8
		retn
sub_10B90	endp


; =============== S U B	R O U T	I N E =======================================


sub_10BBD	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		xor	byte ptr es:[di+8B7h], 1
		mov	al, es:[di+8B7h]
		mov	byte_1D21F+8, al
		mov	byte_1D21F+1, 2
		mov	bx, ds:[bp+2]
		mov	cx, es:[bx+di+1Ch]
		cmp	cx, 190h
		jnb	short loc_10BEE
		add	cx, word ptr byte_1D21F+6
		cmp	cx, 190h
		ja	short loc_10C17
		mov	cx, es:[bx+di+1Ch]
		jmp	short loc_10BFB
; ---------------------------------------------------------------------------

loc_10BEE:				; CODE XREF: sub_10BBD+1Fj
		mov	byte_1D21F+1, 3
		mov	cx, es:[bx+di+1Ch]
		sub	cx, 190h

loc_10BFB:				; CODE XREF: sub_10BBD+2Fj
		imul	cx, 50h
		mov	word ptr byte_1D21F+2, cx
		call	sub_12916

loc_10C05:				; CODE XREF: sub_10BBD+A2j
		les	di, cs:ScrVariables
		assume es:nothing
		xor	byte ptr es:[di+8B8h], 1
		call	WriteIOA4A6
		add	bp, 4
		retn
; ---------------------------------------------------------------------------

loc_10C17:				; CODE XREF: sub_10BBD+29j
		push	word ptr byte_1D21F+6
		push	word ptr byte_1D21F+9
		sub	cx, 190h
		mov	word ptr byte_1B656+42h, cx
		sub	word ptr byte_1D21F+6, cx
		mov	cx, es:[bx+di+1Ch]
		imul	cx, 50h
		mov	word ptr byte_1D21F+2, cx
		call	sub_12916
		mov	byte_1D21F+1, 3
		mov	ax, word ptr byte_1D21F+6
		imul	ax, 50h
		add	word ptr byte_1D21F+9, ax
		mov	ax, word ptr byte_1B656+42h
		mov	word ptr byte_1D21F+6, ax
		mov	word ptr byte_1D21F+2, 0
		call	sub_12916
		pop	word ptr byte_1D21F+9
		pop	word ptr byte_1D21F+6
		jmp	short loc_10C05
sub_10BBD	endp


; =============== S U B	R O U T	I N E =======================================


sub_10C61	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	bx, ds:[bp+4]
		mov	cx, es:[bx+di+1Ch]
		mov	bx, ds:[bp+2]
		mov	bx, es:[bx+di+1Ch]
		mov	ah, 6
		mov	al, es:[di+8C8h]
		and	al, 1
		int	58h		; IRQ8 relocated by DESQview 2.26+
		add	bp, 6
		retn
sub_10C61	endp


; =============== S U B	R O U T	I N E =======================================


sub_10C80	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	ax, ds:[bp+6]
		mov	word_1B77E, ax
		call	sub_1274B

loc_10C8A:				; CODE XREF: sub_10CF4+86j
		call	sub_1275D
		les	di, cs:ScrVariables
		mov	bx, ds:[bp+4]
		mov	es:[bx+di+1Ch],	ax
		call	sub_10CAE
		mov	bx, ds:[bp+2]
		mov	es:[bx+di+1Ch],	cx
		mov	bp, ds:[bp+8]
		add	bp, 4Ah	; 'J'
		retn
sub_10C80	endp


; =============== S U B	R O U T	I N E =======================================


sub_10CAE	proc near		; CODE XREF: sub_10C80+1Ap
					; sub_10CF4+69p
		push	ax
		push	bx
		push	si
		mov	ah, 3
		int	58h		; IRQ8 relocated by DESQview 2.26+
		mov	si, word_1B77E
		mov	cx, 0FFFFh

loc_10CBC:				; CODE XREF: sub_10CAE+36j
		cmp	word ptr [si+4Ah], 0FFF0h
		jz	short loc_10CE6
		cmp	ax, [si+4Ch]
		jb	short loc_10CE1
		cmp	ax, [si+50h]
		ja	short loc_10CE1
		cmp	bx, [si+4Eh]
		jb	short loc_10CE1
		cmp	bx, [si+52h]
		ja	short loc_10CE1
		mov	cx, [si+4Ah]
		jmp	short loc_10CE6
; ---------------------------------------------------------------------------

loc_10CE1:				; CODE XREF: sub_10CAE+19j
					; sub_10CAE+1Fj ...
		add	si, 0Ah
		jmp	short loc_10CBC
; ---------------------------------------------------------------------------

loc_10CE6:				; CODE XREF: sub_10CAE+13j
					; sub_10CAE+31j
		pop	si
		pop	bx
		pop	ax
		retn
sub_10CAE	endp


; =============== S U B	R O U T	I N E =======================================

; new in DIANA v2

sub_10CEA	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	bx, ds:[bp+6]
		mov	ax, es:[bx+di+1Ch]
		jmp	short loc_10CF8
sub_10CEA	endp


; =============== S U B	R O U T	I N E =======================================


sub_10CF4	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	ax, ds:[bp+6]

loc_10CF8:				; CODE XREF: sub_10CEA+8j
		mov	word_1B77E, ax
		mov	word_1BA14, 0
		push	word_1D096
		mov	word_1D096, 8
		mov	bx, word_1D096
		imul	bx, 0Ch
		mov	ax, ds:[bp+0Ah]
		mov	[bx-6004h], ax
		mov	al, ds:[bp+0Ch]
		mov	[bx-6002h], al
		call	sub_10D7D

loc_10D25:				; CODE XREF: sub_10CF4+6Fj
		mov	[bx-6006h], ax
		call	sub_11B00

loc_10D2C:				; CODE XREF: sub_10CF4+47j
		call	sub_10D7D
		cmp	ax, [bx-6006h]
		jnz	short loc_10D58
		mov	ah, 9
		int	58h		; IRQ8 relocated by DESQview 2.26+
		or	ax, ax
		jz	short loc_10D2C
		mov	word_1BA14, 0FFFFh
		les	di, cs:ScrVariables
		cmp	word ptr es:[di+7A7h], 0
		jnz	short loc_10D70
		push	ax
		call	sub_12844
		pop	ax
		jmp	short loc_10D70
; ---------------------------------------------------------------------------
		nop

loc_10D58:				; CODE XREF: sub_10CF4+3Fj
		push	ax
		call	sub_12844
		pop	ax
		call	sub_10CAE
		cmp	cx, 0FFFFh
		jge	short loc_10D25
		mov	word_1BA14, 0FFFFh
		call	sub_12844
		xor	ax, ax

loc_10D70:				; CODE XREF: sub_10CF4+5Aj
					; sub_10CF4+61j
		mov	word ptr byte_1D107+10h, 0FFFFh
		pop	word_1D096
		jmp	loc_10C8A
sub_10CF4	endp


; =============== S U B	R O U T	I N E =======================================


sub_10D7D	proc near		; CODE XREF: sub_10CF4+2Ep
					; sub_10CF4:loc_10D2Cp
		push	bx
		mov	ah, 3
		int	58h		; IRQ8 relocated by DESQview 2.26+
		shr	ax, 3
		sub	bx, 10h
		imul	bx, 50h
		add	ax, bx
		pop	bx
		retn
sub_10D7D	endp


; =============== S U B	R O U T	I N E =======================================


sub_10D8F	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	al, ds:[bp+2]
		xor	al, 1
		mov	ah, 2
		int	58h		; IRQ8 relocated by DESQview 2.26+
		add	bp, 3
		retn
sub_10D8F	endp


; =============== S U B	R O U T	I N E =======================================


sub_10D9D	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	ah, 3
		int	58h		; IRQ8 relocated by DESQview 2.26+
		mov	dx, bx
		mov	bx, ds:[bp+2]
		mov	es:[bx+di+1Ch],	ax
		mov	bx, ds:[bp+4]
		mov	es:[bx+di+1Ch],	dx
		add	bp, 6
		retn
sub_10D9D	endp


; =============== S U B	R O U T	I N E =======================================


sub_10DB7	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	bx, ds:[bp+2]
		mov	cx, ds:[bp+4]
		mov	ah, 10h
		int	58h		; IRQ8 relocated by DESQview 2.26+
		add	bp, 6
		retn
sub_10DB7	endp


; =============== S U B	R O U T	I N E =======================================


sub_10DC7	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	al, ds:[bp+2]
		mov	ah, 0Bh
		int	58h		; IRQ8 relocated by DESQview 2.26+
		add	bp, 3
		retn
sub_10DC7	endp


; =============== S U B	R O U T	I N E =======================================


sub_10DD3	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		xor	bx, bx
		mov	bl, ds:[bp+2]
		sub	bl, 2
		shl	bx, 4
		mov	si, ds:[bp+3]
		mov	dx, si
		mov	ds, word ptr es:[bx+di+8]
		assume ds:nothing
		mov	es, word ptr es:[di+1Ah]
		mov	di, 0Ah
		call	sub_10E0E
		call	sub_10E0E
		call	sub_10E0E
		call	sub_10E0E
		mov	ds, cs:word_12F3E
		mov	dx, es
		mov	bx, 0Ah
		mov	ah, 0Ch
		int	58h		; IRQ8 relocated by DESQview 2.26+
		add	bp, 5
		retn
sub_10DD3	endp


; =============== S U B	R O U T	I N E =======================================


sub_10E0E	proc near		; CODE XREF: sub_10DD3+1Dp
					; sub_10DD3+20p ...
		mov	si, dx
		mov	ax, [si]
		stosw
		mov	ax, [si+50h]
		stosw
		mov	ax, [si+0A0h]
		stosw
		mov	ax, [si+0F0h]
		stosw
		mov	ax, [si+140h]
		stosw
		mov	ax, [si+190h]
		stosw
		mov	ax, [si+1E0h]
		stosw
		mov	ax, [si+230h]
		stosw
		mov	ax, [si+280h]
		stosw
		mov	ax, [si+2D0h]
		stosw
		mov	ax, [si+320h]
		stosw
		mov	ax, [si+370h]
		stosw
		mov	ax, [si+3C0h]
		stosw
		mov	ax, [si+410h]
		stosw
		mov	ax, [si+460h]
		stosw
		mov	ax, [si+4B0h]
		stosw
		mov	ax, ds
		add	ax, 7D0h
		mov	ds, ax
		assume ds:seg001
		retn
sub_10E0E	endp


; =============== S U B	R O U T	I N E =======================================


sub_10E65	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	bx, ds:[bp+3]
		mov	si, es:[bx+di+1Ch]
		add	si, 4Ah	; 'J'

loc_10E71:				; CODE XREF: sShowText+8j
		xor	bx, bx
		mov	bl, ds:[bp+2]
		and	bl, 7
		mov	word_1D096, bx
		imul	bx, 0Ch
		mov	ax, (word_1D09A+6)[bx]
		mov	di, ax
		call	sub_11D70
		add	bp, 5
		retn
sub_10E65	endp


; =============== S U B	R O U T	I N E =======================================


sSaveCharName	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	ax, 4081h
		mov	ds:86EBh, ax
		mov	word ptr aCharacterName+4, ax
		mov	word ptr aCharacterName+6, ax
		mov	word ptr aCharacterName+8, ax
		mov	word ptr aCharacterName+0Ah, ax
		xor	dx, dx
		xor	bx, bx

loc_10EA4:				; CODE XREF: sSaveCharName+2Bj
		mov	ax, es:[bx+di+751h]
		cmp	ax, 0
		jz	short loc_10EBB
		xchg	ah, al
		mov	word ptr (aCharacterName+2)[bx], ax
		inc	dl
		add	bx, 2
		jmp	short loc_10EA4
; ---------------------------------------------------------------------------

loc_10EBB:				; CODE XREF: sSaveCharName+1Ej
		add	dl, 30h	; '0'
		mov	byte ptr aCharacterName, dl ; "2,êùåÂÅ@Å@Å@ÅyÅ@êùÅ@åÂÅ@Åz \r\n\x1A"
		mov	ax, es:[di+75Fh]
		xchg	ah, al
		mov	word ptr aCharacterName+0Eh, ax
		mov	ax, es:[di+761h]
		xchg	ah, al
		mov	word ptr aCharacterName+10h, ax
		mov	ax, es:[di+763h]
		xchg	ah, al
		mov	word ptr aCharacterName+12h, ax
		mov	ax, es:[di+765h]
		xchg	ah, al
		mov	word ptr aCharacterName+14h, ax
		mov	ax, es:[di+767h]
		xchg	ah, al
		mov	word ptr aCharacterName+16h, ax
		mov	dx, offset aName_txt ; "NAME.TXT"
		mov	ax, 3D02h
		int	21h		; DOS -	2+ - OPEN DISK FILE WITH HANDLE
					; DS:DX	-> ASCIZ filename
					; AL = access mode
					; 2 - read & write
		mov	bx, ax
		mov	cx, 1Eh
		mov	dx, offset aCharacterName ; "2,êùåÂÅ@Å@Å@ÅyÅ@êùÅ@åÂÅ@Åz	\r\n\x1A"
		mov	ah, 40h
		int	21h		; DOS -	2+ - WRITE TO FILE WITH	HANDLE
					; BX = file handle, CX = number	of bytes to write, DS:DX -> buffer
		mov	ah, 3Eh
		int	21h		; DOS -	2+ - CLOSE A FILE WITH HANDLE
					; BX = file handle
		add	bp, 2
		retn
sSaveCharName	endp


; =============== S U B	R O U T	I N E =======================================


sLoadCharName	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	dx, offset aName_txt ; "NAME.TXT"
		mov	ax, 3D02h
		int	21h		; DOS -	2+ - OPEN DISK FILE WITH HANDLE
					; DS:DX	-> ASCIZ filename
					; AL = access mode
					; 2 - read & write
		mov	bx, ax
		mov	cx, 1Eh
		mov	dx, offset aCharacterName ; "2,êùåÂÅ@Å@Å@ÅyÅ@êùÅ@åÂÅ@Åz	\r\n\x1A"
		mov	ah, 3Fh
		int	21h		; DOS -	2+ - READ FROM FILE WITH HANDLE
					; BX = file handle, CX = number	of bytes to read
					; DS:DX	-> buffer
		mov	ah, 3Eh
		int	21h		; DOS -	2+ - CLOSE A FILE WITH HANDLE
					; BX = file handle
		mov	dl, byte ptr aCharacterName ; "2,êùåÂÅ@Å@Å@ÅyÅ@êùÅ@åÂÅ@Åz \r\n\x1A"
		sub	dl, '0'
		xor	bx, bx

loc_10F31:				; CODE XREF: sLoadCharName+35j
		or	dl, dl
		jz	short loc_10F47
		mov	ax, word ptr (aCharacterName+2)[bx]
		xchg	ah, al
		mov	es:[bx+di+751h], ax
		dec	dl
		add	bx, 2
		jmp	short loc_10F31
; ---------------------------------------------------------------------------

loc_10F47:				; CODE XREF: sLoadCharName+23j
		mov	word ptr es:[bx+di+751h], 0
		mov	ax, word ptr aCharacterName+0Eh
		xchg	ah, al
		mov	es:[di+75Fh], ax
		mov	ax, word ptr aCharacterName+10h
		xchg	ah, al
		mov	es:[di+761h], ax
		mov	ax, word ptr aCharacterName+12h
		xchg	ah, al
		mov	es:[di+763h], ax
		mov	ax, word ptr aCharacterName+14h
		xchg	ah, al
		mov	es:[di+765h], ax
		mov	ax, word ptr aCharacterName+16h
		xchg	ah, al
		mov	es:[di+767h], ax
		add	bp, 2
		retn
sLoadCharName	endp


; =============== S U B	R O U T	I N E =======================================


sSaveVarBuf	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	dx, ds:[bp+3]
		add	dx, 4Ah	; 'J'
		xor	cx, cx
		mov	ah, 3Ch	; '<'
		call	sub_10FE9
		mov	ah, 40h
		int	21h		; DOS -	2+ - WRITE TO FILE WITH	HANDLE
					; BX = file handle, CX = number	of bytes to write, DS:DX -> buffer
		mov	ds, cs:word_12F3E
		jnb	short loc_10FD6
		xchg	ah, al
		add	word ptr aDianaWriteError, ax ;	"00 DIANA:èëÇØÇ‹ÇπÇÒÇ≈ÇµÇΩ.\r\n$"
		push	ax
		push	dx
		mov	ah, 9
		mov	dx, offset aDianaWriteError ; "00 DIANA:èëÇØÇ‹ÇπÇÒÇ≈ÇµÇΩ.\r\n$"
		int	21h		; DOS -	PRINT STRING
					; DS:DX	-> string terminated by	"$"
		pop	dx
		pop	ax
		mov	ah, 4Ch
		int	21h		; DOS -	2+ - QUIT WITH EXIT CODE (EXIT)
sSaveVarBuf	endp			; AL = exit code


; =============== S U B	R O U T	I N E =======================================


sLoadVarBuf	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		call	sub_10FDE
		mov	ah, 3Fh
		int	21h		; DOS -	2+ - READ FROM FILE WITH HANDLE
					; BX = file handle, CX = number	of bytes to read
					; DS:DX	-> buffer
		mov	ds, cs:word_12F3E
		jnb	short loc_10FD6
		xchg	ah, al
		add	word ptr aDianaReadError, ax ; "00 DIANA:ì«ÇﬂÇ‹ÇπÇÒÇ≈ÇµÇΩ.\r\n$"
		push	ax
		push	dx
		mov	ah, 9
		mov	dx, offset aDianaReadError ; "00 DIANA:ì«ÇﬂÇ‹ÇπÇÒÇ≈ÇµÇΩ.\r\n$"
		int	21h		; DOS -	PRINT STRING
					; DS:DX	-> string terminated by	"$"
		pop	dx
		pop	ax
		mov	ah, 4Ch
		int	21h		; DOS -	2+ - QUIT WITH EXIT CODE (EXIT)
					; AL = exit code
; ---------------------------------------------------------------------------

loc_10FD6:				; CODE XREF: sSaveVarBuf+18j
					; sLoadVarBuf+Cj
		mov	ah, 3Eh
		int	21h		; DOS -	2+ - CLOSE A FILE WITH HANDLE
					; BX = file handle
		add	bp, 5
		retn
sLoadVarBuf	endp


; =============== S U B	R O U T	I N E =======================================


sub_10FDE	proc near		; CODE XREF: sLoadVarBufp
		mov	dx, ds:[bp+3]
		add	dx, 4Ah
		mov	ax, 3D02h
sub_10FDE	endp ; sp-analysis failed


; =============== S U B	R O U T	I N E =======================================


sub_10FE9	proc near		; CODE XREF: sSaveVarBuf+Cp
		int	21h		; DOS -	2+ - OPEN DISK FILE WITH HANDLE
					; DS:DX	-> ASCIZ filename
					; AL = access mode
					; 2 - read & write
		jnb	short loc_11002
		xchg	ah, al
		add	word ptr aDianaOpenError, ax ; "00 DIANA:äJÇØÇ‹ÇπÇÒÇ≈ÇµÇΩ.\r\n$"
		push	ax
		push	dx
		mov	ah, 9
		mov	dx, offset aDianaOpenError ; "00 DIANA:äJÇØÇ‹ÇπÇÒÇ≈ÇµÇΩ.\r\n$"
		int	21h		; DOS -	PRINT STRING
					; DS:DX	-> string terminated by	"$"
		pop	dx
		pop	ax
		mov	ah, 4Ch
		int	21h		; DOS -	2+ - QUIT WITH EXIT CODE (EXIT)
					; AL = exit code
; ---------------------------------------------------------------------------

loc_11002:				; CODE XREF: sub_10FE9+2j
		mov	fileHandle, ax
		mov	bx, fileHandle
		les	dx, cs:ScrVariables
		add	dx, 1Ch
		mov	cx, 4B0h
		cmp	byte ptr ds:[bp+2], 1
		jnz	short loc_11022
		add	dx, 4B0h
		mov	cx, 43Ah

loc_11022:				; CODE XREF: sub_10FE9+30j
		mov	ds, word ptr cs:ScrVariables+2
		assume ds:nothing
		retn
sub_10FE9	endp


; =============== S U B	R O U T	I N E =======================================


sub_11028	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	bx, ds:[bp+2]
		mov	cx, ds:[bp+4]
		mov	ah, 6
		mov	al, es:[di+8C8h]
		and	al, 1
		int	58h		; IRQ8 relocated by DESQview 2.26+
		add	bp, 6
		retn
sub_11028	endp


; =============== S U B	R O U T	I N E =======================================

; new in DIANA v2

sLoadSubScene	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	dx, ds:[bp+2]
		add	dx, 4Ah	; 'J'
		push	bp
		mov	word ptr ds:851Ah, 4650h
		call	LoadSceneMain
		mov	word ptr ds:851Ah, 0
		pop	bp
		add	bp, 4
		retn
sLoadSubScene	endp


; =============== S U B	R O U T	I N E =======================================


nullsub_1	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		retn
nullsub_1	endp

		assume ds:seg001

; =============== S U B	R O U T	I N E =======================================


sSFX_PlayFM	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	al, ds:[bp+2]
		call	CallSndDrv_SFX
		add	bp, 3
		retn
sSFX_PlayFM	endp


; =============== S U B	R O U T	I N E =======================================


sBGM_GetState	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		cmp	word ptr es:[di+8B4h], 3
		jb	short loc_11074
		mov	ah, 5
		jmp	short loc_11076
; ---------------------------------------------------------------------------

loc_11074:				; CODE XREF: sBGM_GetState+6j
		mov	ah, 0Ah

loc_11076:				; CODE XREF: sBGM_GetState+Aj
		call	CallSndDrv_BGM
		mov	bx, ds:[bp+2]
		and	es:[bx+di+1Ch],	ax
		add	bp, 4
		retn
sBGM_GetState	endp


; =============== S U B	R O U T	I N E =======================================


sAndVar_Val	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	ax, ds:[bp+4]
		mov	bx, ds:[bp+2]
		and	es:[bx+di+1Ch],	ax
		add	bp, 6
		retn
sAndVar_Val	endp


; =============== S U B	R O U T	I N E =======================================


sOrVar_Val	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	ax, ds:[bp+4]
		mov	bx, ds:[bp+2]
		or	es:[bx+di+1Ch],	ax
		add	bp, 6
		retn
sOrVar_Val	endp


; =============== S U B	R O U T	I N E =======================================


sub_110A5	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	al, ds:[bp+2]
		mov	es:[di+72Dh], al
		add	bp, 5
		mov	es:[di+74Fh], bp
		sub	bp, 2
		retn
sub_110A5	endp


; =============== S U B	R O U T	I N E =======================================


sCall		proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		add	scrStackPtr, 2
		mov	bx, scrStackPtr
		mov	scrStackPtr[bx], bp
		jmp	sJumpAbs
sCall		endp

; ---------------------------------------------------------------------------
		retn

; =============== S U B	R O U T	I N E =======================================


sReturn		proc near		; CODE XREF: ScriptMainLoop+6Bp
					; sReturnScene+6j
					; DATA XREF: ...
		mov	bx, scrStackPtr
		mov	bp, scrStackPtr[bx]
		sub	scrStackPtr, 2
		add	bp, 4
		retn
sReturn		endp


; =============== S U B	R O U T	I N E =======================================


sCallCommon	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		add	scrStackPtr, 2
		mov	bx, scrStackPtr
		sub	bp, 2
		mov	scrStackPtr[bx], bp
		mov	bp, 469Ah
		retn
sCallCommon	endp


; =============== S U B	R O U T	I N E =======================================


sLoopInitVal	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	ax, ds:[bp+2]
		jmp	short loc_1111A
sLoopInitVal	endp


; =============== S U B	R O U T	I N E =======================================


sLoopGet	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	ax, es:[di+8BBh]
		mov	bx, ds:[bp+2]
		mov	es:[bx+di+1Ch],	ax
		add	bp, 4
		retn
sLoopGet	endp


; =============== S U B	R O U T	I N E =======================================


sLoopJumpVal	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	ax, es:[di+8BBh]
		cmp	ax, ds:[bp+2]
		jmp	short loc_11130
sLoopJumpVal	endp


; =============== S U B	R O U T	I N E =======================================


sLoopInitVar	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	bx, ds:[bp+2]
		mov	ax, es:[bx+di+1Ch]

loc_1111A:				; CODE XREF: sLoopInitVal+4j
		mov	es:[di+8BBh], ax
		add	bp, 4
		retn
sLoopInitVar	endp


; =============== S U B	R O U T	I N E =======================================


sLoopJumpVar	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	bx, ds:[bp+2]
		mov	ax, es:[di+8BBh]
		cmp	ax, es:[bx+di+1Ch]

loc_11130:				; CODE XREF: sLoopJumpVal+9j
		jnb	short loc_1113B
		mov	bp, ds:[bp+4]
		add	bp, 4Ah	; 'J'
		retn
; ---------------------------------------------------------------------------

loc_1113B:				; CODE XREF: sLoopJumpVar:loc_11130j
		add	bp, 6
		retn
sLoopJumpVar	endp


; =============== S U B	R O U T	I N E =======================================


sCallScene	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	si, offset aCurSceneFile ; "BEGIN.DSD"
		mov	cx, 10h

loc_11145:				; CODE XREF: sCallScene+Aj
		lodsw
		mov	word ptr (aPrevSceneFile-0Ch)[si], ax ;	"BEGIN.DSD"
		loop	loc_11145
		add	scrStackPtr, 2
		mov	bx, scrStackPtr
		mov	scrStackPtr[bx], bp
		mov	dx, ds:[bp+2]
		add	dx, 4Ah
		jmp	LoadSceneMain
sCallScene	endp


; =============== S U B	R O U T	I N E =======================================


sReturnScene	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	dx, offset aPrevSceneFile ; v2 BUGFIX: now using the correct file name
		call	LoadSceneMain
		jmp	sReturn
sReturnScene	endp


; =============== S U B	R O U T	I N E =======================================


sSomethingClear	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	al, ds:[bp+2]
		out	0A6h, al	; Interrupt Controller #2, 8259A
		mov	si, ds:[bp+5]
		imul	si, 50h
		add	si, ds:[bp+3]
		mov	bx, ds:[bp+7]
		mov	dx, ds:[bp+9]
		call	loc_12F55
		add	bp, 0Bh
		les	di, cs:ScrVariables
		call	WriteIOA6
		retn
sSomethingClear	endp


; =============== S U B	R O U T	I N E =======================================


sStr_SetDate	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	ah, 2Ah
		int	21h		; DOS -	GET CURRENT DATE
					; Return: DL = day, DH = month,	CX = year
					; AL = day of the week (0=Sunday, 1=Monday, etc.)
		mov	ax, cx
		sub	ax, 76Ch
		mov	bx, ds:[bp+2]
		call	Date2SceneMem
		mov	ah, 2Ch
		int	21h		; DOS -	GET CURRENT TIME
					; Return: CH = hours, CL = minutes, DH = seconds
					; DL = hundredths of seconds
		call	Time2SceneMem
		add	bp, 4
		retn
sStr_SetDate	endp


; =============== S U B	R O U T	I N E =======================================


Date2SceneMem	proc near		; CODE XREF: sStr_SetDate+Dp
					; sGetFileDate+41p
		aam
		add	ax, 4F4Fh
		mov	[bx+4Fh], ah
		mov	[bx+51h], al
		mov	al, dh
		aam
		add	ax, 4F4Fh
		mov	[bx+55h], ah
		mov	[bx+57h], al
		mov	al, dl
		aam
		add	ax, 4F4Fh
		mov	[bx+5Bh], ah
		mov	[bx+5Dh], al
		retn
Date2SceneMem	endp


; =============== S U B	R O U T	I N E =======================================


Time2SceneMem	proc near		; CODE XREF: sStr_SetDate+14p
					; sGetFileDate+53p
		mov	al, ch
		aam
		add	ax, 4F4Fh
		mov	[bx+61h], ah
		mov	[bx+63h], al
		mov	al, cl
		aam
		add	ax, 4F4Fh
		mov	[bx+67h], ah
		mov	[bx+69h], al
		mov	al, dh
		aam
		add	ax, 4F4Fh
		mov	[bx+6Dh], ah
		mov	[bx+6Fh], al
		retn
Time2SceneMem	endp


; =============== S U B	R O U T	I N E =======================================


sGetFileDate	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	dx, ds:[bp+6]
		add	dx, 4Ah
		mov	ax, 3D00h
		int	21h		; DOS -	2+ - OPEN DISK FILE WITH HANDLE
					; DS:DX	-> ASCIZ filename
					; AL = access mode
					; 0 - read
		jnb	short loc_11222
		mov	bx, ds:[bp+2]
		mov	es:[bx+di+1Ch],	ax
		jmp	short loc_11271
; ---------------------------------------------------------------------------

loc_11222:				; CODE XREF: sGetFileDate+Dj
		mov	fileHandle, ax
		mov	bx, fileHandle
		mov	ax, 5700h
		int	21h		; DOS -	2+ - GET FILE'S DATE/TIME
					; BX = file handle
		mov	bx, ds:[bp+4]
		xchg	cx, dx
		mov	si, dx
		mov	al, ch
		shr	al, 1
		add	al, 80
		mov	dx, cx
		and	dx, 1E0h
		shl	dx, 3
		mov	dl, cl
		and	dl, 1Fh
		call	Date2SceneMem
		mov	ax, si
		mov	cx, ax
		shr	cx, 3
		shr	cl, 2
		mov	dh, al
		and	dh, 1Fh
		call	Time2SceneMem
		mov	bx, ds:[bp+2]
		mov	word ptr es:[bx+di+1Ch], 0
		mov	bx, fileHandle
		mov	ah, 3Eh
		int	21h		; DOS -	2+ - CLOSE A FILE WITH HANDLE
					; BX = file handle

loc_11271:				; CODE XREF: sGetFileDate+17j
		add	bp, 8
		retn
sGetFileDate	endp


; =============== S U B	R O U T	I N E =======================================


sub_11275	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	dx, ds:[bp+2]
		add	dx, 4Ah
		call	OpenFileForRead
		call	ReadFileSomething2
		mov	ah, 3Eh
		int	21h		; DOS -	2+ - CLOSE A FILE WITH HANDLE
					; BX = file handle
		add	bp, 4
		retn
sub_11275	endp


; =============== S U B	R O U T	I N E =======================================


sub_1128B	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	bx, ds:[bp+2]
		mov	ax, es:[bx+di+1Ch]
		mov	word_1D21B, ax
		mov	bx, ds:[bp+4]
		mov	ax, es:[bx+di+1Ch]
		mov	word_1D21D, ax
		call	sub_11D01
		add	bp, 6
		retn
sub_1128B	endp


; =============== S U B	R O U T	I N E =======================================


sub_112A8	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	bx, ds:[bp+4]
		mov	ax, es:[bx+di+1Ch]
		mov	cs:word_12EF4, ax
		mov	bx, ds:[bp+2]
		mov	ax, es:[bx+di+1Ch]
		imul	ax, 50h
		mov	cs:word_12EF6, ax
		mov	dx, es:[di+1Ah]
		mov	al, es:[di+8B7h]
		mov	byte ptr cs:word_12EF8,	al
		call	sub_112D7
		add	bp, 6
		retn
sub_112A8	endp


; =============== S U B	R O U T	I N E =======================================


sub_112D7	proc near		; CODE XREF: sub_112A8+28p
		push	ds

loc_112D8:				; CODE XREF: sub_112D7+24j
		mov	bx, 0A800h
		call	sub_112FF
		mov	bx, 0B000h
		call	sub_112FF
		mov	bx, 0B800h
		call	sub_112FF
		mov	bx, 0E000h
		call	sub_112FF
		add	cs:word_12EF6, 50h ; 'P'
		dec	cs:word_12EF4
		jnz	short loc_112D8
		pop	ds
		assume ds:nothing
		retn
sub_112D7	endp


; =============== S U B	R O U T	I N E =======================================


sub_112FF	proc near		; CODE XREF: sub_112D7+4p sub_112D7+Ap ...
		mov	cx, 28h	; '('
		mov	ds, bx
		mov	si, cs:word_12EF6
		mov	es, dx
		xor	di, di
		rep movsw
		mov	al, byte ptr cs:word_12EF8
		xor	al, 1
		out	0A6h, al	; Interrupt Controller #2, 8259A
		mov	si, cs:word_12EF6
		xor	di, di
		mov	cx, 28h	; '('

loc_11321:				; CODE XREF: sub_112FF+2Cj
		lodsw
		xchg	ax, es:[di]
		mov	[si-2],	ax
		add	di, 2
		loop	loc_11321
		mov	al, byte ptr cs:word_12EF8
		out	0A6h, al	; Interrupt Controller #2, 8259A
		mov	cx, 28h	; '('
		mov	es, bx
		mov	di, cs:word_12EF6
		xor	si, si
		mov	ds, dx
		rep movsw
		retn
sub_112FF	endp


; =============== S U B	R O U T	I N E =======================================


sub_11344	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		cli
		mov	byte ptr es:[di+724h], 0
		mov	ax, ds:[bp+2]
		add	ax, 4Ah	; 'J'
		mov	es:[di+729h], ax
		mov	es:[di+727h], ax
		mov	word ptr es:[di+72Bh], ds
		sti
		add	bp, 4
		retn
sub_11344	endp


; =============== S U B	R O U T	I N E =======================================


sub_11366	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	bx, ds:[bp+2]
		mov	cx, ds:[bp+6]
		mov	ah, 7
		int	58h		; IRQ8 relocated by DESQview 2.26+
		mov	bx, ds:[bp+4]
		mov	cx, ds:[bp+8]
		mov	ah, 8
		int	58h		; IRQ8 relocated by DESQview 2.26+
		add	bp, 0Ah
		retn
sub_11366	endp


; =============== S U B	R O U T	I N E =======================================


sub_11382	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	bx, ds:[bp+6]
		mov	cx, es:[bx+di+1Ch]
		mov	bx, ds:[bp+2]
		mov	bx, es:[bx+di+1Ch]
		mov	ah, 7
		int	58h		; IRQ8 relocated by DESQview 2.26+
		les	di, cs:ScrVariables
		mov	bx, ds:[bp+8]
		mov	cx, es:[bx+di+1Ch]
		mov	bx, ds:[bp+4]
		mov	bx, es:[bx+di+1Ch]
		mov	ah, 8
		int	58h		; IRQ8 relocated by DESQview 2.26+
		add	bp, 0Ah
		retn
sub_11382	endp


; =============== S U B	R O U T	I N E =======================================


sub_113B3	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		mov	al, ds:[bp+2]
		mov	es:[di+8C5h], al
		add	bp, 3
		retn
sub_113B3	endp


; =============== S U B	R O U T	I N E =======================================


sub_113C0	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		xor	bx, bx
		mov	cx, 8

loc_113C5:				; CODE XREF: sub_113C0+16j
		mov	ax, ds:[bp+2]
		xchg	ah, al
		mov	es:[bx+di+787h], ax
		add	bx, 4
		add	bp, 2
		loop	loc_113C5
		add	bp, 2
		retn
sub_113C0	endp


; =============== S U B	R O U T	I N E =======================================


sub_113DC	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		xor	bx, bx

loc_113DE:				; CODE XREF: sub_113DC+14j
		mov	cx, 8
		mov	ax, ds:[bp+2]
		mov	es:[bx+di+775h], ax
		add	bx, 2
		add	bp, 2
		loop	loc_113DE
		add	bp, 2
		retn
sub_113DC	endp


; =============== S U B	R O U T	I N E =======================================


sInvalid	proc near		; CODE XREF: ScriptMainLoop+6Bp
					; DATA XREF: seg001:scriptFuncListo
		push	ax
		push	dx
		mov	ah, 9
		mov	dx, offset aDontComeHere ; "ÅcÇ±Ç±Ç…ÇÕóàÇ»Ç¢Ç≈.\r\n$"
		int	21h		; DOS -	PRINT STRING
					; DS:DX	-> string terminated by	"$"
		pop	dx
		pop	ax
		push	ax
		mov	ah, 8
		int	21h		; DOS -	KEYBOARD INPUT,	NO ECHO
					; Return: AL = character
		pop	ax
		retn
sInvalid	endp

; ---------------------------------------------------------------------------
word_11408	dw 0			; DATA XREF: sub_1141F+15w
					; sub_11451+38r
word_1140A	dw 0			; DATA XREF: sub_11451+3Dr
word_1140C	dw 0			; DATA XREF: sub_1141F+20r
					; sub_11451+Fr	...
word_1140E	dw 0A800h		; DATA XREF: sub_1170B+A7r
word_11410	dw 0B000h		; DATA XREF: sub_1170B+AFr
word_11412	dw 0B800h		; DATA XREF: sub_1170B+B7r
word_11414	dw 0E000h		; DATA XREF: sub_1170B+BFr
word_11416	dw 260h			; DATA XREF: sub_1170B:loc_117F9r
					; sub_11836+3r	...
word_11418	dw 0			; DATA XREF: sub_11451w sub_1170B+F7r
		align 4
archiveID	db 0			; DATA XREF: fopen_read:loc_119ECw
					; fopen_read+3Aw ...
fileSize	dw 0			; DATA XREF: sBGM_Play+1Dr
					; sub_11836+Fr	...

; =============== S U B	R O U T	I N E =======================================

; Attributes: noreturn

sub_1141F	proc near		; CODE XREF: sLoadImage+89p
		push	ax
		push	bx
		push	cx
		push	dx
		push	si
		push	di
		push	bp
		push	ds
		push	es
		push	cs
		pop	es
		assume es:seg000
		mov	si, bx
		mov	di, 1408h
		mov	cx, 7
		rep movsw
		shl	cs:word_11408, 3
		mov	es, cs:word_12F3E
		assume es:nothing
		mov	ds, cs:word_1140C
		assume ds:nothing
		call	sub_11451
sub_1141F	endp

; ---------------------------------------------------------------------------
		pop	es
		pop	ds
		assume ds:nothing
		pop	bp
		pop	di
		pop	si
		pop	dx
		pop	cx
		pop	bx
		pop	ax
		retn

; =============== S U B	R O U T	I N E =======================================

; Attributes: noreturn

sub_11451	proc near		; CODE XREF: sub_1141F+25p
		mov	cs:word_11418, sp
		mov	bp, ax
		mov	ds, cs:word_12F3E
		call	OpenFileForRead
		mov	ds, cs:word_1140C
		assume ds:nothing
		mov	es, cs:word_1140C
		assume es:nothing
		call	sub_11836
		mov	si, bx
		lodsw
		cmp	ax, 6950h
		jnz	short loc_11483

loc_11475:				; CODE XREF: sub_11451+27j
		lodsb
		or	al, al
		jnz	short loc_11475
		add	si, 8
		lodsw
		xchg	ah, al
		add	si, ax
		lodsw

loc_11483:				; CODE XREF: sub_11451+22j
		xchg	ah, al
		mov	ds:100h, ax
		push	ax
		mov	cx, cs:word_11408
		mov	ax, cs:word_1140A
		shr	cx, 3
		shl	ax, 4
		add	cx, ax
		shl	ax, 2
		add	cx, ax
		mov	ds:106h, cx
		pop	ax
		mov	cx, ax
		shl	cx, 1
		neg	ax
		mov	ds:10Eh, ax
		inc	ax
		mov	ds:110h, ax
		mov	ax, cx
		neg	ax
		mov	ds:112h, ax
		mov	ax, cx
		mov	dx, ax
		add	ax, 114h
		mov	ds:108h, ax
		shl	cx, 2
		mov	ds:104h, cx
		add	ax, cx
		mov	ds:10Ah, ax
		sub	ax, dx
		mov	ds:10Ch, ax
		lodsw
		xchg	ah, al
		mov	ds:102h, ax
		push	es
		mov	es, cs:word_12F3E
		assume es:nothing
		mov	cx, 10h
		mov	di, 879Fh

loc_114E5:				; CODE XREF: sub_11451+AEj
		lodsb
		shr	al, 4
		mov	es:[di+1], al
		lodsb
		shr	al, 4
		mov	es:[di], al
		lodsb
		shr	al, 4
		mov	es:[di+2], al
		add	di, 3
		loop	loc_114E5
		pop	es
		mov	bx, si
		test	bp, 1
		jz	short loc_1151A
		push	ax
		push	cx
		push	si
		push	ds
		mov	ds, cs:word_12F3E
		assume ds:nothing
		call	sub_11886
		pop	ds
		pop	si
		pop	cx
		pop	ax

loc_1151A:				; CODE XREF: sub_11451+B7j
		call	sub_116F7
		mov	dh, 1
		mov	di, 114h
		xor	al, al
		call	sub_11630
		mov	cx, ds:100h
		rep stosw
		xor	bp, bp
		jmp	short loc_1155F
; ---------------------------------------------------------------------------
		align 2

loc_11532:				; CODE XREF: sub_11451+117j
		dec	dh
		jnz	short loc_11539
		call	sub_1182A

loc_11539:				; CODE XREF: sub_11451+E3j
		shl	dl, 1
		mov	si, ds:112h
		jnb	short loc_11583
		dec	dh
		jnz	short loc_11548
		call	sub_1182A

loc_11548:				; CODE XREF: sub_11451+F2j
		shl	dl, 1
		mov	si, ds:110h
		jnb	short loc_11583
		sub	si, 2
		jmp	short loc_11583
; ---------------------------------------------------------------------------

loc_11555:				; CODE XREF: sub_11451+143j
		movsw
		cmp	di, ds:10Ah
		jnz	short loc_1155F
		call	sub_1170B

loc_1155F:				; CODE XREF: sub_11451+DEj
					; sub_11451+109j ...
		dec	dh
		jnz	short loc_11566
		call	sub_1182A

loc_11566:				; CODE XREF: sub_11451+110j
		shl	dl, 1
		jb	short loc_11532
		dec	dh
		jnz	short loc_11571
		call	sub_1182A

loc_11571:				; CODE XREF: sub_11451+11Bj
		shl	dl, 1
		mov	si, ds:10Eh
		jb	short loc_11583
		mov	si, 0FFFCh
		mov	ax, [di-2]
		cmp	ah, al
		jz	short loc_115C7

loc_11583:				; CODE XREF: sub_11451+EEj
					; sub_11451+FDj ...
		cmp	si, bp
		jz	short loc_115D2
		mov	bp, si
		add	si, di

loc_1158B:				; CODE XREF: sub_11451+17Fj
		dec	dh
		jnz	short loc_11592
		call	sub_1182A

loc_11592:				; CODE XREF: sub_11451+13Cj
		shl	dl, 1
		jnb	short loc_11555
		mov	ax, 1
		xor	cx, cx

loc_1159B:				; CODE XREF: sub_11451+154j
		inc	cx
		dec	dh
		jnz	short loc_115A3
		call	sub_1182A

loc_115A3:				; CODE XREF: sub_11451+14Dj
		shl	dl, 1
		jb	short loc_1159B

loc_115A7:				; CODE XREF: sub_11451+161j
		dec	dh
		jnz	short loc_115AE
		call	sub_1182A

loc_115AE:				; CODE XREF: sub_11451+158j
		shl	dl, 1
		rcl	ax, 1
		loop	loc_115A7
		jb	short loc_11604

loc_115B6:				; CODE XREF: sub_11451+1B1j
					; sub_11451+1BCj ...
		mov	cx, ax
		mov	ax, ds:10Ah
		sub	ax, di
		shr	ax, 1
		cmp	cx, ax
		jnb	short loc_115F6
		rep movsw
		jmp	short loc_1155F
; ---------------------------------------------------------------------------

loc_115C7:				; CODE XREF: sub_11451+130j
		cmp	si, bp
		jz	short loc_115D2
		mov	bp, si
		lea	si, [di-2]
		jmp	short loc_1158B
; ---------------------------------------------------------------------------

loc_115D2:				; CODE XREF: sub_11451+134j
					; sub_11451+178j
		mov	al, [di-1]

loc_115D5:				; CODE XREF: sub_11451+199j
		call	sub_11630
		stosw
		mov	al, ah
		cmp	di, ds:10Ah
		jz	short loc_115F1

loc_115E1:				; CODE XREF: sub_11451+1A3j
		dec	dh
		jnz	short loc_115E8
		call	sub_1182A

loc_115E8:				; CODE XREF: sub_11451+192j
		shl	dl, 1
		jb	short loc_115D5
		xor	bp, bp
		jmp	loc_1155F
; ---------------------------------------------------------------------------

loc_115F1:				; CODE XREF: sub_11451+18Ej
		call	sub_1170B
		jmp	short loc_115E1
; ---------------------------------------------------------------------------

loc_115F6:				; CODE XREF: sub_11451+170j
		sub	cx, ax
		xchg	ax, cx
		rep movsw
		call	sub_1170B
		sub	si, ds:104h
		jmp	short loc_115B6
; ---------------------------------------------------------------------------

loc_11604:				; CODE XREF: sub_11451+163j
		xor	cx, cx

loc_11606:				; CODE XREF: sub_11451+1BAj
					; sub_11451+1C7j
		movsw
		cmp	di, ds:10Ah
		loopne	loc_11606
		jnz	short loc_115B6
		call	sub_1170B
		sub	si, ds:104h
		jcxz	short loc_115B6
		jmp	short loc_11606
sub_11451	endp

; ---------------------------------------------------------------------------
; START	OF FUNCTION CHUNK FOR sub_11630

loc_1161A:				; CODE XREF: sub_11630+Fj
		dec	dh
		jnz	short loc_11621
		call	sub_1182A

loc_11621:				; CODE XREF: sub_11630-14j
		shl	dl, 1
		jb	short loc_11628
		lodsb
		jmp	short loc_11685
; ---------------------------------------------------------------------------

loc_11628:				; CODE XREF: sub_11630-Dj
		mov	ax, [si]
		xchg	ah, al
		mov	[si], ax
		jmp	short loc_11685
; END OF FUNCTION CHUNK	FOR sub_11630

; =============== S U B	R O U T	I N E =======================================


sub_11630	proc near		; CODE XREF: sub_11451+D3p
					; sub_11451:loc_115D5p

; FUNCTION CHUNK AT 161A SIZE 00000016 BYTES

		mov	bp, di
		xor	ah, ah
		mov	si, ax
		dec	dh
		jnz	short loc_1163D
		call	sub_1182A

loc_1163D:				; CODE XREF: sub_11630+8j
		shl	dl, 1
		jb	short loc_1161A
		dec	dh
		jnz	short loc_11648
		call	sub_1182A

loc_11648:				; CODE XREF: sub_11630+13j
		shl	dl, 1
		mov	cx, 1
		jnb	short loc_11670
		dec	dh
		jnz	short loc_11656
		call	sub_1182A

loc_11656:				; CODE XREF: sub_11630+21j
		shl	dl, 1
		jnb	short loc_11665
		dec	dh
		jnz	short loc_11661
		call	sub_1182A

loc_11661:				; CODE XREF: sub_11630+2Cj
		shl	dl, 1
		rcl	cx, 1

loc_11665:				; CODE XREF: sub_11630+28j
		dec	dh
		jnz	short loc_1166C
		call	sub_1182A

loc_1166C:				; CODE XREF: sub_11630+37j
		shl	dl, 1
		rcl	cx, 1

loc_11670:				; CODE XREF: sub_11630+1Dj
		dec	dh
		jnz	short loc_11677
		call	sub_1182A

loc_11677:				; CODE XREF: sub_11630+42j
		shl	dl, 1
		rcl	cx, 1
		add	si, cx
		std
		lodsb
		lea	di, [si+1]
		rep movsb
		stosb

loc_11685:				; CODE XREF: sub_11630-Aj sub_11630-2j
		xor	ah, ah
		mov	si, ax
		dec	dh
		jnz	short loc_11690
		call	sub_1182A

loc_11690:				; CODE XREF: sub_11630+5Bj
		shl	dl, 1
		jb	short loc_116E0
		dec	dh
		jnz	short loc_1169B
		call	sub_1182A

loc_1169B:				; CODE XREF: sub_11630+66j
		shl	dl, 1
		mov	cx, 1
		jnb	short loc_116C3
		dec	dh
		jnz	short loc_116A9
		call	sub_1182A

loc_116A9:				; CODE XREF: sub_11630+74j
		shl	dl, 1
		jnb	short loc_116B8
		dec	dh
		jnz	short loc_116B4
		call	sub_1182A

loc_116B4:				; CODE XREF: sub_11630+7Fj
		shl	dl, 1
		rcl	cx, 1

loc_116B8:				; CODE XREF: sub_11630+7Bj
		dec	dh
		jnz	short loc_116BF
		call	sub_1182A

loc_116BF:				; CODE XREF: sub_11630+8Aj
		shl	dl, 1
		rcl	cx, 1

loc_116C3:				; CODE XREF: sub_11630+70j
		dec	dh
		jnz	short loc_116CA
		call	sub_1182A

loc_116CA:				; CODE XREF: sub_11630+95j
		shl	dl, 1
		rcl	cx, 1
		add	si, cx
		std
		mov	ah, al
		lodsb
		lea	di, [si+1]
		rep movsb
		stosb
		xchg	ah, al
		mov	di, bp
		cld
		retn
; ---------------------------------------------------------------------------

loc_116E0:				; CODE XREF: sub_11630+62j
		dec	dh
		jnz	short loc_116E7
		call	sub_1182A

loc_116E7:				; CODE XREF: sub_11630+B2j
		shl	dl, 1
		jnb	short loc_116F1
		mov	cx, [si]
		xchg	ch, cl
		mov	[si], cx

loc_116F1:				; CODE XREF: sub_11630+B9j
		mov	ah, [si]
		mov	di, bp
		cld
		retn
sub_11630	endp


; =============== S U B	R O U T	I N E =======================================


sub_116F7	proc near		; CODE XREF: sub_11451:loc_1151Ap
		xor	di, di
		mov	ax, 1000h

loc_116FC:				; CODE XREF: sub_116F7+11j
		mov	cx, 10h

loc_116FF:				; CODE XREF: sub_116F7+Bj
		stosb
		sub	al, 10h
		loop	loc_116FF
		add	al, 10h
		dec	ah
		jnz	short loc_116FC
		retn
sub_116F7	endp


; =============== S U B	R O U T	I N E =======================================


sub_1170B	proc near		; CODE XREF: sub_11451+10Bp
					; sub_11451:loc_115F1p	...
		push	ax
		push	bx
		push	cx
		push	dx
		push	si
		push	bp
		mov	si, ds:10Ch
		mov	di, 114h
		mov	cx, ds:100h
		rep movsw
		mov	si, di
		mov	cx, 8

loc_11723:				; CODE XREF: sub_1170B+DBj
		mov	di, ds:106h
		mov	bp, ds:100h
		shr	bp, 3

loc_1172E:				; CODE XREF: sub_1170B+CAj
		lodsw
		shl	al, 1
		rcl	bl, 1
		shl	ah, 1
		rcl	bl, 1
		shl	al, 1
		rcl	bh, 1
		shl	ah, 1
		rcl	bh, 1
		shl	al, 1
		rcl	dl, 1
		shl	ah, 1
		rcl	dl, 1
		shl	al, 1
		rcl	dh, 1
		shl	ah, 1
		rcl	dh, 1
		lodsw
		shl	al, 1
		rcl	bl, 1
		shl	ah, 1
		rcl	bl, 1
		shl	al, 1
		rcl	bh, 1
		shl	ah, 1
		rcl	bh, 1
		shl	al, 1
		rcl	dl, 1
		shl	ah, 1
		rcl	dl, 1
		shl	al, 1
		rcl	dh, 1
		shl	ah, 1
		rcl	dh, 1
		lodsw
		shl	al, 1
		rcl	bl, 1
		shl	ah, 1
		rcl	bl, 1
		shl	al, 1
		rcl	bh, 1
		shl	ah, 1
		rcl	bh, 1
		shl	al, 1
		rcl	dl, 1
		shl	ah, 1
		rcl	dl, 1
		shl	al, 1
		rcl	dh, 1
		shl	ah, 1
		rcl	dh, 1
		lodsw
		shl	al, 1
		rcl	bl, 1
		shl	ah, 1
		rcl	bl, 1
		shl	al, 1
		rcl	bh, 1
		shl	ah, 1
		rcl	bh, 1
		shl	al, 1
		rcl	dl, 1
		shl	ah, 1
		rcl	dl, 1
		shl	al, 1
		rcl	dh, 1
		shl	ah, 1
		rcl	dh, 1
		mov	es, cs:word_1140E
		assume es:nothing
		mov	es:[di], dh
		mov	es, cs:word_11410
		assume es:nothing
		mov	es:[di], dl
		mov	es, cs:word_11412
		assume es:nothing
		mov	es:[di], bh
		mov	es, cs:word_11414
		assume es:nothing
		mov	al, bl
		stosb
		dec	bp
		jz	short loc_117D8
		jmp	loc_1172E
; ---------------------------------------------------------------------------

loc_117D8:				; CODE XREF: sub_1170B+C8j
		add	word ptr ds:106h, 50h ;	'P'
		dec	word ptr ds:102h
		jz	short loc_117F9
		dec	cx
		jz	short loc_117E9
		jmp	loc_11723
; ---------------------------------------------------------------------------

loc_117E9:				; CODE XREF: sub_1170B+D9j
		mov	es, cs:word_1140C
		assume es:nothing
		pop	bp
		pop	si
		pop	dx
		pop	cx
		pop	bx
		pop	ax
		mov	di, ds:108h
		retn
; ---------------------------------------------------------------------------

loc_117F9:				; CODE XREF: sub_1170B+D6j
		mov	bx, cs:word_11416
		mov	ah, 3Eh
		int	21h		; DOS -	2+ - CLOSE A FILE WITH HANDLE
					; BX = file handle
		mov	sp, cs:word_11418
		xor	ax, ax
		retn
sub_1170B	endp


; =============== S U B	R O U T	I N E =======================================


ReadFileSomething2 proc	near		; CODE XREF: sub_11275+Bp
		push	cx
		push	dx
		mov	cx, 0FF00h
		xor	dx, dx
		mov	bx, ds:879Dh
		push	ds
		mov	ds, cs:word_1140C
		assume ds:nothing
		mov	ah, 3Fh
		int	21h		; DOS -	2+ - READ FROM FILE WITH HANDLE
					; BX = file handle, CX = number	of bytes to read
					; DS:DX	-> buffer
		pop	ds
		assume ds:nothing
		jnb	short loc_11827
		add	al, 2
		jmp	short PrintErrExit
; ---------------------------------------------------------------------------
		db  90h	; ê
; ---------------------------------------------------------------------------

loc_11827:				; CODE XREF: ReadFileSomething2+16j
		pop	dx
		pop	cx
		retn
ReadFileSomething2 endp


; =============== S U B	R O U T	I N E =======================================


sub_1182A	proc near		; CODE XREF: sub_11451+E5p
					; sub_11451+F4p ...
		mov	dl, [bx]
		inc	bx
		mov	dh, 8
		cmp	bx, 0FF00h
		jz	short sub_11836
		retn
sub_1182A	endp


; =============== S U B	R O U T	I N E =======================================


sub_11836	proc near		; CODE XREF: sub_11451+19p
					; sub_1182A+9j
		push	cx
		push	ax
		push	dx
		mov	bx, cs:word_11416
		mov	dx, 1A14h
		push	dx
		mov	cx, 0E4ECh
		cmp	cx, cs:fileSize
		jbe	short loc_11851
		mov	cx, cs:fileSize

loc_11851:				; CODE XREF: sub_11836+14j
		mov	ah, 3Fh
		int	21h		; DOS -	2+ - READ FROM FILE WITH HANDLE
					; BX = file handle, CX = number	of bytes to read
					; DS:DX	-> buffer
		jnb	short loc_1185A
		jmp	short PrintErrExit
; ---------------------------------------------------------------------------
		align 2

loc_1185A:				; CODE XREF: sub_11836+1Fj
		pop	bx
		pop	dx
		pop	ax
		pop	cx
		retn
sub_11836	endp

; ---------------------------------------------------------------------------
; START	OF FUNCTION CHUNK FOR OpenFileForRead

PrintErrExit:				; CODE XREF: ReadFileSomething2+1Aj
					; sub_11836+21j ...
		mov	dx, seg	seg001
		mov	ds, dx
		assume ds:seg001
		push	ax
		mov	dx, offset aGrErr ; "GR-err : #$"
		mov	ah, 9
		int	21h		; DOS -	PRINT STRING
					; DS:DX	-> string terminated by	"$"
		pop	ax
		xor	ah, ah
		shl	al, 1
		push	ax
		mov	si, ax
		mov	dx, off_1B8B6[si]
		mov	ah, 9
		int	21h		; DOS -	PRINT STRING
					; DS:DX	-> string terminated by	"$"
		mov	ah, 90
		call	WaitFrames
		pop	ax
		mov	ah, 4Ch
		int	21h		; DOS -	2+ - QUIT WITH EXIT CODE (EXIT)
; END OF FUNCTION CHUNK	FOR OpenFileForRead ; AL = exit	code

; =============== S U B	R O U T	I N E =======================================


sub_11886	proc near		; CODE XREF: sApplyPalettep
					; sub_11451+C2p
		mov	si, offset byte_1B83F
		mov	cx, 10h

loc_1188C:				; CODE XREF: sub_11886+Dj
		mov	al, 10h
		sub	al, cl
		call	sub_11896
		loop	loc_1188C
		retn
sub_11886	endp


; =============== S U B	R O U T	I N E =======================================


sub_11896	proc near		; CODE XREF: sSetPalColour+2Dp
					; sub_11886+Ap
		push	di
		push	es
		out	0A8h, al	; Interrupt Controller #2, 8259A
		lodsb
		and	al, 0Fh
		out	0AAh, al	; Interrupt Controller #2, 8259A
		lodsb
		and	al, 0Fh
		out	0ACh, al	; Interrupt Controller #2, 8259A
		lodsb
		and	al, 0Fh
		jmp	short loc_118D3
; ---------------------------------------------------------------------------
		lodsb
		mov	ah, al
		lodsb
		add	ah, al
		lodsb
		add	ah, al
		mov	al, 0Fh
		cmp	ah, 18h
		jb	short loc_118BC
		sub	ax, 180Fh

loc_118BC:				; CODE XREF: sub_11896+21j
		out	0AAh, al	; Interrupt Controller #2, 8259A
		mov	al, 0Fh
		cmp	ah, 0Ch
		jb	short loc_118C8
		sub	ax, 0C0Fh

loc_118C8:				; CODE XREF: sub_11896+2Dj
		out	0ACh, al	; Interrupt Controller #2, 8259A
		xor	al, al
		cmp	ah, 6
		jb	short loc_118D3
		xor	al, al

loc_118D3:				; CODE XREF: sub_11896+11j
					; sub_11896+39j
		pop	es
		assume es:nothing
		pop	di
		out	0AEh, al	; Interrupt Controller #2, 8259A
		retn
sub_11896	endp


; =============== S U B	R O U T	I N E =======================================


OpenFileRead2	proc near		; CODE XREF: LoadSceneMainB:LoadSceneMainp
					; sub_100F6+1Ep
		mov	byte ptr aGrErr, 'F' ; "GR-err : #$"
		call	OpenFileForRead
		mov	byte ptr aGrErr, 'G' ; "GR-err : #$"
		retn
OpenFileRead2	endp


; =============== S U B	R O U T	I N E =======================================


OpenFileForRead	proc near		; CODE XREF: sBGM_Play+10p
					; sub_11275+8p	...

; FUNCTION CHUNK AT 185F SIZE 00000027 BYTES

		mov	cs:fileSize, 0E4ECh
		mov	bx, dx
		cmp	byte ptr [bx], 32
		jbe	short loc_1190F
		call	fopen_read
		jnb	short loc_118FC
		jmp	PrintErrExit
; ---------------------------------------------------------------------------

loc_118FC:				; CODE XREF: OpenFileForRead+11j
					; OpenFileForRead+43j ...
		push	es
		xor	ax, ax
		mov	es, ax
		assume es:nothing
		test	byte ptr es:54Ch, 80h
		jz	short loc_1190D
		mov	al, 0Dh
		out	0A2h, al	; Interrupt Controller #2, 8259A

loc_1190D:				; CODE XREF: OpenFileForRead+21j
		pop	es
		assume es:nothing
		retn
; ---------------------------------------------------------------------------

loc_1190F:				; CODE XREF: OpenFileForRead+Cj
		mov	al, [bx]
		add	al, 5Fh	; '_'
		mov	byte ptr aInsertDisk+1Ch, al
		mov	byte ptr aInsertDisk+18h, 'Q'
		cmp	byte ptr [bx], 1
		jnz	short loc_11925
		mov	byte ptr aInsertDisk+18h, 'P'

loc_11925:				; CODE XREF: OpenFileForRead+38j
		inc	dx
		call	fopen_read
		jnb	short loc_118FC
		mov	ah, 19h
		int	21h		; DOS -	GET DEFAULT DISK NUMBER
		mov	byte_1B915, al
		push	dx
		mov	dl, al
		inc	dl
		mov	ah, 0Eh
		int	21h		; DOS -	SELECT DISK
					; DL = new default drive number	(0 = A,	1 = B, etc.)
					; Return: AL = number of logical drives
		pop	dx
		call	fopen_read
		pushf
		push	dx
		mov	dl, byte_1B915
		mov	ah, 0Eh
		int	21h		; DOS -	SELECT DISK
					; DL = new default drive number	(0 = A,	1 = B, etc.)
					; Return: AL = number of logical drives
		pop	dx
		popf
		jnb	short loc_118FC
		dec	dx
		push	ax
		push	bx
		push	cx
		push	dx
		push	si
		push	di
		push	bp
		push	ds
		push	es
		mov	bx, ds
		mov	ax, 0A000h
		mov	es, ax
		assume es:nothing
		mov	ds, ax
		assume ds:nothing
		mov	cx, 800h
		xor	si, si
		mov	di, 1000h
		rep movsw
		mov	cx, 800h
		mov	si, 2000h
		mov	di, 3000h
		rep movsw
		mov	ds, bx
		assume ds:seg001
		mov	ah, 0Ch
		int	18h		; TRANSFER TO ROM BASIC
					; causes transfer to ROM-based BASIC (IBM-PC)
					; often	reboots	a compatible; often has	no effect at all
		mov	ah, 41h	; 'A'
		int	18h		; TRANSFER TO ROM BASIC
					; causes transfer to ROM-based BASIC (IBM-PC)
					; often	reboots	a compatible; often has	no effect at all
		push	ax
		push	dx
		mov	ah, 9
		mov	dx, offset aInsertDisk ; "\x1B*\x1B[37m\x1B[12;14HÉhÉâÉCÉuÇQÇ…Ç`ÉfÉBÉXÉNÇ"...
		int	21h		; DOS -	PRINT STRING
					; DS:DX	-> string terminated by	"$"
		pop	dx
		pop	ax
		call	sub_1274B
		mov	ax, 0A000h
		mov	es, ax
		mov	ds, ax
		assume ds:nothing
		mov	cx, 800h
		mov	si, 1000h
		xor	di, di
		rep movsw
		mov	cx, 800h
		mov	si, 3000h
		mov	di, 2000h
		rep movsw
		mov	ah, 0Dh
		int	18h		; TRANSFER TO ROM BASIC
					; causes transfer to ROM-based BASIC (IBM-PC)
					; often	reboots	a compatible; often has	no effect at all
		mov	ah, 40h	; '@'
		int	18h		; TRANSFER TO ROM BASIC
					; causes transfer to ROM-based BASIC (IBM-PC)
					; often	reboots	a compatible; often has	no effect at all
		pop	es
		assume es:nothing
		pop	ds
		assume ds:nothing
		pop	bp
		pop	di
		pop	si
		pop	dx
		pop	cx
		pop	bx
		pop	ax
		jmp	OpenFileForRead
OpenFileForRead	endp

		assume ds:seg001

; =============== S U B	R O U T	I N E =======================================


fopen_read	proc near		; CODE XREF: OpenFileForRead+Ep
					; OpenFileForRead+40p ...
		mov	ax, 3D00h
		int	21h		; DOS -	2+ - OPEN DISK FILE WITH HANDLE
					; DS:DX	-> ASCIZ filename
					; AL = access mode
					; 0 - read
		jb	short loc_119EC

loc_119C4:				; CODE XREF: fopen_read+38j
		mov	fileHandle, ax
		mov	cs:word_11416, ax
		cmp	cs:fileSize, 0E4ECh
		jnz	short loc_119EA
		mov	bx, ax
		mov	ax, 4202h
		xor	cx, cx
		xor	dx, dx
		int	21h		; DOS -	2+ - MOVE FILE READ/WRITE POINTER (LSEEK)
					; AL = method: offset from end of file
		mov	cs:fileSize, ax
		xor	dx, dx
		mov	ax, 4200h
		int	21h		; DOS -	2+ - MOVE FILE READ/WRITE POINTER (LSEEK)
					; AL = method: offset from beginning of	file

loc_119EA:				; CODE XREF: fopen_read+15j
		clc
		retn
; ---------------------------------------------------------------------------

loc_119EC:				; CODE XREF: fopen_read+5j
		mov	cs:archiveID, 0

loc_119F2:				; CODE XREF: fopen_read+45j
		call	ReadFromArchive
		jnb	short loc_119C4
		inc	cs:archiveID
		cmp	cs:archiveID, 10
		jnz	short loc_119F2
		stc
		retn
fopen_read	endp


; =============== S U B	R O U T	I N E =======================================


ReadFromArchive	proc near		; CODE XREF: fopen_read:loc_119F2p
		pusha
		push	es
		mov	bx, dx
		mov	word_1B838, dx
		xor	al, al

loc_11A10:				; CODE XREF: ReadFromArchive+Fj
		cmp	[bx], al
		jz	short loc_11A17
		inc	bx
		jmp	short loc_11A10
; ---------------------------------------------------------------------------

loc_11A17:				; CODE XREF: ReadFromArchive+Cj
		sub	bx, dx
		mov	bp, bx
		call	toupper
		push	ds
		lds	bx, cs:ScrVariables
		assume ds:nothing
		add	bx, 8CEh
		mov	al, cs:archiveID
		add	al, '0'
		mov	[bx+3],	al
		mov	dx, bx
		mov	ax, 3D00h
		int	21h		; DOS -	2+ - OPEN DISK FILE WITH HANDLE
					; DS:DX	-> ASCIZ filename
					; AL = access mode
					; 0 - read
		pop	ds
		jnb	short loc_11A3F
		pop	es
		popa
		stc
		retn
; ---------------------------------------------------------------------------
		assume ds:seg001

loc_11A3F:				; CODE XREF: ReadFromArchive+33j
		mov	bx, ax
		mov	fileHandle, ax
		mov	ax, 4202h
		mov	cx, 0FFFFh
		mov	dx, -2
		int	21h		; DOS -	2+ - MOVE FILE READ/WRITE POINTER (LSEEK)
					; AL = method: offset from end of file
		mov	dx, offset libTocSize
		mov	cx, 2
		mov	ah, 3Fh
		int	21h		; DOS -	2+ - READ FROM FILE WITH HANDLE
					; BX = file handle, CX = number	of bytes to read
					; DS:DX	-> buffer
		mov	dx, libTocSize
		neg	dx
		mov	ax, 4202h
		mov	cx, 0FFFFh
		int	21h		; DOS -	2+ - MOVE FILE READ/WRITE POINTER (LSEEK)
					; AL = method: offset from end of file
		mov	cx, libTocSize
		push	ds
		les	di, cs:ScrVariables
		mov	ds, word ptr es:[di+1Ah]
		assume ds:nothing
		xor	dx, dx
		mov	ax, 3F00h
		int	21h		; DOS -	2+ - READ FROM FILE WITH HANDLE
					; BX = file handle, CX = number	of bytes to read
					; DS:DX	-> buffer
		mov	ax, es:[di+1Ah]
		mov	es, ax
		pop	ds
		assume ds:seg001
		call	DecryptLibTOC
		xor	dx, dx

loc_11A88:				; CODE XREF: ReadFromArchive+9Aj
		mov	si, word_1B838
		mov	di, dx
		cmp	word ptr es:[di], '[['
		jz	short loc_11AC8	; entry	"[[End]]" - stop
		mov	cx, bp
		repe cmpsb
		or	cx, cx
		jz	short loc_11AA2
		add	dx, 10h
		jmp	short loc_11A88
; ---------------------------------------------------------------------------

loc_11AA2:				; CODE XREF: ReadFromArchive+95j
		mov	di, dx
		mov	ax, es:[di+1Ch]
		sub	ax, es:[di+0Ch]	; calculate file size
		mov	cs:fileSize, ax
		mov	bx, fileHandle
		mov	dx, es:[di+0Ch]	; get file offset
		mov	cx, es:[di+0Eh]
		mov	ax, 4200h
		int	21h		; DOS -	2+ - MOVE FILE READ/WRITE POINTER (LSEEK)
					; AL = method: offset from beginning of	file
		clc

loc_11AC2:				; CODE XREF: ReadFromArchive+CBj
		pop	es
		popa
		mov	ax, fileHandle
		retn
; ---------------------------------------------------------------------------

loc_11AC8:				; CODE XREF: ReadFromArchive+8Dj
		mov	bx, fileHandle
		mov	ah, 3Eh
		int	21h		; DOS -	2+ - CLOSE A FILE WITH HANDLE
					; BX = file handle
		stc
		jmp	short loc_11AC2
ReadFromArchive	endp


; =============== S U B	R O U T	I N E =======================================


toupper		proc near		; CODE XREF: ReadFromArchive+15p
		mov	al, bl
		mov	si, word_1B838

loc_11AD9:				; CODE XREF: toupper+16j
		cmp	byte ptr [si], 'a'
		jb	short loc_11AE6
		cmp	byte ptr [si], 'z'
		ja	short loc_11AE6
		sub	byte ptr [si], 20h

loc_11AE6:				; CODE XREF: toupper+9j toupper+Ej
		inc	si
		dec	al
		jnz	short loc_11AD9
		retn
toupper		endp


; =============== S U B	R O U T	I N E =======================================


DecryptLibTOC	proc near		; CODE XREF: ReadFromArchive+7Dp
		push	bx
		mov	cx, libTocSize
		shr	cx, 1
		xor	bx, bx

loc_11AF5:				; CODE XREF: DecryptLibTOC+10j
		xor	word ptr es:[bx], 9999h
		inc	bx
		inc	bx
		loop	loc_11AF5
		pop	bx
		retn
DecryptLibTOC	endp


; =============== S U B	R O U T	I N E =======================================


sub_11B00	proc near		; CODE XREF: sOpenTextBox+8Bp
					; sClearTextBox+1Fp ...
		push	si
		push	di
		mov	cs:word_12F38, bp
		mov	di, [bx-6006h]
		mov	al, [bx-6002h]
		cbw
		mov	si, ax
		mov	word_1D098, ax
		cmp	byte_1D106, 0
		jnz	short loc_11B1F
		call	sub_1276F

loc_11B1F:				; CODE XREF: sub_11B00+1Aj
		mov	bp, word_1D096
		shl	bp, 1
		mov	bp, ds:[bp-5F99h]
		mov	dl, 1
		call	sub_11B51
		mov	dl, 4
		mov	ch, [bx-6003h]
		sub	ch, 2

loc_11B38:				; CODE XREF: sub_11B00+3Dj
		call	sub_11B51
		dec	ch
		jnz	short loc_11B38
		mov	dl, 7
		call	sub_11B51
		mov	byte_1D106, 0
		mov	bp, cs:word_12F38
		pop	di
		pop	si
		retn
sub_11B00	endp


; =============== S U B	R O U T	I N E =======================================


sub_11B51	proc near		; CODE XREF: sub_11B00+2Cp
					; sub_11B00:loc_11B38p	...
		push	di
		mov	ah, dl
		dec	ah
		call	sub_11B7C
		add	di, 2
		mov	cl, [bx-6004h]
		sub	cl, 2

loc_11B63:				; CODE XREF: sub_11B51+1Cj
		mov	ah, dl
		call	sub_11B7C
		add	di, 2
		dec	cl
		jnz	short loc_11B63
		mov	ah, dl
		inc	ah
		call	sub_11B7C
		pop	di
		add	di, 500h
		retn
sub_11B51	endp


; =============== S U B	R O U T	I N E =======================================


sub_11B7C	proc near		; CODE XREF: sub_11B51+5p
					; sub_11B51+14p ...
		push	bx
		push	si
		imul	si, 5A0h
		xor	al, al
		shr	ax, 1
		add	si, 8976h
		add	si, ax
		mov	bx, ax
		shr	bx, 2
		sub	ax, bx
		mov	bx, 480h
		sub	bx, ax
		mov	ax, 0A800h
		call	sub_11BB3
		mov	ax, 0B000h
		call	sub_11BB3
		mov	ax, 0B800h
		call	sub_11BB3
		mov	ax, 0E000h
		call	sub_11BB3
		pop	si
		pop	bx
		retn
sub_11B7C	endp


; =============== S U B	R O U T	I N E =======================================


sub_11BB3	proc near		; CODE XREF: sub_11B7C+1Fp
					; sub_11B7C+25p ...
		mov	es, ax
		cmp	byte_1D106, 2
		jnz	short loc_11C29
		push	si
		push	ds
		lds	si, cs:ScrVariables
		assume ds:nothing
		mov	ds, word ptr [si+18h]
		mov	si, bp
		lodsw
		mov	es:[di], ax
		lodsw
		mov	es:[di+50h], ax
		lodsw
		mov	es:[di+0A0h], ax
		lodsw
		mov	es:[di+0F0h], ax
		lodsw
		mov	es:[di+140h], ax
		lodsw
		mov	es:[di+190h], ax
		lodsw
		mov	es:[di+1E0h], ax
		lodsw
		mov	es:[di+230h], ax
		lodsw
		mov	es:[di+280h], ax
		lodsw
		mov	es:[di+2D0h], ax
		lodsw
		mov	es:[di+320h], ax
		lodsw
		mov	es:[di+370h], ax
		lodsw
		mov	es:[di+3C0h], ax
		lodsw
		mov	es:[di+410h], ax
		lodsw
		mov	es:[di+460h], ax
		lodsw
		mov	es:[di+4B0h], ax
		mov	bp, si
		pop	ds
		pop	si

loc_11C29:				; CODE XREF: sub_11BB3+7j
		cmp	word ptr ds:9FF8h, 0FFFFh
		jnz	short loc_11C33
		jmp	loc_11CFD
; ---------------------------------------------------------------------------

loc_11C33:				; CODE XREF: sub_11BB3+7Bj
		mov	ax, [bx+si]
		and	es:[di], ax
		lodsw
		or	es:[di], ax
		mov	ax, [bx+si]
		and	es:[di+50h], ax
		lodsw
		or	es:[di+50h], ax
		mov	ax, [bx+si]
		and	es:[di+0A0h], ax
		lodsw
		or	es:[di+0A0h], ax
		mov	ax, [bx+si]
		and	es:[di+0F0h], ax
		lodsw
		or	es:[di+0F0h], ax
		mov	ax, [bx+si]
		and	es:[di+140h], ax
		lodsw
		or	es:[di+140h], ax
		mov	ax, [bx+si]
		and	es:[di+190h], ax
		lodsw
		or	es:[di+190h], ax
		mov	ax, [bx+si]
		and	es:[di+1E0h], ax
		lodsw
		or	es:[di+1E0h], ax
		mov	ax, [bx+si]
		and	es:[di+230h], ax
		lodsw
		or	es:[di+230h], ax
		mov	ax, [bx+si]
		and	es:[di+280h], ax
		lodsw
		or	es:[di+280h], ax
		mov	ax, [bx+si]
		and	es:[di+2D0h], ax
		lodsw
		or	es:[di+2D0h], ax
		mov	ax, [bx+si]
		and	es:[di+320h], ax
		lodsw
		or	es:[di+320h], ax
		mov	ax, [bx+si]
		and	es:[di+370h], ax
		lodsw
		or	es:[di+370h], ax
		mov	ax, [bx+si]
		and	es:[di+3C0h], ax
		lodsw
		or	es:[di+3C0h], ax
		mov	ax, [bx+si]
		and	es:[di+410h], ax
		lodsw
		or	es:[di+410h], ax
		mov	ax, [bx+si]
		and	es:[di+460h], ax
		lodsw
		or	es:[di+460h], ax
		mov	ax, [bx+si]
		and	es:[di+4B0h], ax
		lodsw
		or	es:[di+4B0h], ax

loc_11CFD:				; CODE XREF: sub_11BB3+7Dj
		sub	bx, 20h	; ' '
		retn
sub_11BB3	endp


; =============== S U B	R O U T	I N E =======================================


sub_11D01	proc near		; CODE XREF: sub_1128B+16p
		mov	bx, ds:0A17Dh
		cmp	bx, 0
		jnz	short loc_11D0D
		mov	bx, 190h

loc_11D0D:				; CODE XREF: sub_11D01+7j
		mov	dx, 190h
		sub	dx, bx
		imul	dx, 28h
		sub	dx, ds:0A17Bh
		mov	ah, 70h	; 'p'
		call	sub_11D44
		mov	ax, dx
		call	sub_11D54
		mov	ax, bx
		shl	ax, 4
		or	ah, ds:0A17Fh
		call	sub_11D54
		xor	ax, ax
		call	sub_11D54
		mov	ax, 190h
		sub	ax, bx
		shl	ax, 4
		or	ah, ds:0A17Fh
		call	sub_11D54
		retn
sub_11D01	endp


; =============== S U B	R O U T	I N E =======================================


sub_11D44	proc near		; CODE XREF: sub_11D01+1Ap
		call	sub_11D61
		mov	al, ah
		out	0A2h, al	; Interrupt Controller #2, 8259A
		retn
sub_11D44	endp

; ---------------------------------------------------------------------------
		call	sub_11D61
		mov	al, ah
		out	0A0h, al	; PIC 2	 same as 0020 for PIC 1
		retn

; =============== S U B	R O U T	I N E =======================================


sub_11D54	proc near		; CODE XREF: sub_11D01+1Fp
					; sub_11D01+2Bp ...
		call	sub_11D61
		out	0A0h, al	; PIC 2	 same as 0020 for PIC 1
		call	sub_11D61
		mov	al, ah
		out	0A0h, al	; PIC 2	 same as 0020 for PIC 1
		retn
sub_11D54	endp


; =============== S U B	R O U T	I N E =======================================


sub_11D61	proc near		; CODE XREF: sub_11D44p seg000:1D4Cp ...
		push	ax

loc_11D62:				; CODE XREF: sub_11D61+Bj
		jmp	short $+2
		in	al, 0A0h	; PIC 2	 same as 0020 for PIC 1
		test	al, 2
		jmp	short $+2
		jmp	short $+2
		jnz	short loc_11D62
		pop	ax
		retn
sub_11D61	endp


; =============== S U B	R O U T	I N E =======================================


sub_11D70	proc near		; CODE XREF: sub_108C7+47p
					; sub_10E65+22p ...
		cmp	byte ptr ds:892Ah, 0
		jz	short loc_11D82
		mov	di, ds:892Bh
		mov	byte ptr ds:892Ah, 0
		jmp	short loc_11D86
; ---------------------------------------------------------------------------

loc_11D82:				; CODE XREF: sub_11D70+5j
		mov	ds:8884h, di

loc_11D86:				; CODE XREF: sub_11D70+10j
					; seg000:2231p
		push	bx
		push	dx
		push	si

loc_11D89:				; CODE XREF: sub_11D70+6Ej
		mov	ax, [si+1]
		mov	dx, [si]
		or	dl, dl
		jnz	short loc_11D96
		pop	si
		pop	dx
		pop	bx
		retn
; ---------------------------------------------------------------------------

loc_11D96:				; CODE XREF: sub_11D70+20j
		cmp	dl, 80h	; 'Ä'
		jb	short loc_11DE0
		call	sub_11E20
		mov	ax, 2
		test	byte ptr ds:8888h, 4
		jz	short loc_11DAA
		shl	ax, 1

loc_11DAA:				; CODE XREF: sub_11D70+36j
		cmp	byte ptr ds:8929h, 0
		jz	short loc_11DB8
		shr	ax, 1
		mov	byte ptr ds:8929h, 0

loc_11DB8:				; CODE XREF: sub_11D70+3Fj
		add	di, ax
		les	bx, cs:ScrVariables
		cmp	byte ptr es:[bx+8C1h], 0
		jz	short loc_11DDB
		mov	ah, 2
		int	18h		; TRANSFER TO ROM BASIC
					; causes transfer to ROM-based BASIC (IBM-PC)
					; often	reboots	a compatible; often has	no effect at all
		test	al, 3
		jnz	short loc_11DDB
		mov	ah, es:[bx+8C1h]

loc_11DD4:				; CODE XREF: sub_11D70+69j
		call	WaitForVSync
		dec	ah
		jnz	short loc_11DD4

loc_11DDB:				; CODE XREF: sub_11D70+55j
					; sub_11D70+5Dj ...
		add	si, 2
		jmp	short loc_11D89
; ---------------------------------------------------------------------------

loc_11DE0:				; CODE XREF: sub_11D70+29j
		cmp	dl, 10h
		ja	short loc_11DF1
		xor	bx, bx
		mov	bl, dl
		shl	bx, 1
		call	word ptr [bx-76D1h]
		jmp	short loc_11DDB
; ---------------------------------------------------------------------------

loc_11DF1:				; CODE XREF: sub_11D70+73j
		cmp	dl, 1Dh
		jnz	short loc_11DFD
		and	dh, 0Fh
		mov	ds:8886h, dh

loc_11DFD:				; CODE XREF: sub_11D70+84j
		cmp	dl, 1Fh
		jnz	short loc_11E06
		mov	ds:8888h, dh

loc_11E06:				; CODE XREF: sub_11D70+90j
		cmp	dl, 1Eh
		jnz	short loc_11E12
		and	dh, 0Fh
		mov	ds:8887h, dh

loc_11E12:				; CODE XREF: sub_11D70+99j
		cmp	dl, 20h	; ' '
		jnz	short loc_11E18
		inc	di

loc_11E18:				; CODE XREF: sub_11D70+A5j
		cmp	dl, 20h	; ' '
		jb	short loc_11E1E
		dec	si

loc_11E1E:				; CODE XREF: sub_11D70+ABj
		jmp	short loc_11DDB
sub_11D70	endp


; =============== S U B	R O U T	I N E =======================================


sub_11E20	proc near		; CODE XREF: sub_11D70+2Bp
		call	sub_11F70
		push	si
		push	di
		push	cx
		test	byte ptr ds:8888h, 4
		jnz	short loc_11E56
		mov	si, 8889h
		push	dx
		mov	dl, ds:8886h
		mov	dh, ds:8887h
		mov	ax, 0A800h
		call	sub_11E7F
		mov	ax, 0B000h
		call	sub_11E7F
		mov	ax, 0B800h
		call	sub_11E7F
		mov	ax, 0E000h
		call	sub_11E7F
		pop	dx
		pop	cx
		pop	di
		pop	si
		retn
; ---------------------------------------------------------------------------

loc_11E56:				; CODE XREF: sub_11E20+Bj
		mov	si, 88A9h
		push	dx
		mov	dl, ds:8886h
		mov	dh, ds:8887h
		mov	ax, 0A800h
		call	sub_11EE6
		mov	ax, 0B000h
		call	sub_11EE6
		mov	ax, 0B800h
		call	sub_11EE6
		mov	ax, 0E000h
		call	sub_11EE6
		pop	dx
		pop	cx
		pop	di
		pop	si
		retn
sub_11E20	endp


; =============== S U B	R O U T	I N E =======================================


sub_11E7F	proc near		; CODE XREF: sub_11E20+1Cp
					; sub_11E20+22p ...
		mov	es, ax
		test	byte ptr ds:8888h, 8
		jz	short loc_11E8B
		call	sub_11EAB

loc_11E8B:				; CODE XREF: sub_11E7F+7j
		mov	cx, 10h
		push	di

loc_11E8F:				; CODE XREF: sub_11E7F+23j
		lodsw
		not	ax
		and	es:[di], ax
		test	dl, 1
		jz	short loc_11E9F
		not	ax
		or	es:[di], ax

loc_11E9F:				; CODE XREF: sub_11E7F+19j
		add	di, 50h	; 'P'
		loop	loc_11E8F
		pop	di
		sub	si, 20h	; ' '
		shr	dl, 1
		retn
sub_11E7F	endp


; =============== S U B	R O U T	I N E =======================================


sub_11EAB	proc near		; CODE XREF: sub_11E7F+9p
		push	dx
		mov	dl, ds:8886h
		mov	cx, 10h
		push	di

loc_11EB4:				; CODE XREF: sub_11EAB+31j
		lodsw
		mov	dl, 0FFh
		not	ax
		stc
		rcr	al, 1
		rcr	ah, 1
		rcr	dl, 1
		and	es:[di+50h], ax
		and	es:[di+52h], dl
		test	dh, 1
		jz	short loc_11ED9
		not	ax
		or	es:[di+50h], ax
		not	dl
		or	es:[di+52h], dl

loc_11ED9:				; CODE XREF: sub_11EAB+20j
		add	di, 50h	; 'P'
		loop	loc_11EB4
		pop	di
		sub	si, 20h	; ' '
		pop	dx
		shr	dh, 1
		retn
sub_11EAB	endp


; =============== S U B	R O U T	I N E =======================================


sub_11EE6	proc near		; CODE XREF: sub_11E20+45p
					; sub_11E20+4Bp ...
		mov	es, ax
		test	byte ptr ds:8888h, 8
		jz	short loc_11EF2
		call	sub_11F23

loc_11EF2:				; CODE XREF: sub_11EE6+7j
		mov	cx, 20h	; ' '
		push	si
		push	di

loc_11EF7:				; CODE XREF: sub_11EE6+36j
		lodsw
		not	ax
		and	es:[di], ax
		test	dl, 1
		jz	short loc_11F07
		not	ax
		or	es:[di], ax

loc_11F07:				; CODE XREF: sub_11EE6+1Aj
		lodsw
		not	ax
		and	es:[di+2], ax
		test	dl, 1
		jz	short loc_11F19
		not	ax
		or	es:[di+2], ax

loc_11F19:				; CODE XREF: sub_11EE6+2Bj
		add	di, 50h	; 'P'
		loop	loc_11EF7
		pop	di
		pop	si
		shr	dl, 1
		retn
sub_11EE6	endp


; =============== S U B	R O U T	I N E =======================================


sub_11F23	proc near		; CODE XREF: sub_11EE6+9p
		mov	cx, 20h	; ' '
		push	dx
		push	di
		mov	bh, dh

loc_11F2A:				; CODE XREF: sub_11F23+42j
		lodsw
		not	ax
		stc
		rcr	al, 1
		rcr	ah, 1
		mov	dx, ax
		lodsw
		not	ax
		rcr	al, 1
		rcr	ah, 1
		mov	bl, 0FFh
		rcr	bl, 1
		and	es:[di+50h], dx
		and	es:[di+52h], ax
		and	es:[di+54h], bl
		test	bh, 1
		jz	short loc_11F62
		not	ax
		not	dx
		not	bl
		or	es:[di+50h], dx
		or	es:[di+52h], ax
		or	es:[di+54h], bl

loc_11F62:				; CODE XREF: sub_11F23+2Bj
		add	di, 50h	; 'P'
		loop	loc_11F2A
		pop	di
		pop	dx
		sub	si, 80h	; 'Ä'
		shr	dh, 1
		retn
sub_11F23	endp


; =============== S U B	R O U T	I N E =======================================


sub_11F70	proc near		; CODE XREF: sub_11E20p
		test	byte ptr ds:8888h, 10h
		jnz	short loc_11F99
		call	sub_11FE4

loc_11F7A:				; CODE XREF: sub_11F70+72j
		test	byte ptr ds:8888h, 1
		jz	short loc_11F84
		call	sub_12058

loc_11F84:				; CODE XREF: sub_11F70+Fj
		test	byte ptr ds:8888h, 2
		jz	short loc_11F8E
		call	sub_120E9

loc_11F8E:				; CODE XREF: sub_11F70+19j
		test	byte ptr ds:8888h, 4
		jz	short locret_11F98
		call	sub_12132

locret_11F98:				; CODE XREF: sub_11F70+23j
		retn
; ---------------------------------------------------------------------------

loc_11F99:				; CODE XREF: sub_11F70+5j
		push	si
		push	di
		push	es
		cmp	dl, 80h	; 'Ä'
		jz	short loc_11FA6
		mov	byte ptr ds:8929h, 1

loc_11FA6:				; CODE XREF: sub_11F70+2Fj
		les	bx, cs:ScrVariables
		xor	ax, ax
		mov	al, dh
		and	ax, 0FFF0h
		xchg	ah, al
		shr	ax, 1
		mov	si, ax
		xor	ax, ax
		mov	al, dh
		and	ax, 0Fh
		shl	ax, 2
		add	si, ax
		mov	di, 88A9h
		mov	ds, word ptr es:[bx+1Ah]
		mov	es, cs:word_12F3E
		mov	cx, 20h	; ' '

loc_11FD3:				; CODE XREF: sub_11F70+68j
		movsw
		movsw
		add	si, 3Ch	; '<'
		loop	loc_11FD3
		mov	ds, cs:word_12F3E
		pop	es
		pop	di
		pop	si
		jmp	short loc_11F7A
sub_11F70	endp


; =============== S U B	R O U T	I N E =======================================


sub_11FE4	proc near		; CODE XREF: sub_11F70+7p
		xchg	dh, dl
		cmp	dx, 8540h
		jb	short loc_11FF7
		cmp	dx, 869Fh
		ja	short loc_11FF7
		mov	byte ptr ds:8929h, 1

loc_11FF7:				; CODE XREF: sub_11FE4+6j sub_11FE4+Cj
		cmp	dx, 0EC5Fh
		jb	short loc_12008
		cmp	dx, 0EC9Eh
		ja	short loc_12008
		mov	byte ptr ds:8929h, 1

loc_12008:				; CODE XREF: sub_11FE4+17j
					; sub_11FE4+1Dj
		call	sub_12042
		mov	al, 0Bh
		out	68h, al
		mov	al, dh
		sub	al, 20h	; ' '
		out	0A3h, al	; Interrupt Controller #2, 8259A
		mov	al, dl
		out	0A1h, al	; Interrupt Controller #2, 8259A
		xor	ah, ah
		xor	bx, bx

loc_1201D:				; CODE XREF: sub_11FE4+57j
		mov	al, ah
		or	al, 20h
		out	0A5h, al	; Interrupt Controller #2, 8259A
		in	al, 0A9h	; Interrupt Controller #2, 8259A
		mov	[bx-7777h], al
		mov	al, ah
		out	0A5h, al	; Interrupt Controller #2, 8259A
		in	al, 0A9h	; Interrupt Controller #2, 8259A
		mov	[bx-7776h], al
		inc	ah
		add	bx, 2
		cmp	bx, 20h	; ' '
		jnz	short loc_1201D
		mov	al, 0Ah
		out	68h, al
		retn
sub_11FE4	endp


; =============== S U B	R O U T	I N E =======================================


sub_12042	proc near		; CODE XREF: sTextFill+21p
					; sub_11FE4:loc_12008p
		shl	dh, 1
		sub	dl, 1Fh
		js	short loc_1204F
		cmp	dl, 61h	; 'a'
		adc	dl, 0DEh ; 'ﬁ'

loc_1204F:				; CODE XREF: sub_12042+5j
		add	dx, 1FA1h
		and	dx, 7F7Fh
		retn
sub_12042	endp


; =============== S U B	R O U T	I N E =======================================


sub_12058	proc near		; CODE XREF: sub_11F70+11p
		mov	ax, ds:8889h
		rol	ax, 1
		or	ds:8889h, ax
		mov	ax, ds:888Bh
		rol	ax, 1
		or	ds:888Bh, ax
		mov	ax, ds:888Dh
		rol	ax, 1
		or	ds:888Dh, ax
		mov	ax, ds:888Fh
		rol	ax, 1
		or	ds:888Fh, ax
		mov	ax, ds:8891h
		rol	ax, 1
		or	ds:8891h, ax
		mov	ax, ds:8893h
		rol	ax, 1
		or	ds:8893h, ax
		mov	ax, ds:8895h
		rol	ax, 1
		or	ds:8895h, ax
		mov	ax, ds:8897h
		rol	ax, 1
		or	ds:8897h, ax
		mov	ax, ds:8899h
		rol	ax, 1
		or	ds:8899h, ax
		mov	ax, ds:889Bh
		rol	ax, 1
		or	ds:889Bh, ax
		mov	ax, ds:889Dh
		rol	ax, 1
		or	ds:889Dh, ax
		mov	ax, ds:889Fh
		rol	ax, 1
		or	ds:889Fh, ax
		mov	ax, ds:88A1h
		rol	ax, 1
		or	ds:88A1h, ax
		mov	ax, ds:88A3h
		rol	ax, 1
		or	ds:88A3h, ax
		mov	ax, ds:88A5h
		rol	ax, 1
		or	ds:88A5h, ax
		mov	ax, ds:88A7h
		rol	ax, 1
		or	ds:88A7h, ax
		retn
sub_12058	endp


; =============== S U B	R O U T	I N E =======================================


sub_120E9	proc near		; CODE XREF: sub_11F70+1Bp
		mov	ax, ds:8889h
		rol	ax, 1
		or	ds:8889h, ax
		mov	ax, ds:888Bh
		rol	ax, 1
		or	ds:888Bh, ax
		mov	ax, ds:888Dh
		rol	ax, 1
		or	ds:888Dh, ax
		mov	ax, ds:888Fh
		rol	ax, 1
		or	ds:888Fh, ax
		mov	ax, ds:88A1h
		rol	ax, 1
		or	ds:88A1h, ax
		mov	ax, ds:88A3h
		rol	ax, 1
		or	ds:88A3h, ax
		mov	ax, ds:88A5h
		rol	ax, 1
		or	ds:88A5h, ax
		mov	ax, ds:88A7h
		rol	ax, 1
		or	ds:88A7h, ax
		retn
sub_120E9	endp


; =============== S U B	R O U T	I N E =======================================


sub_12132	proc near		; CODE XREF: sub_11F70+25p
		test	byte ptr ds:8888h, 10h
		jz	short loc_1213A
		retn
; ---------------------------------------------------------------------------

loc_1213A:				; CODE XREF: sub_12132+5j
		mov	cx, si
		xor	bx, bx
		xor	si, si

loc_12140:				; CODE XREF: sub_12132+64j
		mov	ax, [bx-7777h]
		call	sub_1219B
		xchg	dh, dl
		mov	[si-7757h], dx
		mov	[si-7753h], dx
		shr	ah, 1
		rcr	dx, 1
		sar	dx, 1
		shr	ah, 1
		rcr	dx, 1
		sar	dx, 1
		shr	ah, 1
		rcr	dx, 1
		sar	dx, 1
		shr	ah, 1
		rcr	dx, 1
		sar	dx, 1
		shr	ah, 1
		rcr	dx, 1
		sar	dx, 1
		shr	ah, 1
		rcr	dx, 1
		sar	dx, 1
		shr	ah, 1
		rcr	dx, 1
		sar	dx, 1
		shr	ah, 1
		rcr	dx, 1
		sar	dx, 1
		xchg	dh, dl
		mov	[si-7755h], dx
		mov	[si-7751h], dx
		add	bx, 2
		add	si, 8
		cmp	bx, 20h	; ' '
		jz	short loc_12198
		jmp	short loc_12140
; ---------------------------------------------------------------------------

loc_12198:				; CODE XREF: sub_12132+62j
		mov	si, cx
		retn
sub_12132	endp


; =============== S U B	R O U T	I N E =======================================


sub_1219B	proc near		; CODE XREF: sub_12132+12p
		shr	al, 1
		rcr	dx, 1
		sar	dx, 1
		shr	al, 1
		rcr	dx, 1
		sar	dx, 1
		shr	al, 1
		rcr	dx, 1
		sar	dx, 1
		shr	al, 1
		rcr	dx, 1
		sar	dx, 1
		shr	al, 1
		rcr	dx, 1
		sar	dx, 1
		shr	al, 1
		rcr	dx, 1
		sar	dx, 1
		shr	al, 1
		rcr	dx, 1
		sar	dx, 1
		shr	al, 1
		rcr	dx, 1
		sar	dx, 1
		retn
sub_1219B	endp

; ---------------------------------------------------------------------------

loc_121CC:				; DATA XREF: seg001:8931o
		call	sub_12308
		dec	si
		mov	bx, ds:9FF6h
		imul	bx, 0Ch
		mov	ax, [bx-6000h]
		mov	ds:8884h, ax
		mov	di, ax
		mov	byte ptr ds:0A066h, 2
		call	sub_11B00
		retn
; ---------------------------------------------------------------------------

loc_121E9:				; DATA XREF: seg001:8931o
		push	word ptr ds:8884h
		call	sub_12308
		dec	si
		pop	word ptr ds:8884h
		retn
; ---------------------------------------------------------------------------

loc_121F6:				; DATA XREF: seg001:8931o
		mov	ds:892Bh, di
		mov	byte ptr ds:892Ah, 1
		dec	si
		retn
; ---------------------------------------------------------------------------

loc_12201:				; DATA XREF: seg001:8931o
		mov	ax, 751h
		sub	ax, 1Ch
		sub	si, 2
		jmp	short loc_12219
; ---------------------------------------------------------------------------

loc_1220C:				; DATA XREF: seg001:8931o
		mov	ax, 75Fh
		sub	ax, 1Ch
		sub	si, 2
		jmp	short loc_12219
; ---------------------------------------------------------------------------

loc_12217:				; DATA XREF: seg001:8931o
		shl	ax, 1

loc_12219:				; CODE XREF: seg000:220Aj seg000:2215j
		les	bx, cs:ScrVariables
		add	bx, ax

loc_12220:				; CODE XREF: seg000:2238j
		mov	ax, es:[bx+1Ch]
		xchg	ah, al
		mov	ds:892Dh, ax
		or	ax, ax
		jz	short loc_1223A
		push	si
		mov	si, 892Dh
		call	loc_11D86
		pop	si
		add	bx, 2
		jmp	short loc_12220
; ---------------------------------------------------------------------------

loc_1223A:				; CODE XREF: seg000:222Bj
		inc	si
		retn
; ---------------------------------------------------------------------------

loc_1223C:				; DATA XREF: seg001:8931o
		push	ax
		push	bx
		push	cx
		push	dx
		push	si
		push	di
		push	bp
		push	ds
		push	es
		les	di, cs:ScrVariables
		mov	byte ptr ds:0A187h, 0
		mov	byte ptr ds:0A180h, 3
		cmp	dh, 1Eh
		jb	short loc_1226E
		mov	byte ptr ds:0A180h, 2
		sub	dh, 1Eh
		cmp	dh, 1Eh
		jb	short loc_1226E
		mov	byte ptr ds:0A180h, 1
		sub	dh, 1Eh

loc_1226E:				; CODE XREF: seg000:2257j seg000:2264j
		xor	ax, ax
		mov	al, dh
		mov	dh, 0Ah
		div	dh
		mov	dx, es:[di+76Eh]
		mov	bl, es:[di+76Dh]
		mov	ds:0A183h, bl
		mov	ds:0A185h, dx
		xor	cx, cx
		xchg	cl, ah
		imul	dx
		imul	ax, 50h
		mov	ds:0A181h, ax
		mov	ax, cx
		imul	bl
		add	ds:0A181h, ax
		mov	bx, ds:9FF6h
		imul	bx, 0Ch
		mov	ax, [bx-5FFCh]
		mov	ds:0A188h, ax
		call	sub_12916
		pop	es
		pop	ds
		pop	bp
		pop	di
		pop	si
		pop	dx
		pop	cx
		pop	bx
		pop	ax
		retn
; ---------------------------------------------------------------------------

loc_122B7:				; DATA XREF: seg001:8931o
		cli
		les	bx, cs:ScrVariables
		mov	es:[bx+724h], dh
		mov	word ptr es:[bx+725h], 1
		mov	ax, es:[bx+729h]
		mov	es:[bx+727h], ax
		sti
		retn
; ---------------------------------------------------------------------------

loc_122D5:				; DATA XREF: seg001:8931o
		les	di, cs:ScrVariables
		mov	di, es:[di+8C3h]
		add	di, ds:8884h
		mov	ds:8884h, di
		dec	si
		retn
; ---------------------------------------------------------------------------

loc_122E9:				; DATA XREF: seg001:8931o
		les	bx, cs:ScrVariables
		mov	ah, 2
		int	18h		; TRANSFER TO ROM BASIC
					; causes transfer to ROM-based BASIC (IBM-PC)
					; often	reboots	a compatible; often has	no effect at all
		test	al, 13h
		jz	short loc_122F7
		retn
; ---------------------------------------------------------------------------

loc_122F7:				; CODE XREF: seg000:22F4j
		push	cx
		mov	cl, es:[bx+8C1h]
		shl	dh, cl
		pop	cx

loc_12300:				; CODE XREF: seg000:2305j
		call	WaitForVSync
		dec	dh
		jnz	short loc_12300
		retn

; =============== S U B	R O U T	I N E =======================================


sub_12308	proc near		; CODE XREF: seg000:loc_121CCp
					; seg000:21EDp
		mov	ah, 0Ah
		call	WaitFrames
		push	di
		mov	bx, ds:9FF6h
		imul	bx, 0Ch
		mov	ax, [bx-5FFEh]
		mov	cs:word_12EFE, ax
		call	sub_12356
		xor	dx, dx

loc_12322:				; CODE XREF: sub_12308+34j
		call	sub_123A3
		inc	dx
		mov	ah, 2
		int	18h		; TRANSFER TO ROM BASIC
					; causes transfer to ROM-based BASIC (IBM-PC)
					; often	reboots	a compatible; often has	no effect at all
		test	al, 10h
		jz	short loc_12333
		mov	ax, 1
		jmp	short loc_1233E
; ---------------------------------------------------------------------------

loc_12333:				; CODE XREF: sub_12308+24j
		call	loc_12FF8
		mov	ah, 9
		int	58h		; IRQ8 relocated by DESQview 2.26+
		or	ax, ax
		jz	short loc_12322

loc_1233E:				; CODE XREF: sub_12308+29j
		shl	al, 1
		or	al, ah
		les	di, cs:ScrVariables
		mov	ah, es:[di+8C2h]
		mov	es:[di+8C1h], ah
		call	sub_12706
		pop	di
		retn
sub_12308	endp


; =============== S U B	R O U T	I N E =======================================


sub_12356	proc near		; CODE XREF: sub_12308+15p
		mov	bx, ds:9FF6h
		imul	bx, 0Ch
		les	di, cs:ScrVariables
		mov	ax, es:[di+8C6h]
		mov	ds:8951h, ax
		mov	al, es:[di+8C5h]
		mov	ds:8973h, al
		mov	al, es:[di+8C1h]
		mov	byte ptr es:[di+8C1h], 0
		mov	es:[di+8C2h], al
		call	sub_126BC
		les	di, cs:ScrVariables
		push	si
		push	di
		xor	bx, bx
		mov	cx, 10h
		mov	si, 8953h

loc_12394:				; CODE XREF: sub_12356+48j
		mov	ax, es:[bx+di+787h]
		mov	[bx+si], ax
		add	bx, 2
		loop	loc_12394
		pop	di
		pop	si
		retn
sub_12356	endp


; =============== S U B	R O U T	I N E =======================================


sub_123A3	proc near		; CODE XREF: sub_12308:loc_12322p
		push	ax
		push	bx
		push	cx
		push	dx
		push	si
		push	di
		push	bp
		push	ds
		push	es
		les	si, cs:ScrVariables
		mov	di, si

loc_123B3:				; CODE XREF: sub_123A3+2Ej
		cmp	word ptr es:[si+775h], 0
		jnz	short loc_123C7
		pop	es
		pop	ds
		pop	bp
		pop	di
		pop	si
		pop	dx
		pop	cx
		pop	bx
		pop	ax
		xor	dx, dx
		retn
; ---------------------------------------------------------------------------

loc_123C7:				; CODE XREF: sub_123A3+16j
		cmp	dx, es:[si+775h]
		jbe	short loc_123D3
		add	si, 2
		jmp	short loc_123B3
; ---------------------------------------------------------------------------

loc_123D3:				; CODE XREF: sub_123A3+29j
		mov	ax, es:[di+8C6h]
		sub	si, di
		add	ax, si
		mov	cs:word_12EFC, ax
		call	sub_12706
		mov	di, cs:word_12EFE
		cmp	byte ptr ds:8973h, 1
		jz	short loc_12414
		push	word ptr ds:8888h
		and	byte ptr ds:8888h, 0FBh
		shl	si, 1
		add	si, 8953h
		mov	di, cs:word_12EFE
		call	sub_11D70
		pop	word ptr ds:8888h
		pop	es
		pop	ds
		pop	bp
		pop	di
		pop	si
		pop	dx
		pop	cx
		pop	bx
		pop	ax
		retn
; ---------------------------------------------------------------------------

loc_12414:				; CODE XREF: sub_123A3+4Aj
		lds	si, cs:ScrVariables
		add	si, 8
		push	cs
		pop	es
		assume es:seg000
		mov	di, 2F08h
		mov	cx, 4
		rep movsw
		xor	bx, bx
		mov	si, cs:word_12EFC
		call	sub_1245B
		call	sub_124E1
		call	sub_124E1
		call	sub_124E1
		xor	bx, bx
		mov	di, cs:word_12EFE
		call	sub_12577
		call	sub_12577
		call	sub_12577
		call	sub_12577
		mov	ds, cs:word_12F3E
		pop	es
		assume es:nothing
		pop	ds
		pop	bp
		pop	di
		pop	si
		pop	dx
		pop	cx
		pop	bx
		pop	ax
		retn
sub_123A3	endp


; =============== S U B	R O U T	I N E =======================================


sub_1245B	proc near		; CODE XREF: sub_123A3+8Ap
		mov	ds, word ptr cs:[bx+2F08h]
		mov	ax, [si]
		mov	cs:word_12F18, ax
		mov	ax, [si+50h]
		mov	cs:word_12F1A, ax
		mov	ax, [si+0A0h]
		mov	cs:word_12F1C, ax
		mov	ax, [si+0F0h]
		mov	cs:word_12F1E, ax
		mov	ax, [si+140h]
		mov	cs:word_12F20, ax
		mov	ax, [si+190h]
		mov	cs:word_12F22, ax
		mov	ax, [si+1E0h]
		mov	cs:word_12F24, ax
		mov	ax, [si+230h]
		mov	cs:word_12F26, ax
		mov	ax, [si+280h]
		mov	cs:word_12F28, ax
		mov	ax, [si+2D0h]
		mov	cs:word_12F2A, ax
		mov	ax, [si+320h]
		mov	cs:word_12F2C, ax
		mov	ax, [si+370h]
		mov	cs:word_12F2E, ax
		mov	ax, [si+3C0h]
		mov	cs:word_12F30, ax
		mov	ax, [si+410h]
		mov	cs:word_12F32, ax
		mov	ax, [si+460h]
		mov	cs:word_12F34, ax
		mov	ax, [si+4B0h]
		mov	cs:word_12F36, ax
		add	bx, 2
		retn
sub_1245B	endp


; =============== S U B	R O U T	I N E =======================================


sub_124E1	proc near		; CODE XREF: sub_123A3+8Dp
					; sub_123A3+90p ...
		mov	ds, word ptr cs:[bx+2F08h]
		mov	ax, [si]
		or	cs:word_12F18, ax
		mov	ax, [si+50h]
		or	cs:word_12F1A, ax
		mov	ax, [si+0A0h]
		or	cs:word_12F1C, ax
		mov	ax, [si+0F0h]
		or	cs:word_12F1E, ax
		mov	ax, [si+140h]
		or	cs:word_12F20, ax
		mov	ax, [si+190h]
		or	cs:word_12F22, ax
		mov	ax, [si+1E0h]
		or	cs:word_12F24, ax
		mov	ax, [si+230h]
		or	cs:word_12F26, ax
		mov	ax, [si+280h]
		or	cs:word_12F28, ax
		mov	ax, [si+2D0h]
		or	cs:word_12F2A, ax
		mov	ax, [si+320h]
		or	cs:word_12F2C, ax
		mov	ax, [si+370h]
		or	cs:word_12F2E, ax
		mov	ax, [si+3C0h]
		or	cs:word_12F30, ax
		mov	ax, [si+410h]
		or	cs:word_12F32, ax
		mov	ax, [si+460h]
		or	cs:word_12F34, ax
		mov	ax, [si+4B0h]
		or	cs:word_12F36, ax
		add	bx, 2
		retn
sub_124E1	endp


; =============== S U B	R O U T	I N E =======================================


sub_12577	proc near		; CODE XREF: sub_123A3+9Dp
					; sub_123A3+A0p ...
		mov	ds, word ptr cs:[bx+2F08h]
		mov	es, word ptr cs:[bx+2F00h]
		mov	ax, cs:word_12F18
		not	ax
		and	es:[di], ax
		mov	ax, [si]
		or	es:[di], ax
		mov	ax, cs:word_12F1A
		not	ax
		and	es:[di+50h], ax
		mov	ax, [si+50h]
		or	es:[di+50h], ax
		mov	ax, cs:word_12F1C
		not	ax
		and	es:[di+0A0h], ax
		mov	ax, [si+0A0h]
		or	es:[di+0A0h], ax
		mov	ax, cs:word_12F1E
		not	ax
		and	es:[di+0F0h], ax
		mov	ax, [si+0F0h]
		or	es:[di+0F0h], ax
		mov	ax, cs:word_12F20
		not	ax
		and	es:[di+140h], ax
		mov	ax, [si+140h]
		or	es:[di+140h], ax
		mov	ax, cs:word_12F22
		not	ax
		and	es:[di+190h], ax
		mov	ax, [si+190h]
		or	es:[di+190h], ax
		mov	ax, cs:word_12F24
		not	ax
		and	es:[di+1E0h], ax
		mov	ax, [si+1E0h]
		or	es:[di+1E0h], ax
		mov	ax, cs:word_12F26
		not	ax
		and	es:[di+230h], ax
		mov	ax, [si+230h]
		or	es:[di+230h], ax
		mov	ax, cs:word_12F28
		not	ax
		and	es:[di+280h], ax
		mov	ax, [si+280h]
		or	es:[di+280h], ax
		mov	ax, cs:word_12F2A
		not	ax
		and	es:[di+2D0h], ax
		mov	ax, [si+2D0h]
		or	es:[di+2D0h], ax
		mov	ax, cs:word_12F2C
		not	ax
		and	es:[di+320h], ax
		mov	ax, [si+320h]
		or	es:[di+320h], ax
		mov	ax, cs:word_12F2E
		not	ax
		and	es:[di+370h], ax
		mov	ax, [si+370h]
		or	es:[di+370h], ax
		mov	ax, cs:word_12F30
		not	ax
		and	es:[di+3C0h], ax
		mov	ax, [si+3C0h]
		or	es:[di+3C0h], ax
		mov	ax, cs:word_12F32
		not	ax
		and	es:[di+410h], ax
		mov	ax, [si+410h]
		or	es:[di+410h], ax
		mov	ax, cs:word_12F34
		not	ax
		and	es:[di+460h], ax
		mov	ax, [si+460h]
		or	es:[di+460h], ax
		mov	ax, cs:word_12F36
		not	ax
		and	es:[di+4B0h], ax
		mov	ax, [si+4B0h]
		or	es:[di+4B0h], ax
		add	bx, 2
		retn
sub_12577	endp


; =============== S U B	R O U T	I N E =======================================


sub_126BC	proc near		; CODE XREF: sub_12356+2Cp
		push	si
		push	di
		mov	es, cs:word_12F3E
		mov	si, cs:word_12EFE
		mov	di, 0A07Bh
		mov	ax, 0A800h
		call	sub_127F4
		mov	ax, 0B000h
		call	sub_127F4
		mov	ax, 0B800h
		call	sub_127F4
		mov	ax, 0E000h
		call	sub_127F4
		add	si, 2
		mov	ax, 0A800h
		call	sub_127F4
		mov	ax, 0B000h
		call	sub_127F4
		mov	ax, 0B800h
		call	sub_127F4
		mov	ax, 0E000h
		call	sub_127F4
		mov	ds, cs:word_12F3E
		pop	di
		pop	si
		retn
sub_126BC	endp


; =============== S U B	R O U T	I N E =======================================


sub_12706	proc near		; CODE XREF: sub_12308+49p
					; sub_123A3+3Dp
		push	si
		push	di
		mov	ds, cs:word_12F3E
		mov	si, 0A07Bh
		mov	di, cs:word_12EFE
		mov	ax, 0A800h
		call	sub_128B6
		mov	ax, 0B000h
		call	sub_128B6
		mov	ax, 0B800h
		call	sub_128B6
		mov	ax, 0E000h
		call	sub_128B6
		add	di, 2
		mov	ax, 0A800h
		call	sub_128B6
		mov	ax, 0B000h
		call	sub_128B6
		mov	ax, 0B800h
		call	sub_128B6
		mov	ax, 0E000h
		call	sub_128B6
		pop	di
		pop	si
		retn
sub_12706	endp


; =============== S U B	R O U T	I N E =======================================


sub_1274B	proc near		; CODE XREF: sub_106D4p sub_10C80+7p ...
		call	WaitForVSync
		call	WaitForVSync
		call	WaitForVSync

loc_12754:				; CODE XREF: sub_1274B+Fj
		mov	ah, 9
		int	58h		; IRQ8 relocated by DESQview 2.26+
		or	ax, ax
		jz	short loc_12754
		retn
sub_1274B	endp


; =============== S U B	R O U T	I N E =======================================


sub_1275D	proc near		; CODE XREF: sGetMusMode+4p
					; sub_106D4+3p	...
		shl	al, 1
		or	al, ah
		xor	ah, ah
		retn
sub_1275D	endp

; ---------------------------------------------------------------------------
		db 50h,	0B4h, 11h, 0CDh, 58h, 0Bh, 0C0h, 75h, 0F8h, 58h
		db 0C3h

; =============== S U B	R O U T	I N E =======================================


sub_1276F	proc near		; CODE XREF: sub_11B00+1Cp
		push	ax
		push	bx
		push	cx
		push	dx
		push	si
		push	di
		push	bp
		push	ds
		push	es
		mov	bx, ds:9FF6h
		shl	bx, 1
		mov	di, [bx-5F99h]
		mov	ax, di
		cmp	word ptr [bx-5F99h], 0FFFFh
		jnz	short loc_12793
		mov	di, ds:0A079h
		mov	[bx-5F99h], di

loc_12793:				; CODE XREF: sub_1276F+1Aj
		push	ax
		push	bx
		imul	bx, 6
		mov	si, [bx-6006h]
		xor	cx, cx
		mov	cl, [bx-6004h]
		mov	dh, cl
		mov	dl, [bx-6003h]
		les	bx, cs:ScrVariables
		mov	es, word ptr es:[bx+18h]

loc_127B1:				; CODE XREF: sub_1276F+69j
		mov	cl, dh
		push	si

loc_127B4:				; CODE XREF: sub_1276F+60j
		mov	ax, 0A800h
		call	sub_127F4
		mov	ax, 0B000h
		call	sub_127F4
		mov	ax, 0B800h
		call	sub_127F4
		mov	ax, 0E000h
		call	sub_127F4
		add	si, 2
		loop	loc_127B4
		pop	si
		add	si, 500h
		dec	dl
		jnz	short loc_127B1
		mov	ds, cs:word_12F3E
		pop	bx
		pop	ax
		cmp	ax, 0FFFFh
		jnz	short loc_127EA
		mov	ds:0A079h, di

loc_127EA:				; CODE XREF: sub_1276F+75j
		pop	es
		pop	ds
		pop	bp
		pop	di
		pop	si
		pop	dx
		pop	cx
		pop	bx
		pop	ax
		retn
sub_1276F	endp


; =============== S U B	R O U T	I N E =======================================


sub_127F4	proc near		; CODE XREF: sub_126BC+12p
					; sub_126BC+18p ...
		mov	ds, ax
		mov	ax, [si]
		stosw
		mov	ax, [si+50h]
		stosw
		mov	ax, [si+0A0h]
		stosw
		mov	ax, [si+0F0h]
		stosw
		mov	ax, [si+140h]
		stosw
		mov	ax, [si+190h]
		stosw
		mov	ax, [si+1E0h]
		stosw
		mov	ax, [si+230h]
		stosw
		mov	ax, [si+280h]
		stosw
		mov	ax, [si+2D0h]
		stosw
		mov	ax, [si+320h]
		stosw
		mov	ax, [si+370h]
		stosw
		mov	ax, [si+3C0h]
		stosw
		mov	ax, [si+410h]
		stosw
		mov	ax, [si+460h]
		stosw
		mov	ax, [si+4B0h]
		stosw
		retn
sub_127F4	endp


; =============== S U B	R O U T	I N E =======================================


sub_12844	proc near		; CODE XREF: sCloseTextBox+15p
					; sub_10CF4+5Dp ...
		push	ax
		push	bx
		push	cx
		push	dx
		push	si
		push	di
		push	bp
		push	ds
		push	es
		mov	bx, ds:9FF6h
		shl	bx, 1
		mov	si, [bx-5F99h]
		mov	ax, ds:8974h
		cmp	ax, 0FFFFh
		jnz	short loc_12867
		mov	ds:0A079h, si
		mov	[bx-5F99h], ax

loc_12867:				; CODE XREF: sub_12844+19j
		imul	bx, 6
		mov	di, [bx-6006h]
		xor	cx, cx
		mov	cl, [bx-6004h]
		mov	dh, cl
		mov	dl, [bx-6003h]
		les	bx, cs:ScrVariables
		mov	ds, word ptr es:[bx+18h]

loc_12883:				; CODE XREF: sub_12844+66j
		mov	cl, dh
		push	di

loc_12886:				; CODE XREF: sub_12844+5Dj
		mov	ax, 0A800h
		call	sub_128B6
		mov	ax, 0B000h
		call	sub_128B6
		mov	ax, 0B800h
		call	sub_128B6
		mov	ax, 0E000h
		call	sub_128B6
		add	di, 2
		loop	loc_12886
		pop	di
		add	di, 500h
		dec	dl
		jnz	short loc_12883
		pop	es
		pop	ds
		pop	bp
		pop	di
		pop	si
		pop	dx
		pop	cx
		pop	bx
		pop	ax
		retn
sub_12844	endp


; =============== S U B	R O U T	I N E =======================================


sub_128B6	proc near		; CODE XREF: sub_12706+12p
					; sub_12706+18p ...
		mov	es, ax
		lodsw
		mov	es:[di], ax
		lodsw
		mov	es:[di+50h], ax
		lodsw
		mov	es:[di+0A0h], ax
		lodsw
		mov	es:[di+0F0h], ax
		lodsw
		mov	es:[di+140h], ax
		lodsw
		mov	es:[di+190h], ax
		lodsw
		mov	es:[di+1E0h], ax
		lodsw
		mov	es:[di+230h], ax
		lodsw
		mov	es:[di+280h], ax
		lodsw
		mov	es:[di+2D0h], ax
		lodsw
		mov	es:[di+320h], ax
		lodsw
		mov	es:[di+370h], ax
		lodsw
		mov	es:[di+3C0h], ax
		lodsw
		mov	es:[di+410h], ax
		lodsw
		mov	es:[di+460h], ax
		lodsw
		mov	es:[di+4B0h], ax
		retn
sub_128B6	endp


; =============== S U B	R O U T	I N E =======================================


sub_12916	proc near		; CODE XREF: sub_10ACE+3p sub_10AD8+3p ...

; FUNCTION CHUNK AT 2A3B SIZE 00000061 BYTES
; FUNCTION CHUNK AT 2D72 SIZE 00000009 BYTES

		les	di, cs:ScrVariables
		mov	ah, ds:0A180h
		cmp	ah, 1
		ja	short loc_12934
		cmp	byte ptr ds:0A187h, 1
		ja	short loc_12934
		cmp	ah, ds:0A187h
		jz	short loc_12934
		jmp	loc_12A3B
; ---------------------------------------------------------------------------

loc_12934:				; CODE XREF: sub_12916+Cj
					; sub_12916+13j ...
		mov	byte ptr ds:0A18Ah, 0
		nop
		xor	bh, bh
		xor	cx, cx
		mov	si, 2F08h
		mov	bl, ds:0A180h
		call	sub_129EE
		mov	si, 2F10h
		mov	bl, ds:0A187h
		call	sub_129EE
		mov	al, ds:0A18Ah
		out	0A6h, al	; Interrupt Controller #2, 8259A
		cmp	word ptr ds:0A183h, 50h	; 'P'
		jnz	short loc_12975
		mov	cx, ds:0A185h
		imul	dx, cx,	28h
		xor	bx, bx
		call	sub_1298A
		call	sub_1298A
		call	sub_1298A
		call	sub_1298A
		jmp	short loc_12987
; ---------------------------------------------------------------------------

loc_12975:				; CODE XREF: sub_12916+46j
		mov	dx, ds:0A183h
		xor	bx, bx
		call	sub_129A9
		call	sub_129A9
		call	sub_129A9
		call	sub_129A9

loc_12987:				; CODE XREF: sub_12916+5Dj
		jmp	loc_12D72
sub_12916	endp


; =============== S U B	R O U T	I N E =======================================


sub_1298A	proc near		; CODE XREF: sub_12916+51p
					; sub_12916+54p ...
		mov	si, ds:0A181h
		mov	di, ds:0A188h
		mov	cx, dx
		mov	ds, word ptr cs:[bx+2F08h]
		mov	es, word ptr cs:[bx+2F10h]
		rep movsw
		mov	ds, cs:word_12F3E
		add	bx, 2
		retn
sub_1298A	endp


; =============== S U B	R O U T	I N E =======================================


sub_129A9	proc near		; CODE XREF: sub_12916+65p
					; sub_12916+68p ...
		mov	ax, ds:0A185h
		mov	si, ds:0A181h
		mov	cs:word_12EF6, si
		mov	di, ds:0A188h
		mov	cs:word_12EF4, di
		mov	ds, word ptr cs:[bx+2F08h]
		mov	es, word ptr cs:[bx+2F10h]

loc_129C8:				; CODE XREF: sub_129A9+3Aj
		mov	cx, dx
		rep movsb
		add	cs:word_12EF6, 50h ; 'P'
		mov	si, cs:word_12EF6
		add	cs:word_12EF4, 50h ; 'P'
		mov	di, cs:word_12EF4
		dec	ax
		jnz	short loc_129C8
		mov	ds, cs:word_12F3E
		add	bx, 2
		retn
sub_129A9	endp


; =============== S U B	R O U T	I N E =======================================


sub_129EE	proc near		; CODE XREF: sub_12916+2Fp
					; sub_12916+39p ...
		test	bl, 0FEh
		jnz	short loc_12A13
		or	ds:0A18Ah, bl
		mov	ax, 0A800h
		mov	cs:[si], ax
		mov	ax, 0B000h
		mov	cs:[si+2], ax
		mov	ax, 0B800h
		mov	cs:[si+4], ax
		mov	ax, 0E000h
		mov	cs:[si+6], ax
		retn
; ---------------------------------------------------------------------------

loc_12A13:				; CODE XREF: sub_129EE+3j
		inc	cl
		sub	bx, 2
		shl	bx, 3
		mov	ax, es:[bx+di+8]
		mov	cs:[si], ax
		mov	ax, es:[bx+di+0Ah]
		mov	cs:[si+2], ax
		mov	ax, es:[bx+di+0Ch]
		mov	cs:[si+4], ax
		mov	ax, es:[bx+di+0Eh]
		mov	cs:[si+6], ax
		retn
sub_129EE	endp

; ---------------------------------------------------------------------------
; START	OF FUNCTION CHUNK FOR sub_12916

loc_12A3B:				; CODE XREF: sub_12916+1Bj
		mov	dx, es:[di+1Ah]
		mov	cs:word_12EF4, dx
		mov	dl, ah
		xor	ah, 1
		mov	dh, ah
		cmp	word ptr ds:0A183h, 50h	; 'P'
		jnz	short loc_12A78
		mov	cx, ds:0A185h
		imul	cx, 28h
		mov	cs:word_12EF6, cx
		mov	bx, 0A800h
		call	sub_12A9C
		mov	bx, 0B000h
		call	sub_12A9C
		mov	bx, 0B800h
		call	sub_12A9C
		mov	bx, 0E000h
		call	sub_12A9C
		jmp	short loc_12A99
; ---------------------------------------------------------------------------

loc_12A78:				; CODE XREF: sub_12916+13Aj
		mov	cx, ds:0A183h
		mov	cs:word_12EF8, cx
		mov	bx, 0A800h
		call	sub_12AA7
		mov	bx, 0B000h
		call	sub_12AA7
		mov	bx, 0B800h
		call	sub_12AA7
		mov	bx, 0E000h
		call	sub_12AA7

loc_12A99:				; CODE XREF: sub_12916+160j
		jmp	loc_12D72
; END OF FUNCTION CHUNK	FOR sub_12916

; =============== S U B	R O U T	I N E =======================================


sub_12A9C	proc near		; CODE XREF: sub_12916+14Bp
					; sub_12916+151p ...
		call	sub_12E58
		rep movsw
		mov	ds, cs:word_12F3E
		retn
sub_12A9C	endp


; =============== S U B	R O U T	I N E =======================================


sub_12AA7	proc near		; CODE XREF: sub_12916+16Ep
					; sub_12916+174p ...
		call	sub_12E8E

loc_12AAA:				; CODE XREF: sub_12AA7+1Aj
		mov	cx, cs:word_12EF8
		rep movsb
		add	cs:word_12EFA, 50h ; 'P'
		mov	di, cs:word_12EFA
		dec	cs:word_12EF6
		jnz	short loc_12AAA
		mov	ds, cs:word_12F3E
		retn
sub_12AA7	endp


; =============== S U B	R O U T	I N E =======================================


sub_12AC9	proc near		; CODE XREF: sub_10AE2+3p sub_10B2C+3p

; FUNCTION CHUNK AT 2CD4 SIZE 0000009E BYTES

		les	di, cs:ScrVariables
		mov	dx, es:[di+1Ah]
		mov	cs:word_12EF4, dx
		mov	ah, ds:0A180h
		cmp	ah, 1
		ja	short loc_12AF0
		cmp	byte ptr ds:0A187h, 1
		ja	short loc_12AF0
		cmp	ah, ds:0A187h
		jz	short loc_12AF0
		jmp	loc_12CD4
; ---------------------------------------------------------------------------

loc_12AF0:				; CODE XREF: sub_12AC9+15j
					; sub_12AC9+1Cj ...
		mov	byte ptr ds:0A18Ah, 0
		nop
		xor	bh, bh
		xor	cx, cx
		mov	si, 2F08h
		mov	bl, ds:0A180h
		call	sub_129EE
		mov	si, 2F10h
		mov	bl, ds:0A187h
		call	sub_129EE
		mov	al, ds:0A18Ah
		out	0A6h, al	; Interrupt Controller #2, 8259A
		cmp	word ptr ds:0A183h, 50h	; 'P'
		jnz	short loc_12B40
		mov	cx, ds:0A185h
		imul	dx, cx,	28h
		xor	bx, bx
		call	sub_12B75
		call	sub_12B83
		call	sub_12B83
		call	sub_12B83
		xor	bx, bx
		call	sub_12BAE
		call	sub_12BAE
		call	sub_12BAE
		call	sub_12BAE
		jmp	loc_12D72
; ---------------------------------------------------------------------------

loc_12B40:				; CODE XREF: sub_12AC9+4Fj
		mov	dx, ds:0A183h
		xor	bx, bx
		call	sub_12BE2
		mov	bx, 2
		call	sub_12C2B
		mov	bx, 4
		call	sub_12C2B
		mov	bx, 6
		call	sub_12C2B
		xor	bx, bx
		call	sub_12C79
		mov	bx, 2
		call	sub_12C79
		mov	bx, 4
		call	sub_12C79
		mov	bx, 6
		call	sub_12C79
		jmp	loc_12D72
sub_12AC9	endp ; sp-analysis failed


; =============== S U B	R O U T	I N E =======================================


sub_12B75	proc near		; CODE XREF: sub_12AC9+5Ap
		call	sub_12B98
		rep movsw
		add	bx, 2
		mov	ds, cs:word_12F3E
		retn
sub_12B75	endp


; =============== S U B	R O U T	I N E =======================================


sub_12B83	proc near		; CODE XREF: sub_12AC9+5Dp
					; sub_12AC9+60p ...
		call	sub_12B98

loc_12B86:				; CODE XREF: sub_12B83+Aj
		lodsw
		or	es:[di], ax
		add	di, 2
		loop	loc_12B86
		add	bx, 2
		mov	ds, cs:word_12F3E
		retn
sub_12B83	endp


; =============== S U B	R O U T	I N E =======================================


sub_12B98	proc near		; CODE XREF: sub_12B75p sub_12B83p
		mov	si, ds:0A181h
		mov	di, 8000h
		add	di, si
		mov	cx, dx
		mov	ds, word ptr cs:[bx+2F08h]
		mov	es, cs:word_12EF4
		retn
sub_12B98	endp


; =============== S U B	R O U T	I N E =======================================


sub_12BAE	proc near		; CODE XREF: sub_12AC9+68p
					; sub_12AC9+6Bp ...
		mov	si, ds:0A181h
		mov	di, ds:0A188h
		mov	cx, dx
		mov	es, word ptr cs:[bx+2F10h]

loc_12BBD:				; CODE XREF: sub_12BAE+29j
		mov	ds, cs:word_12EF4
		mov	ax, [si-8000h]
		not	ax
		and	es:[di], ax
		mov	ds, word ptr cs:[bx+2F08h]
		lodsw
		or	es:[di], ax
		add	di, 2
		loop	loc_12BBD
		add	bx, 2
		mov	ds, cs:word_12F3E
		retn
sub_12BAE	endp


; =============== S U B	R O U T	I N E =======================================


sub_12BE2	proc near		; CODE XREF: sub_12AC9+7Dp
		mov	si, ds:0A181h
		mov	cs:word_12EF6, si
		mov	di, 8000h
		add	di, si
		mov	cs:word_12EFA, di
		mov	ax, ds:0A185h
		mov	ds, word ptr cs:[bx+2F08h]
		mov	es, cs:word_12EF4
		mov	bx, ax

loc_12C04:				; CODE XREF: sub_12BE2+41j
		mov	cx, dx
		rep movsb
		mov	si, cs:word_12EF6
		add	si, 50h
		mov	cs:word_12EF6, si
		mov	di, cs:word_12EFA
		add	di, 50h
		mov	cs:word_12EFA, di
		dec	bx
		jnz	short loc_12C04
		mov	ds, cs:word_12F3E
		retn
sub_12BE2	endp


; =============== S U B	R O U T	I N E =======================================


sub_12C2B	proc near		; CODE XREF: sub_12AC9+83p
					; sub_12AC9+89p ...
		mov	si, ds:0A181h
		mov	cs:word_12EF6, si
		mov	di, 8000h
		add	di, si
		mov	cs:word_12EFA, di
		mov	ax, ds:0A185h
		mov	ds, word ptr cs:[bx+2F08h]
		mov	es, cs:word_12EF4
		mov	bx, ax

loc_12C4D:				; CODE XREF: sub_12C2B+46j
		mov	cx, dx

loc_12C4F:				; CODE XREF: sub_12C2B+29j
		lodsb
		or	es:[di], al
		inc	di
		loop	loc_12C4F
		mov	si, cs:word_12EF6
		add	si, 50h
		mov	cs:word_12EF6, si
		mov	di, cs:word_12EFA
		add	di, 50h
		mov	cs:word_12EFA, di
		dec	bx
		jnz	short loc_12C4D
		mov	ds, cs:word_12F3E
		retn
sub_12C2B	endp


; =============== S U B	R O U T	I N E =======================================


sub_12C79	proc near		; CODE XREF: sub_12AC9+94p
					; sub_12AC9+9Ap ...
		mov	si, ds:0A181h
		mov	cs:word_12EF6, si
		mov	di, ds:0A188h
		mov	cs:word_12EFA, di
		mov	es, word ptr cs:[bx+2F10h]
		mov	ax, ds:0A185h

loc_12C93:				; CODE XREF: sub_12C79+53j
		push	ax
		mov	cx, dx

loc_12C96:				; CODE XREF: sub_12C79+35j
		mov	ds, cs:word_12EF4
		mov	al, [si-8000h]
		not	al
		and	es:[di], al
		mov	ds, word ptr cs:[bx+2F08h]
		lodsb
		or	es:[di], al
		inc	di
		loop	loc_12C96
		mov	si, cs:word_12EF6
		add	si, 50h
		mov	cs:word_12EF6, si
		mov	di, cs:word_12EFA
		add	di, 50h
		mov	cs:word_12EFA, di
		pop	ax
		dec	ax
		jnz	short loc_12C93
		mov	ds, cs:word_12F3E
		retn
sub_12C79	endp

; ---------------------------------------------------------------------------
; START	OF FUNCTION CHUNK FOR sub_12AC9

loc_12CD4:				; CODE XREF: sub_12AC9+24j
		mov	al, ds:0A180h
		out	0A6h, al	; Interrupt Controller #2, 8259A
		mov	al, dl
		mov	dh, ds:0A187h
		cmp	word ptr ds:0A183h, 50h
		jnz	short loc_12D34
		mov	cx, ds:0A185h
		imul	cx, 28h
		mov	cs:word_12EF6, cx
		mov	dl, ah
		xor	ah, 1
		mov	dh, ah
		mov	al, dl
		out	0A6h, al	; Interrupt Controller #2, 8259A
		mov	es, cs:word_12EF4
		mov	bx, 0A800h
		call	sub_12D7B
		mov	bx, 0B000h
		call	sub_12D86
		mov	bx, 0B800h
		call	sub_12D86
		mov	bx, 0E000h
		call	sub_12D86
		mov	bx, 0A800h
		call	sub_12DA7
		mov	bx, 0B000h
		call	sub_12DA7
		mov	bx, 0B800h
		call	sub_12DA7
		mov	bx, 0E000h
		call	sub_12DA7
		jmp	short loc_12D72
; ---------------------------------------------------------------------------

loc_12D34:				; CODE XREF: sub_12AC9+21Bj
		mov	cx, ds:0A183h
		mov	cs:word_12EF8, cx
		mov	es, cs:word_12EF4
		mov	bx, 0A800h
		call	sub_12DC2
		mov	bx, 0B000h
		call	sub_12DE4
		mov	bx, 0B800h
		call	sub_12DE4
		mov	bx, 0E000h
		call	sub_12DE4
		mov	bx, 0A800h
		call	sub_12E28
		mov	bx, 0B000h
		call	sub_12E28
		mov	bx, 0B800h
		call	sub_12E28
		mov	bx, 0E000h
		call	sub_12E28
; END OF FUNCTION CHUNK	FOR sub_12AC9
; START	OF FUNCTION CHUNK FOR sub_12916

loc_12D72:				; CODE XREF: sub_12916:loc_12987j
					; sub_12916:loc_12A99j	...
		les	di, cs:ScrVariables
		call	WriteIOA6
		retn
; END OF FUNCTION CHUNK	FOR sub_12916

; =============== S U B	R O U T	I N E =======================================


sub_12D7B	proc near		; CODE XREF: sub_12AC9+23Cp
		call	sub_12D98
		rep movsw
		mov	ds, cs:word_12F3E
		retn
sub_12D7B	endp


; =============== S U B	R O U T	I N E =======================================


sub_12D86	proc near		; CODE XREF: sub_12AC9+242p
					; sub_12AC9+248p ...
		call	sub_12D98

loc_12D89:				; CODE XREF: sub_12D86+Aj
		lodsw
		or	es:[di], ax
		add	di, 2
		loop	loc_12D89
		mov	ds, cs:word_12F3E
		retn
sub_12D86	endp


; =============== S U B	R O U T	I N E =======================================


sub_12D98	proc near		; CODE XREF: sub_12D7Bp sub_12D86p
		mov	si, ds:0A181h
		mov	di, 8000h
		mov	cx, cs:word_12EF6
		mov	ds, bx
		retn
sub_12D98	endp


; =============== S U B	R O U T	I N E =======================================


sub_12DA7	proc near		; CODE XREF: sub_12AC9+254p
					; sub_12AC9+25Ap ...
		call	sub_12E58

loc_12DAA:				; CODE XREF: sub_12DA7+13j
		mov	ax, [si-8000h]
		not	ax
		and	es:[di], ax
		lodsw
		or	es:[di], ax
		add	di, 2
		loop	loc_12DAA
		mov	ds, cs:word_12F3E
		retn
sub_12DA7	endp


; =============== S U B	R O U T	I N E =======================================


sub_12DC2	proc near		; CODE XREF: sub_12AC9+27Cp
		call	sub_12E0B

loc_12DC5:				; CODE XREF: sub_12DC2+1Aj
		mov	cx, cs:word_12EF8
		rep movsb
		add	cs:word_12EFA, 50h
		mov	si, cs:word_12EFA
		dec	cs:word_12EF6
		jnz	short loc_12DC5
		mov	ds, cs:word_12F3E
		retn
sub_12DC2	endp


; =============== S U B	R O U T	I N E =======================================


sub_12DE4	proc near		; CODE XREF: sub_12AC9+282p
					; sub_12AC9+288p ...
		call	sub_12E0B

loc_12DE7:				; CODE XREF: sub_12DE4+1Fj
		mov	cx, cs:word_12EF8

loc_12DEC:				; CODE XREF: sub_12DE4+Dj
		lodsb
		or	es:[di], al
		inc	di
		loop	loc_12DEC
		add	cs:word_12EFA, 50h
		mov	si, cs:word_12EFA
		dec	cs:word_12EF6
		jnz	short loc_12DE7
		mov	ds, cs:word_12F3E
		retn
sub_12DE4	endp


; =============== S U B	R O U T	I N E =======================================


sub_12E0B	proc near		; CODE XREF: sub_12DC2p sub_12DE4p
		mov	cx, ds:0A185h
		mov	cs:word_12EF6, cx
		mov	si, ds:0A181h
		mov	cs:word_12EFA, si
		mov	di, 8000h
		mov	ds, bx
		mov	es, cs:word_12EF4
		retn
sub_12E0B	endp


; =============== S U B	R O U T	I N E =======================================


sub_12E28	proc near		; CODE XREF: sub_12AC9+294p
					; sub_12AC9+29Ap ...
		call	sub_12E8E

loc_12E2B:				; CODE XREF: sub_12E28+28j
		mov	cx, cs:word_12EF8

loc_12E30:				; CODE XREF: sub_12E28+16j
		mov	al, [si-8000h]
		not	al
		and	es:[di], al
		lodsb
		or	es:[di], al
		inc	di
		loop	loc_12E30
		add	cs:word_12EFA, 50h
		mov	di, cs:word_12EFA
		dec	cs:word_12EF6
		jnz	short loc_12E2B
		mov	ds, cs:word_12F3E
		retn
sub_12E28	endp


; =============== S U B	R O U T	I N E =======================================


sub_12E58	proc near		; CODE XREF: sub_12A9Cp sub_12DA7p
		mov	al, ds:0A180h
		out	0A6h, al	; Interrupt Controller #2, 8259A
		mov	si, ds:0A181h
		xor	di, di
		mov	cx, cs:word_12EF6
		mov	ds, bx
		mov	es, cs:word_12EF4
		rep movsw
		mov	ds, cs:word_12F3E
		mov	al, ds:0A187h
		out	0A6h, al	; Interrupt Controller #2, 8259A
		xor	si, si
		mov	di, ds:0A181h
		mov	cx, cs:word_12EF6
		mov	ds, cs:word_12EF4
		mov	es, bx
		retn
sub_12E58	endp


; =============== S U B	R O U T	I N E =======================================


sub_12E8E	proc near		; CODE XREF: sub_12AA7p sub_12E28p
		mov	cx, ds:0A185h
		mov	cs:word_12EF6, cx
		mov	al, ds:0A180h
		out	0A6h, al	; Interrupt Controller #2, 8259A
		mov	si, ds:0A181h
		mov	cs:word_12EFA, si
		xor	di, di
		mov	ds, bx
		mov	es, cs:word_12EF4

loc_12EAE:				; CODE XREF: sub_12E8E+37j
		mov	cx, cs:word_12EF8
		rep movsb
		add	cs:word_12EFA, 50h
		mov	si, cs:word_12EFA
		dec	cs:word_12EF6
		jnz	short loc_12EAE
		mov	ds, cs:word_12F3E
		mov	cx, ds:0A185h
		mov	cs:word_12EF6, cx
		mov	al, ds:0A187h
		out	0A6h, al	; Interrupt Controller #2, 8259A
		xor	si, si
		mov	di, ds:0A188h
		mov	cs:word_12EFA, di
		mov	ds, cs:word_12EF4
		mov	es, bx
		retn
sub_12E8E	endp

; ---------------------------------------------------------------------------

locret_12EED:				; DATA XREF: seg001:8931o
		retn
; ---------------------------------------------------------------------------
		db 6 dup(0)
word_12EF4	dw 0A800h		; DATA XREF: sub_112A8+8w
					; sub_112D7+1Fw ...
word_12EF6	dw 0B000h		; DATA XREF: sub_112A8+17w
					; sub_112D7+19w ...
word_12EF8	dw 0B800h		; DATA XREF: sub_112A8+24w
					; sub_112FF+10r ...
word_12EFA	dw 0E000h		; DATA XREF: sub_12AA7+Aw
					; sub_12AA7+10r ...
word_12EFC	dw 0			; DATA XREF: sub_123A3+39w
					; sub_123A3+85r
word_12EFE	dw 0			; DATA XREF: sub_12308+11w
					; sub_123A3+40r ...
		dw 0A800h
		dw 0B000h
		dw 0B800h
		dw 0E000h
		dw 0
		dw 0
		dw 0
		dw 0
		dw 0
		dw 0
		dw 0
		dw 0
word_12F18	dw 0			; DATA XREF: sub_1245B+7w sub_124E1+7w ...
word_12F1A	dw 0			; DATA XREF: sub_1245B+Ew sub_124E1+Fw ...
word_12F1C	dw 0			; DATA XREF: sub_1245B+16w
					; sub_124E1+18w ...
word_12F1E	dw 0			; DATA XREF: sub_1245B+1Ew
					; sub_124E1+21w ...
word_12F20	dw 0			; DATA XREF: sub_1245B+26w
					; sub_124E1+2Aw ...
word_12F22	dw 0			; DATA XREF: sub_1245B+2Ew
					; sub_124E1+33w ...
word_12F24	dw 0			; DATA XREF: sub_1245B+36w
					; sub_124E1+3Cw ...
word_12F26	dw 0			; DATA XREF: sub_1245B+3Ew
					; sub_124E1+45w ...
word_12F28	dw 0			; DATA XREF: sub_1245B+46w
					; sub_124E1+4Ew ...
word_12F2A	dw 0			; DATA XREF: sub_1245B+4Ew
					; sub_124E1+57w ...
word_12F2C	dw 0			; DATA XREF: sub_1245B+56w
					; sub_124E1+60w ...
word_12F2E	dw 0			; DATA XREF: sub_1245B+5Ew
					; sub_124E1+69w ...
word_12F30	dw 0			; DATA XREF: sub_1245B+66w
					; sub_124E1+72w ...
word_12F32	dw 0			; DATA XREF: sub_1245B+6Ew
					; sub_124E1+7Bw ...
word_12F34	dw 0			; DATA XREF: sub_1245B+76w
					; sub_124E1+84w ...
word_12F36	dw 0			; DATA XREF: sub_1245B+7Ew
					; sub_124E1+8Dw ...
word_12F38	dw 0			; DATA XREF: sub_11B00+2w
					; sub_11B00+49r
ScrVariables	dd 0			; DATA XREF: start+Ar start:loc_1002Br ...
word_12F3E	dw 0			; DATA XREF: sub_100F6r sub_100F6+16r	...
		dw 0
		dw 0

; =============== S U B	R O U T	I N E =======================================


sub_12F44	proc near		; CODE XREF: sub_10715+3p
		call	sub_12F6E
		mov	ax, 0A800h
		mov	es, ax
		assume es:nothing
		mov	cx, 3E80h
		xor	di, di
		rep stosw
		jmp	short loc_12F69
; ---------------------------------------------------------------------------

loc_12F55:				; CODE XREF: sSomethingClear+19p
		call	sub_12F6E
		mov	ax, 0A800h
		mov	es, ax

loc_12F5D:				; CODE XREF: sub_12F44+23j
		mov	cx, bx
		mov	di, si
		rep stosb
		add	si, 50h	; 'P'
		dec	dx
		jnz	short loc_12F5D

loc_12F69:				; CODE XREF: sub_12F44+Fj
		mov	al, 40h	; '@'
		out	7Ch, al
		retn
sub_12F44	endp


; =============== S U B	R O U T	I N E =======================================


sub_12F6E	proc near		; CODE XREF: sub_12F44p
					; sub_12F44:loc_12F55p
		mov	al, 80h	; 'Ä'
		out	7Ch, al
		mov	al, 0FFh
		out	7Eh, al
		xor	al, al
		out	7Eh, al
		out	7Eh, al
		out	7Eh, al
		retn
sub_12F6E	endp


; =============== S U B	R O U T	I N E =======================================


CallSndDrv_BGM	proc near		; CODE XREF: sBGM_Play+5p
					; sBGM_Play+1Ap ...
		push	di
		push	es
		les	di, cs:ScrVariables
		assume es:nothing
		cmp	word ptr es:[di+8B4h], 3
		jz	short loc_12F9A
		cmp	word ptr es:[di+8B4h], 0
		jz	short loc_12F98
		int	60h		; call PMD

loc_12F98:				; CODE XREF: CallSndDrv_BGM+15j
		jmp	short loc_12F9C
; ---------------------------------------------------------------------------

loc_12F9A:				; CODE XREF: CallSndDrv_BGM+Dj
		int	61h		; call MMD

loc_12F9C:				; CODE XREF: CallSndDrv_BGM:loc_12F98j
		pop	es
		pop	di
		retn
CallSndDrv_BGM	endp


; =============== S U B	R O U T	I N E =======================================


CallSndDrv_SFX	proc near		; CODE XREF: sSFX_PlayFM+4p
		push	di
		push	es
		les	di, cs:ScrVariables
		cmp	word ptr es:[di+8B4h], 0
		jz	short loc_12FB2
		mov	ah, 0Ch
		int	60h		; call PMD

loc_12FB2:				; CODE XREF: CallSndDrv_SFX+Dj
		pop	es
		pop	di
		retn
CallSndDrv_SFX	endp


; =============== S U B	R O U T	I N E =======================================


WriteIOA4	proc near		; CODE XREF: sub_10915+Dp
		mov	al, es:[di+8B8h]
		out	0A4h, al	; Interrupt Controller #2, 8259A
		retn
WriteIOA4	endp


; =============== S U B	R O U T	I N E =======================================


WriteIOA4A6	proc near		; CODE XREF: sub_10BBD+53p
		mov	al, es:[di+8B8h]
		out	0A4h, al	; Interrupt Controller #2, 8259A
WriteIOA4A6	endp ; sp-analysis failed


; =============== S U B	R O U T	I N E =======================================


WriteIOA6	proc near		; CODE XREF: sLoadImage+11p
					; seg000:035Cp	...
		mov	al, es:[di+8B7h]
		out	0A6h, al	; Interrupt Controller #2, 8259A
		retn
WriteIOA6	endp


; =============== S U B	R O U T	I N E =======================================


WaitFrames	proc near		; CODE XREF: ScriptMainLoop+5Cp
					; sPalFadeBW1+2Ap ...
		or	ah, ah
		jz	short locret_12FEE
		push	ax
		mov	ah, 2
		int	18h		; TRANSFER TO ROM BASIC
					; causes transfer to ROM-based BASIC (IBM-PC)
					; often	reboots	a compatible; often has	no effect at all
		test	al, 10h
		pop	ax
		jnz	short locret_12FEE
		push	word ptr ds:0A1BBh
		mov	byte ptr ds:0A1BBh, 1

loc_12FE3:				; CODE XREF: WaitFrames+1Cj
		call	WaitForVSync
		dec	ah
		jnz	short loc_12FE3
		pop	word ptr ds:0A1BBh

locret_12FEE:				; CODE XREF: WaitFrames+2j
					; WaitFrames+Cj
		retn
WaitFrames	endp


; =============== S U B	R O U T	I N E =======================================


WaitForVSync	proc near		; CODE XREF: sDelay:loc_10727p
					; sub_11D70:loc_11DD4p	...
		test	word ptr ds:0A1BBh, 1
		jnz	short loc_12FF8
		retn
; ---------------------------------------------------------------------------

loc_12FF8:				; CODE XREF: sub_12308:loc_12333p
					; WaitForVSync+6j ...
		in	al, 60h		; 8042 keyboard	controller data	register
		and	al, 20h
		jnz	short loc_12FF8

loc_12FFE:				; CODE XREF: WaitForVSync+13j
		in	al, 60h		; 8042 keyboard	controller data	register
		and	al, 20h
		jz	short loc_12FFE
		retn
WaitForVSync	endp


; =============== S U B	R O U T	I N E =======================================


sub_13005	proc near		; CODE XREF: sub_10242+20p
		mov	ah, 2Ah
		int	21h		; DOS -	GET CURRENT DATE
					; Return: DL = day, DH = month,	CX = year
					; AL = day of the week (0=Sunday, 1=Monday, etc.)
		mov	ds:0A19Ch, dx
		mov	ah, 2Ch
		int	21h		; DOS -	GET CURRENT TIME
					; Return: CH = hours, CL = minutes, DH = seconds
					; DL = hundredths of seconds
		mov	ds:0A198h, cx
		mov	ds:0A19Ah, dx
		retn
sub_13005	endp


; =============== S U B	R O U T	I N E =======================================


sub_1301A	proc near		; CODE XREF: sub_10843p
		push	bx
		push	cx
		push	dx

loc_1301D:				; CODE XREF: sub_1301A+55j
		xor	bl, bl
		mov	ax, ds:0A198h
		mul	word ptr ds:0A19Eh
		div	word ptr ds:0A1A4h
		mov	ds:0A198h, dx
		dec	dx
		cmp	dx, 7FFFh
		jb	short loc_13037
		inc	bl

loc_13037:				; CODE XREF: sub_1301A+19j
		mov	cx, dx
		mov	ax, ds:0A19Ah
		mul	word ptr ds:0A1A0h
		div	word ptr ds:0A1A6h
		mov	ds:0A19Ah, dx
		dec	dx
		cmp	dx, 7FFFh
		jb	short loc_13051
		inc	bl

loc_13051:				; CODE XREF: sub_1301A+33j
		add	cx, dx
		mov	ax, ds:0A19Ch
		mul	word ptr ds:0A1A2h
		div	word ptr ds:0A1A8h
		mov	ds:0A19Ch, dx
		dec	dx
		cmp	dx, 7FFFh
		jb	short loc_1306B
		inc	bl

loc_1306B:				; CODE XREF: sub_1301A+4Dj
		add	cx, dx
		or	bl, bl
		jnz	short loc_1301D
		and	cx, 7FFFh
		mov	ax, cx
		pop	dx
		pop	cx
		pop	bx
		retn
sub_1301A	endp


; =============== S U B	R O U T	I N E =======================================


Int2Str_4Digits	proc near		; CODE XREF: ScriptMainLoop+1Bp
					; ScriptMainLoop+38p ...
		push	bx
		push	cx
		push	dx
		push	si
		push	di
		mov	si, (offset asc_1D24A+4)
		mov	di, offset byte_1D259
		mov	bx, 10
		mov	cx, 4

loc_1308C:				; CODE XREF: Int2Str_4Digits+20j
		xor	dx, dx
		div	bx
		mov	[di], dx
		add	dl, '0'
		mov	[si], dl
		dec	si
		sub	di, 2
		loop	loc_1308C
		mov	[di], ax
		add	al, '0'
		mov	[si], al
		pop	di
		pop	si
		pop	dx
		pop	cx
		pop	bx
		retn
Int2Str_4Digits	endp

seg000		ends

; ===========================================================================

; Segment type:	Regular
seg001		segment	byte public 'UNK' use16
		assume cs:seg001
		;org 9
		assume es:nothing, ss:nothing, ds:nothing, fs:nothing, gs:nothing
		align 2
aCurSceneFile	db 'BEGIN.DSD',0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
					; DATA XREF: start:loc_1001Co
					; LoadSceneMainBo ...
aPrevSceneFile	db 'BEGIN.DSD',0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
					; DATA XREF: sCallScene+7t
					; sReturnSceneo
aDianaVer2	db '--- éÆê_ñÉêùÇQÅ@ÉAÉhÉxÉìÉ`ÉÉÅ[ÉhÉâÉCÉoÅ@ÇcÇhÇ`ÇmÇ`Å@Ver.ÇQ    (C)'
		db '1994-6 DAIMA Factory inc. ---',0
byte_13149	db 8473h dup(0)
byte_1B5BC	db 0			; DATA XREF: sub_10242+55w
		db    7
		db  24h	; $
aNoNavalFound	db 'NAVALÇ™Ç¢Ç»Ç¢ÇÃ(;_;).',0Dh,0Ah,'$' ; DATA XREF: CheckNAVAL+34o
aUnknownCommand	db 'ÅcÇ±ÇÒÇ»ñΩóﬂÇ»ÇÒÇ©ÅAå©ÇΩÇ±Ç∆ñ≥Ç¢ÇÌÅI',0Dh,0Ah,'$'
					; DATA XREF: ScriptMainLoop+49o
aImpossible	db 'Ç≤ÇﬂÇÒÅcñ≥óùÇ›ÇΩÇ¢.',0Dh,0Ah ; DATA XREF: sub_101F9+2Do
		db '$Å°$'
		db    0
scrStackPtr	dw 0			; DATA XREF: sCallw sCall+5r ...
		db 0Ch dup(0)
word_1B626	dw 0			; DATA XREF: sSetPalColour+13w
					; sSetPalColour+37r ...
byte_1B628	db 0			; DATA XREF: sSetPalColour+1Ew
					; sSetPalColour+3Er
aVovovovovo	db 'ÇOÇOÇOÇOÇO',3,0     ; DATA XREF: sub_108A3+8o sub_108C7+8o ...
aNNNNN		db 'ÏNÏNÏNÏNÏN',3,0
byte_1B641	db 0			; DATA XREF: sCompareValVal+Dw
					; sCondJmp_EQr	...
byte_1B642	db 0FFh			; DATA XREF: sLoadImage:loc_102D7r
					; sLoadImage+1Fw
		align 2
byte_1B644	db 0			; DATA XREF: sLoadImage+14w
					; seg000:034Ar	...
		align 2
word_1B646	dw 0			; DATA XREF: sLoadImage+68w
word_1B648	dw 0			; DATA XREF: sLoadImage+6Fw
word_1B64A	dw 0			; DATA XREF: sLoadImage+82w
word_1B64C	dw 0A800h		; DATA XREF: sLoadImage+2Bw
					; sLoadImage+4Cw
word_1B64E	dw 0B000h		; DATA XREF: sLoadImage+31w
					; sLoadImage+53w
word_1B650	dw 0B800h		; DATA XREF: sLoadImage+37w
					; sLoadImage+5Aw
word_1B652	dw 0E000h		; DATA XREF: sLoadImage+3Dw
					; sLoadImage+61w
		dw 260h
byte_1B656	db 44h dup(0)
scriptFuncList	dw offset sInvalid	; 0 ; DATA XREF: ScriptMainLoop+6Br
		dw offset sExit		; 1
		dw offset sLoadImage	; 2
		dw offset sOpenTextBox	; 3
		dw offset sCloseTextBox	; 4
		dw offset sClearTextBox	; 5
		dw offset sApplyPalette	; 6
		dw offset sPalFadeBW1	; 7
		dw offset sPalFadeBW2	; 8
		dw offset sPalMaskToggle; 9
		dw offset sJumpAbs	; 0Ah
		dw offset sCompareVars	; 0Bh
		dw offset sCompareValVal; 0Ch
		dw offset sCondJmp_EQ	; 0Dh
		dw offset sCondJmp_LT	; 0Eh
		dw offset sCondJmp_GT	; 0Fh
		dw offset sCondJmp_GE	; 10h
		dw offset sCondJmp_LE	; 11h
		dw offset sCondJmp_NE	; 12h
		dw offset sTblJump	; 13h
		dw offset sSetPalColour	; 14h
		dw offset sShowText	; 15h
		dw offset sub_10621	; 16h
		dw offset sLoadVar_Val	; 17h
		dw offset sLoadVars_Vals; 18h
		dw offset sLoadVar_Var	; 19h
		dw offset sBGM_Play	; 1Ah
		dw offset sBGM_FadeOut	; 1Bh
		dw offset sBGM_Stop	; 1Ch
		dw offset sGetMusMode	; 1Dh
		dw offset sub_106D4	; 1Eh
		dw offset sLoadScene	; 1Fh
		dw offset sub_10715	; 20h
		dw offset sDelay	; 21h
		dw offset sub_10730	; 22h
		dw offset sub_10741	; 23h
		dw offset sAddVars_Vals	; 24h
		dw offset sSubVars_Vals	; 25h
		dw offset sub_10788	; 26h
		dw offset sAddVar_Var	; 27h
		dw offset sSubVar_Var	; 28h
		dw offset sMulVar_Var	; 29h
		dw offset sDivVar_Var	; 2Ah
		dw offset sAndVar_Var_1	; 2Bh
		dw offset sAndVar_Var_2	; 2Ch
		dw offset sClearVars	; 2Dh
		dw offset sub_10843	; 2Eh
		dw offset sub_10858	; 2Fh
		dw offset sub_10869	; 30h
		dw offset sub_108A3	; 31h
		dw offset sub_108C7	; 32h
		dw offset sub_10915	; 33h
		dw offset sub_10929	; 34h
		dw offset sTextFill	; 35h
		dw offset sub_109A7	; 36h
		dw offset sVar_IndexedSrc; 37h
		dw offset sVar_IndexedDst; 38h
		dw offset sub_10ACE	; 39h
		dw offset sub_10AD8	; 3Ah
		dw offset sub_10AE2	; 3Bh
		dw offset sub_10B2C	; 3Ch
		dw offset sub_10B90	; 3Dh
		dw offset sub_10BBD	; 3Eh
		dw offset sub_10C61	; 3Fh
		dw offset sub_10C80	; 40h
		dw offset sub_10CF4	; 41h
		dw offset sub_10D8F	; 42h
		dw offset sub_10D9D	; 43h
		dw offset sub_10DB7	; 44h
		dw offset sub_10DC7	; 45h
		dw offset sub_10DD3	; 46h
		dw offset sub_10E65	; 47h
		dw offset sSaveCharName	; 48h
		dw offset sLoadCharName	; 49h
		dw offset sSaveVarBuf	; 4Ah
		dw offset sLoadVarBuf	; 4Bh
		dw offset sub_11028	; 4Ch
		dw offset sLoadSubScene	; 4Dh
		dw offset nullsub_1	; 4Eh
		dw offset sSFX_PlayFM	; 4Fh
		dw offset sBGM_GetState	; 50h
		dw offset sAndVar_Val	; 51h
		dw offset sOrVar_Val	; 52h
		dw offset sub_110A5	; 53h
		dw offset sCall		; 54h
		dw offset sReturn	; 55h
		dw offset sCallCommon	; 56h
		dw offset sLoopInitVal	; 57h
		dw offset sLoopGet	; 58h
		dw offset sLoopJumpVal	; 59h
		dw offset sLoopInitVar	; 5Ah
		dw offset sLoopJumpVar	; 5Bh
		dw offset sCallScene	; 5Ch
		dw offset sReturnScene	; 5Dh
		dw offset sSomethingClear; 5Eh
		dw offset sStr_SetDate	; 5Fh
		dw offset sGetFileDate	; 60h
		dw offset sub_11275	; 61h
		dw offset sub_1128B	; 62h
		dw offset sOpenTextBoxVar; 63h
		dw offset sub_10CEA	; 64h
		dw offset sub_10887	; 65h
		dw offset sInvalid	; 66h
		dw offset sInvalid	; 67h
		dw offset sub_112A8	; 68h
		dw offset sub_11344	; 69h
		dw offset sub_11366	; 6Ah
		dw offset sub_11382	; 6Bh
		dw offset sInvalid	; 6Ch
		dw offset sub_113B3	; 6Dh
		dw offset sub_113C0	; 6Eh
		dw offset sub_113DC	; 6Fh
word_1B77A	dw 0			; DATA XREF: sOpenTextBox:loc_10397w
					; sOpenTextBox+6Br ...
word_1B77C	dw 0			; DATA XREF: sOpenTextBox+20w
					; sOpenTextBox+49r
word_1B77E	dw 0			; DATA XREF: sub_10C80+4w sub_10CAE+7r ...
aName_txt	db 'NAME.TXT',0         ; DATA XREF: sSaveCharName+66o
					; sLoadCharNameo
aCharacterName	db '2,êùåÂÅ@Å@Å@ÅyÅ@êùÅ@åÂÅ@Åz ',0Dh,0Ah,1Ah ; DATA XREF: sSaveCharName+30w
					; sSaveCharName+73o ...
aDontComeHere	db 'ÅcÇ±Ç±Ç…ÇÕóàÇ»Ç¢Ç≈.',0Dh,0Ah,'$' ; DATA XREF: sInvalid+4o
					; ...Don't come here.
aDianaErrTbl	dw offset aDianaErr00	; 0 ; DATA XREF: LoadSceneMainB+ADr
		dw offset aDianaOpenError; 1 ; "00 DIANA err 00: ïœÇ≈Ç∑.\r\n$"
		dw offset aDianaReadError; 2
aDianaErr00	db '00 DIANA err 00: ïœÇ≈Ç∑.',0Dh,0Ah,'$' ; DATA XREF: seg001:aDianaErrTblo
					; 00 DIANA err 00: That's strange.
aDianaOpenError	db '00 DIANA:äJÇØÇ‹ÇπÇÒÇ≈ÇµÇΩ.',0Dh,0Ah,'$' ; DATA XREF: sub_10FE9+6w
					; sub_10FE9+Eo	...
					; 00 DIANA: Could not open.
aDianaReadError	db '00 DIANA:ì«ÇﬂÇ‹ÇπÇÒÇ≈ÇµÇΩ.',0Dh,0Ah,'$' ; DATA XREF: sLoadVarBuf+10w
					; sLoadVarBuf+18o ...
					; 00 DIANA:I couldn't read it.
aDianaWriteError db '00 DIANA:èëÇØÇ‹ÇπÇÒÇ≈ÇµÇΩ.',0Dh,0Ah,'$' ; DATA XREF: sSaveVarBuf+1Cw
					; sSaveVarBuf+24o
					; 00 DIANA:I couldn't write it.
		db    0
		db    0
		db    0
word_1B838	dw 0			; DATA XREF: ReadFromArchive+4w
					; ReadFromArchive:loc_11A88r ...
libTocSize	dw 0			; DATA XREF: ReadFromArchive+49o
					; ReadFromArchive+53r ...
byte_1B83C	db 1			; DATA XREF: sub_10788+Fw
fileHandle	dw 0			; DATA XREF: sBGM_Play+13r
					; sub_10FE9:loc_11002w	...
byte_1B83F	db 30h dup(0)		; DATA XREF: sub_11886o
aInsertDisk	db 1Bh,'*',1Bh,'[37m',1Bh,'[12;14HÉhÉâÉCÉuÇQÇ…Ç`ÉfÉBÉXÉNÇÉZÉbÉgÇµÇƒÉNÉäÉbÉNÇµ'
					; DATA XREF: OpenFileForRead+9Do
		db 'ÇƒÇ≠ÇæÇ≥Ç¢.$'       ; Insert disk A into drive 2 and click.
off_1B8B6	dw offset a00		; 0 ; DATA XREF: OpenFileForRead-72r
		dw offset a01		; 1 ; "00\r\n$"
		dw offset a02		; 2
		dw offset a03		; 3
		dw offset a04		; 4
		dw offset a05		; 5
		dw offset a06		; 6
		dw offset a07		; 7
		dw offset a08		; 8
		dw offset a09		; 9
		dw offset a10		; 0Ah
		dw offset a11		; 0Bh
aGrErr		db 'GR-err : #$'        ; DATA XREF: OpenFileForRead-81o
					; OpenFileRead2w ...
a00		db '00',0Dh,0Ah,'$'     ; DATA XREF: seg001:off_1B8B6o
a01		db '01',0Dh,0Ah,'$'     ; DATA XREF: seg001:off_1B8B6o
a02		db '02',0Dh,0Ah,'$'     ; DATA XREF: seg001:off_1B8B6o
a03		db '03',0Dh,0Ah,'$'     ; DATA XREF: seg001:off_1B8B6o
a04		db '04',0Dh,0Ah,'$'     ; DATA XREF: seg001:off_1B8B6o
a05		db '05',0Dh,0Ah,'$'     ; DATA XREF: seg001:off_1B8B6o
a06		db '06',0Dh,0Ah,'$'     ; DATA XREF: seg001:off_1B8B6o
a07		db '07',0Dh,0Ah,'$'     ; DATA XREF: seg001:off_1B8B6o
a08		db '08',0Dh,0Ah,'$'     ; DATA XREF: seg001:off_1B8B6o
a09		db '09',0Dh,0Ah,'$'     ; DATA XREF: seg001:off_1B8B6o
a10		db '10',0Dh,0Ah,'$'     ; DATA XREF: seg001:off_1B8B6o
a11		db '11',0Dh,0Ah,'$'     ; DATA XREF: seg001:off_1B8B6o
byte_1B915	db 0			; DATA XREF: OpenFileForRead+49w
					; OpenFileForRead+5Br
a00CivVV_	db '00:óàÇƒÇ‹Ç∑.$',0
		db    0
		db    0
		db    7
		db    1
		db 0A5h	dup(0)
		dw 2020h
		dw 0
		dw offset loc_121CC	; 0
		dw offset loc_121E9	; 1
		dw offset loc_121F6	; 2
		dw offset loc_12201	; 3
		dw offset loc_12217	; 4
		dw offset loc_1223C	; 5
		dw offset loc_1220C	; 6
		dw offset loc_122B7	; 7
		dw offset locret_12EED	; 8
		dw offset locret_12EED	; 9
		dw offset locret_12EED	; 0Ah
		dw offset locret_12EED	; 0Bh
		dw offset loc_122D5	; 0Ch
		dw offset locret_12EED	; 0Dh
		dw offset locret_12EED	; 0Eh
		dw offset loc_122E9	; 0Fh
		db 23h dup(0)
word_1BA14	dw 0FFFFh		; DATA XREF: sub_10CF4+7w
					; sub_10CF4+49w ...
		db 1680h dup(0)
word_1D096	dw 0			; DATA XREF: sOpenTextBox:loc_103B4w
					; sCloseTextBox+12w ...
word_1D098	dw 0			; DATA XREF: sub_11B00+12w
word_1D09A	dw 30h dup(0)		; DATA XREF: sub_108C7+3Er
					; sub_10E65+1Cr
		db 0Ch dup(0)
byte_1D106	db 0			; DATA XREF: sOpenTextBox+32w
					; sClearTextBoxw ...
byte_1D107	db 12h dup(0FFh)
byte_1D119	db 102h	dup(0)		; DATA XREF: sub_10858+Aw
word_1D21B	dw 0			; DATA XREF: sub_1128B+8w
word_1D21D	dw 0			; DATA XREF: sub_1128B+13w
byte_1D21F	db 19h dup(0)		; DATA XREF: sub_10242+17w
					; sub_10AEC+4w	...
		dw 100
		dw 1000
		dw 10000
		dw 0B3h
		dw 0B7h
		dw 0B6h
		dw 8003h
		dw 800Bh
		dw 800Fh
asc_1D24A	db 0,0,0,0,0,' $'       ; DATA XREF: ScriptMainLoop+20o
					; ScriptMainLoop+3Do ...
byte_1D251	db 8 dup(0)		; DATA XREF: sub_108A3+Eo sub_108C7+Eo
byte_1D259	db 0, 0, 1, 0		; DATA XREF: Int2Str_4Digits+8o
		align 4
seg001		ends

; ===========================================================================

; Segment type:	Uninitialized
seg002		segment	byte stack 'STACK' use16
		assume cs:seg002
		assume es:nothing, ss:nothing, ds:nothing, fs:nothing, gs:nothing
byte_1D260	db 400h	dup(?)
seg002		ends

; ===========================================================================

; Segment type:	Zero-length
seg003		segment	byte public '' use16
seg003		ends


		end start
